/*
 * jQuery Pines Tags (ptags) Plugin 1.1.1
 *
 * Copyright (c) 2009-2011 Hunter Perrin
 *
 * Triple license under the GPL, LGPL, and MPL:
 *	  http://www.gnu.org/licenses/gpl.html
 *	  http://www.gnu.org/licenses/lgpl.html
 *	  http://www.mozilla.org/MPL/MPL-1.1.html
 */
(function(b){b.fn.ptags_add=function(e){if(!e)return this;this.each(function(){this.pines_tags&&this.pines_tags.ptags_add(e)});return this};b.fn.ptags_remove=function(e){if(!e)return this;this.each(function(){this.pines_tags&&this.pines_tags.ptags_remove(e)});return this};b.fn.ptags_remove_all=function(){this.each(function(){this.pines_tags&&this.pines_tags.ptags_remove_all()});return this};var i=b.fn.val;b.fn.val=function(e){var h=i.apply(this,arguments);typeof e!="undefined"&&this.each(function(){typeof this.pines_tags!=
"undefined"&&this.pines_tags.ptags_sync_input()});return h};b.fn.ptags=function(e){var h=b.extend({},b.fn.ptags.defaults,e);e=this;e.each(function(){var a=b(this);a.ptags_version="1.1.1";if(a.hasClass("ui-ptags-tag-box"))return true;a.addClass("ui-ptags-tag-box");a.extend(a,h);a.ptags_widget=b("<span />");a.ptags_container=b("<span />");a.ptags_tags=a.ptags_tags.slice();a.ptags_add=function(c){b.merge(a.ptags_tags,typeof c=="string"?[c]:c);a.ptags_unique_check();a.ptags_update_val();a.ptags_update_tags()};
a.ptags_remove=function(c){b.each(typeof c=="string"?[c]:c,function(){var f=b.inArray(""+this,a.ptags_tags);f>-1&&a.ptags_tags.splice(f,1)});a.ptags_update_val();a.ptags_update_tags()};a.ptags_remove_all=function(){a.ptags_tags=[];a.ptags_update_val();a.ptags_update_tags()};a.ptags_unique_check=function(){for(var c=0;c<a.ptags_tags.length;c++)if(b.inArray(a.ptags_tags[c],a.ptags_tags)<c||a.ptags_tags[c]==""){a.ptags_tags.splice(c,1);c--}};a.ptags_update_val=function(){var c=a.val(),f=a.ptags_tags.join(a.ptags_delimiter);
c!=f&&a.val(f).change()};a.ptags_sync_input=function(){var c=a.ptags_tags.join(a.ptags_delimiter),f=a.val();if(f!=c){a.ptags_tags=f.split(a.ptags_delimiter);a.ptags_unique_check();a.ptags_update_val();a.ptags_update_tags()}};a.ptags_update_tags=function(){if(a.ptags_show_tags){a.ptags_tag_container.empty();b.each(a.ptags_tags,function(c,f){var g=b("<span />").addClass("ui-state-default ui-corner-all ui-ptags-tag");g.append(b('<a href="#" />').addClass("ui-ptags-tag-text").html(f).click(function(){if(a.ptags_editable&&
a.ptags_input_box){if(a.ptags_noclick){a.ptags_noclick=false;g.removeClass("ui-state-hover");return false}d.val(g.text()).focus().select();a.ptags_remove(g.text())}return false}));a.ptags_editable&&a.ptags_input_box&&g.hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});a.ptags_remover&&g.children().addClass("ui-ptags-tag-text-icon").end().append(b('<a href="#" />').addClass("ui-ptags-tag-remover ui-icon ui-icon-circle-minus").click(function(){a.ptags_remove(g.text());
return false}));a.ptags_tag_container.append(g)})}};a.ptags_widget.addClass("ui-ptags");a.wrapAll(a.ptags_widget);a.ptags_widget=a.parent();a.ptags_container.addClass("ui-ptags-tag-box-container");a.wrapAll(a.ptags_container);a.ptags_container=a.parent();if(a.ptags_input_box){var d=b(a.get(0)).clone().val("").keydown(function(c){if(c.keyCode==13&&!c.shiftKey){a.ptags_add(d.val().split(a.ptags_delimiter));d.val("");return false}}).blur(function(){if(d.val()!=""){a.ptags_add(d.val().split(a.ptags_delimiter));
d.val("")}});d.attr("id")&&d.attr("id",d.attr("id")+"__ptags");d.attr("name")&&d.attr("name",d.attr("name")+"__ptags");a.ptags_container.append(d)}if(a.ptags_current_text){var j=a.val().split(a.ptags_delimiter);b.merge(a.ptags_tags,j);a.ptags_unique_check();a.ptags_update_val()}if(a.ptags_show_tags){a.ptags_tag_container=b("<span />").addClass("ui-ptags-tag-container");a.ptags_widget.append(a.ptags_tag_container);a.ptags_update_tags()}a.change(a.ptags_sync_input);a.ptags_sortable!=false&&a.ptags_tag_container.sortable(a.ptags_sortable).bind("sortupdate",
function(){a.ptags_tags=b.map(a.ptags_tag_container.find("a.ui-ptags-tag-text"),function(c){return b(c).text()});a.ptags_update_val()}).bind("sortstop",function(){a.ptags_noclick=true});a.ptags_show_box||a.css("display","none");this.pines_tags=a});return e};b.fn.ptags.defaults={ptags_tags:[],ptags_current_text:true,ptags_delimiter:",",ptags_show_tags:true,ptags_show_box:false,ptags_input_box:true,ptags_remover:true,ptags_editable:true,ptags_sortable:false}})(jQuery);
