/*!
 * elFinder - file manager for web
 * Version 2.0 beta (2011-07-10)
 * http://elfinder.org
 * 
 * Copyright 2009-2011, Studio 42
 * Licensed under a 3 clauses BSD license
 */
(function(c){window.elFinder=function(a,d){this.time("load");var b=this,a=c(a),e=c("<div/>").append(a.contents()),g=a.attr("style"),h=a.attr("id")||"",f="elfinder-"+(h||Math.random().toString().substr(2,7)),i="mousedown."+f,j="keydown."+f,l="keypress."+f,k=true,q=true,m="",p={path:"",url:"",tmbUrl:"",disabled:[],separator:"/",archives:[],extract:[],copyOverwrite:true,tmb:false},n={},u=[],s={},r={},y=[],A=[],C=new b.command(b),D="auto",B=400,x=c(document.createElement("audio")).hide().appendTo("body")[0],
F=function(a){if(a.init)n={};else for(var c in n)n.hasOwnProperty(c)&&n[c].mime!="directory"&&n[c].phash==m&&delete n[c];m=a.cwd.hash;t(a.files);n[m]||(b.log("no cwd in cache"),t([a.cwd]));b.lastDir(m)},t=function(a){for(var c=a.length,b;c--;)b=a[c],b.name&&b.hash&&b.mime&&(n[b.hash]=b)};this.api=null;this.oldAPI=this.newAPI=false;this.OS=navigator.userAgent.indexOf("Mac")!==-1?"mac":navigator.userAgent.indexOf("Win")!==-1?"win":"other";this.options=c.extend({},this.options,d||{});this.requestType=
/^(get|post)$/i.test(this.options.requestType)?this.options.requestType.toLowerCase():"get";this.customData=c.isPlainObject(this.options.customData)?this.options.customData:{};this.id=h;this.namespace=f;this.lang=this.i18[this.options.lang]&&this.i18[this.options.lang].messages?this.options.lang:"en";this.direction=this.i18[this.lang].direction;this.messages=c.extend({},this.i18.en&&this.i18.en.messages,this.lang!="en"?this.i18[this.lang].messages:{});this.cssClass="ui-helper-reset ui-helper-clearfix ui-widget ui-widget-content ui-corner-all elfinder elfinder-"+
(this.direction=="rtl"?"rtl":"ltr")+" "+this.options.cssClass;var z;try{z="localStorage"in window&&window.localStorage!==null?b.localStorage:b.cookie}catch(w){z=b.cookie}this.storage=z;this.sort=b.sorts[b.options.sort]||1;this.notifyDelay=this.options.notifyDelay>0?parseInt(this.options.notifyDelay):500;this.draggable={appendTo:"body",addClasses:true,delay:30,revert:true,refreshPositions:true,cursor:"move",cursorAt:{left:50,top:47},drag:function(a,c){c.helper.toggleClass("elfinder-drag-helper-plus",
a.shiftKey||a.ctrlKey||a.metaKey)},stop:function(){b.trigger("focus").trigger("dragstop")},helper:function(a){var d=this.id?c(this):c(this).parents("[id]:first"),e=c('<div class="elfinder-drag-helper"><span class="elfinder-drag-helper-icon-plus"/></div>'),g=function(a){return'<div class="elfinder-cwd-icon '+b.mime2class(a)+' ui-corner-all"/>'},f;b.trigger("dragstart",{target:d[0],originalEvent:a});a=d.is("."+b.res("class","cwdfile"))?b.selected():[b.navId2Hash(d.attr("id"))];e.append(g(n[a[0]].mime)).data("files",
a);(f=a.length)>1&&e.append(g(n[a[f-1]].mime)+'<span class="elfinder-drag-num">'+f+"</span>");return e}};this.droppable={tolerance:"pointer",accept:".elfinder-cwd-file-wrapper,.elfinder-navbar-dir,.elfinder-cwd-file",hoverClass:this.res("class","adroppable"),drop:function(a,d){var e=c(this),g=c.map(d.helper.data("files")||[],function(a){return a||null}),f=[],h,i;e.is("."+b.res("class","cwd"))?h=m:e.is("."+b.res("class","cwdfile"))?h=e.attr("id"):e.is("."+b.res("class","navdir"))&&(h=b.navId2Hash(e.attr("id")));
for(e=g.length;e--;)i=g[e],i!=h&&n[i].phash!=h&&f.push(i);f.length&&(d.helper.hide(),b.clipboard(f,!(a.ctrlKey||a.shiftKey||a.metaKey)),b.exec("paste",h).always(function(){b.clipboard([])}),b.trigger("drop",{files:g}))}};this.enabled=function(){return a.is(":visible")&&k};this.visible=function(){return a.is(":visible")};this.root=function(a){for(a=n[a||m];a&&a.phash;)a=n[a.phash];if(a)return a.hash;for(;void 0 in n&&n.hasOwnProperty(void 0);)if(a=n[void 0],!a.phash&&!a.mime=="directory"&&a.read)return a.hash;
return""};this.cwd=function(){return n[m]||{}};this.option=function(a){return p[a]||""};this.file=function(a){return n[a]};this.files=function(){return c.extend(true,{},n)};this.parents=function(a){for(var c=[];a=this.file(a);)c.unshift(a.hash),a=a.phash;return c};this.path=function(a){a=n[a];return a.path?a.path:a?p.path+(a.hash==m?"":p.separator+a.name):""};this.url=function(a){var c=n[a],b="";if(c.url)return c.url;return p.url&&(b=this.path(a))?(b=b.replace(p.separator,"/"),p.url+b.substr(b.indexOf("/")+
1)):""};this.tmb=function(a){var o;if((o=(a=n[a])&&a.tmb&&a.tmb!=1?p.tmbUrl+a.tmb:"",a=o)&&(c.browser.opera||c.browser.msie))a+="?_="+(new Date).getTime();return a};this.selected=function(){return u.slice(0)};this.selectedFiles=function(){return c.map(u,function(a){return n[a]||null})};this.fileByName=function(a,c){for(var b in n)if(n.hasOwnProperty(b)&&n[b].phash==c&&n[b].name==a)return n[b]};this.validResponse=function(a,c){return this.rules[this.rules[a]?a:"defaults"](c)};this.request=function(a){var b=
this,d=this.options,e=c.Deferred(),g=c.extend({},d.customData,{mimes:d.onlyMimes},a.data||a),f=g.cmd,h=!(a.preventDefault||a.preventFail),i=!(a.preventDefault||a.preventDone),j=c.extend({},a.notify),n=!!a.raw,l=a.syncOnFail,m,a=c.extend({url:d.url,async:true,type:this.requestType,dataType:"json",cache:false,data:g},a.options||{}),r;i&&e.done(function(a){a.warning&&b.error(a.warning);f=="open"&&F(c.extend(true,{},a));a.removed&&a.removed.length&&b.remove(a);a.added&&a.added.length&&b.add(a);a.changed&&
a.changed.length&&b.change(a);b.trigger(f,a)});e.fail(function(a){a&&(h?b.error(a):b.debug("error",b.i18n(a)))});if(!f)return e.reject("errCmdReq");l&&e.fail(function(a){a&&b.sync()});j.type&&j.cnt&&(m=setTimeout(function(){b.notify(j);e.always(function(){j.cnt=-(parseInt(j.cnt)||0);b.notify(j)})},b.notifyDelay),e.always(function(){clearTimeout(m)}));if(f=="open")for(;d=A.pop();)if(!d.isRejected()&&!d.isResolved())d.quiet=true,d.abort();delete a.preventFail;r=this.transport.send(a).fail(function(a,
c){var b;switch(c){case "abort":b=a.quiet?"":["errConnect","errAbort"];break;case "timeout":b=["errConnect","errTimeout"];break;case "parsererror":b=["errResponse","errDataNotJSON"];break;default:b=a.status==403?["errConnect","errAccess"]:a.status==404?["errConnect","errNotFound"]:"errConnect"}e.reject(b,a,c)}).done(function(a){if(n)return e.resolve(a);if(a)if(c.isPlainObject(a))if(a.error)return e.reject(a.error,r);else{if(!b.validResponse(f,a))return e.reject("errResponse",r)}else return e.reject(["errResponse",
"errDataNotJSON"],r);else return e.reject(["errResponse","errDataEmpty"],r);a=b.normalize(a);if(!b.api)b.api=a.api||1,b.newAPI=b.api>=2,b.oldAPI=!b.newAPI;a.options&&(p=c.extend({},p,a.options));e.resolve(a);a.debug&&b.debug("backend-debug",a.debug)});f=="open"&&(A.unshift(r),e.always(function(){var a=c.inArray(r,A);a!==-1&&A.splice(a,1)}));return e};this.diff=function(a){var b={},d=[],e=[],g=[];c.each(a,function(a,c){b[c.hash]=c});c.each(n,function(a){!b[a]&&e.push(a)});c.each(b,function(a,b){var e=
n[a];e?c.each(b,function(a){if(b[a]!=e[a])return g.push(b),false}):d.push(b)});c.each(e,function(a,d){var f=n[d],h=f.phash,i;if(i=h){if(f=f.mime=="directory")if(f=c.inArray(h,e)===-1)if(f=b[h]){var j;a:for(f=g.length;f--;)if(g[f].hash==h){j=true;break a}f=!j}i=f}i&&g.push(b[h])});return{added:d,removed:e,changed:g}};this.sync=function(){var a=this,b=c.Deferred().done(function(){a.trigger("sync")}),d={data:{cmd:"parents",target:m},preventDefault:true};c.when(this.request({data:{cmd:"open",init:1,target:m,
tree:this.ui.tree?1:0},preventDefault:true}),this.request(d)).fail(function(c){b.reject(c);c&&a.request({data:{cmd:"open",target:a.lastDir(""),tree:1,init:1},notify:{type:"open",cnt:1,hideCnt:true}})}).done(function(c,d){var e=a.diff(c.files.concat(d&&d.tree?d.tree:[]));e.removed.length&&a.remove(e);e.added.length&&a.add(e);e.changed.length&&a.change(e);return b.resolve(e)});return b};this.upload=function(a){return this.transport.upload(a,this)};this.bind=function(a,c){var b;if(typeof c=="function"){a=
(""+a).toLowerCase().split(/\s+/);for(b=0;b<a.length;b++)s[a[b]]===void 0&&(s[a[b]]=[]),s[a[b]].push(c)}return this};this.unbind=function(a,c){var b=s[(""+a).toLowerCase()]||[],d=b.indexOf(c);d>-1&&b.splice(d,1);return this};this.trigger=function(a,b){var a=a.toLowerCase(),d=s[a]||[],e;this.debug("event-"+a,b);if(d.length){a=c.Event(a);for(e=0;e<d.length;e++){a.data=c.extend(true,{},b);try{if(d[e](a,this)===false||a.isDefaultPrevented()){this.debug("event-stoped",a.type);break}}catch(f){window.console&&
window.console.log&&window.console.log(f)}}}return this};this.shortcut=function(a){var b,d,e,f,g;if(this.options.allowShortcuts&&a.pattern&&c.isFunction(a.callback)){b=a.pattern.toUpperCase().split(/\s+/);for(f=0;f<b.length;f++)d=b[f],g=d.split("+"),(e=(e=g.pop()).length==1?e>0?e:e.charCodeAt(0):c.ui.keyCode[e])&&!r[d]&&(r[d]={keyCode:e,altKey:c.inArray("ALT",g)!=-1,ctrlKey:c.inArray("CTRL",g)!=-1,shiftKey:c.inArray("SHIFT",g)!=-1,type:a.type||"keydown",callback:a.callback,description:a.description,
pattern:d})}return this};this.shortcuts=function(){var a=[];c.each(r,function(c,d){a.push([d.pattern,b.i18n(d.description)])});return a};this.clipboard=function(a,b){var d=function(){return c.map(y,function(a){return a.hash})};a!==void 0&&(y.length&&this.trigger("unlockfiles",{files:d()}),y=c.map(a||[],function(a){var c=n[a];return c?{hash:a,phash:c.phash,name:c.name,read:c.read,locked:c.locked,cut:!!b}:null}),this.trigger("changeclipboard",{clipboard:y.slice(0,y.length)}),b&&this.trigger("lockfiles",
{files:d()}));return y.slice(0,y.length)};this.isCommandEnabled=function(a){return this._commands[a]?c.inArray(a,p.disabled)===-1:false};this.exec=function(a,b,d){return this._commands[a]&&this.isCommandEnabled(a)?this._commands[a].exec(b,d):c.Deferred().reject("No such command")};this.dialog=function(b,d){return c("<div/>").append(b).appendTo(a).elfinderdialog(d)};this.getUI=function(b){return this.ui[b]||a};this.command=function(a){return a===void 0?this._commands:this._commands[a]};this.resize=
function(b,c){a.css("width",b).height(c).trigger("resize");this.trigger("resize",{width:a.width(),height:a.height()})};this.restoreSize=function(){this.resize(D,B)};this.show=function(){a.show();this.enable().trigger("show")};this.hide=function(){this.disable().trigger("hide");a.hide()};this.destroy=function(){if(a&&a[0].elfinder)this.trigger("destroy").disable(),s={},r={},c(document).add(a).unbind("."+this.namespace),b.trigger=function(){},a.children().remove(),a.append(e.contents()).removeClass(this.cssClass).attr("style",
g),a[0].elfinder=null};if(!c.fn.selectable||!c.fn.draggable||!c.fn.droppable)return alert(this.i18n("errJqui"));if(!a.length)return alert(this.i18n("errNode"));if(!this.options.url)return alert(this.i18n("errURL"));c.extend(c.ui.keyCode,{F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120});this.dragUpload=false;this.xhrUpload=typeof XMLHttpRequestUpload!="undefined"&&typeof File!="undefined"&&typeof FormData!="undefined";this.transport={};if(typeof this.options.transport=="object")this.transport=
this.options.transport,typeof this.transport.init=="function"&&this.transport.init(this);if(typeof this.transport.send!="function")this.transport.send=function(a){return c.ajax(a)};this.transport.upload=="iframe"?this.transport.upload=c.proxy(this.uploads.iframe,this):typeof this.transport.upload=="function"?this.dragUpload=!!this.options.dragUploadAllow:this.xhrUpload?(this.transport.upload=c.proxy(this.uploads.xhr,this),this.dragUpload=true):this.transport.upload=c.proxy(this.uploads.iframe,this);
this.error=function(){var a=arguments[0];return arguments.length==1&&typeof a=="function"?b.bind("error",a):b.trigger("error",{error:a})};c.each("enable,disable,load,open,reload,select,add,remove,change,dblclick,getfile,lockfiles,unlockfiles,dragstart,dragstop,search,searchend,viewchange".split(","),function(a,d){b[d]=function(){var a=arguments[0];return arguments.length==1&&typeof a=="function"?b.bind(d,a):b.trigger(d,c.isPlainObject(a)?a:{})}});this.enable(function(){!k&&b.visible()&&b.ui.overlay.is(":hidden")&&
(k=true,c("texarea,input,button").blur(),a.removeClass("elfinder-disabled"))}).disable(function(){q=k;k=false;a.addClass("elfinder-disabled")}).select(function(a){u=c.map(a.data.selected||a.data.value||[],function(a){return n[a]?a:null})}).error(function(a){var d={cssClass:"elfinder-dialog-error",title:b.i18n(b.i18n("error")),resizable:false,destroyOnClose:true,buttons:{}};d.buttons[b.i18n(b.i18n("btnClose"))]=function(){c(this).elfinderdialog("close")};b.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-error"/>'+
b.i18n(a.data.error),d)}).bind("tree parents",function(a){t(a.data.tree||[])}).bind("tmb",function(a){c.each(a.data.images||[],function(a,b){if(n[a])n[a].tmb=b})}).add(function(a){t(a.data.added||[])}).change(function(a){c.each(a.data.changed||[],function(a,b){var d=b.hash;n[d]=n[d]?c.extend(n[d],b):b})}).remove(function(a){for(var a=a.data.removed||[],b=a.length,d=function(a){var b=n[a];b&&(b.mime=="directory"&&b.dirs&&c.each(n,function(b,c){c.phash==a&&d(b)}),delete n[a])};b--;)d(a[b])}).bind("search",
function(a){t(a.data.files)}).bind("rm",function(){var a=x.canPlayType&&x.canPlayType('audio/wav; codecs="1"');a&&a!=""&&a!="no"&&c(x).html('<source src="./sounds/rm.wav" type="audio/wav">')[0].play()});c.each(this.options.handlers,function(a,c){b.bind(a,c)});this.history=new this.history(this);typeof this.options.getFileCallback=="function"&&this.commands.getfile&&(this.bind("dblclick",function(a){a.preventDefault();b.exec("getfile").fail(function(){b.exec("open")})}),this.shortcut({pattern:"enter",
description:this.i18n("cmdgetfile"),callback:function(){b.exec("getfile").fail(function(){b.exec(b.OS=="mac"?"rename":"open")})}}).shortcut({pattern:"ctrl+enter",description:this.i18n(this.OS=="mac"?"cmdrename":"cmdopen"),callback:function(){b.exec(b.OS=="mac"?"rename":"open")}}));this._commands={};if(!c.isArray(this.options.commands))this.options.commands=[];c.each("open,reload,back,forward,up,home,info,search,quicklook,getfile,help".split(","),function(a,d){c.inArray(d,b.options.commands)===-1&&
b.options.commands.push(d)});c.each(this.options.commands,function(a,d){var e=b.commands[d];if(c.isFunction(e)&&!b._commands[d])e.prototype=C,b._commands[d]=new e,b._commands[d].setup(d,b.options.commandsOptions[d]||{})});a.addClass(this.cssClass).bind(i,function(){!k&&b.enable()});this.ui={workzone:c("<div/>").appendTo(a).elfinderworkzone(this),navbar:c("<div/>").appendTo(a).elfindernavbar(this),contextmenu:c("<div/>").appendTo(a).elfindercontextmenu(this),overlay:c("<div/>").appendTo(a).elfinderoverlay({show:function(){b.disable()},
hide:function(){q&&b.enable()}}),cwd:c("<div/>").appendTo(a).elfindercwd(this),notify:this.dialog("",{cssClass:"elfinder-dialog-notify",position:{top:"12px",right:"12px"},resizable:false,autoOpen:false,title:"&nbsp;",width:280}),statusbar:c('<div class="ui-widget-header ui-helper-clearfix ui-corner-bottom elfinder-statusbar"/>').appendTo(a)};c.each(this.options.ui||[],function(d,e){var f="elfinder"+e,g=b.options.uiOptions[e]||{};!b.ui[e]&&c.fn[f]&&(b.ui[e]=c("<"+(g.tag||"div")+"/>").appendTo(a)[f](b,
g))});a[0].elfinder=this;this.options.resizable&&c.fn.resizable&&a.resizable({handles:"se",alsoResize:b.ui.workzone,minWidth:300,minHeight:200});if(this.options.width)D=this.options.width;this.options.height&&(B=parseInt(this.options.height));b.resize(D,B);c(document).bind("click."+this.namespace,function(d){k&&!c(d.target).closest(a).length&&b.disable()}).bind(j+" "+l,function(a){var d=a.keyCode,e=!(!a.ctrlKey&&!a.metaKey);k&&(c.each(r,function(c,f){f.type==a.type&&f.keyCode==d&&f.shiftKey==a.shiftKey&&
f.ctrlKey==e&&f.altKey==a.altKey&&(a.preventDefault(),a.stopPropagation(),f.callback(a,b),b.debug("shortcut-exec",c+" : "+f.description))}),d==9&&a.preventDefault())});this.trigger("init").request({data:{cmd:"open",target:b.lastDir(),init:1,tree:this.ui.tree?1:0},preventDone:true,notify:{type:"open",cnt:1,hideCnt:true},freeze:true}).fail(function(){b.trigger("fail").disable().lastDir("");s={};r={};c(document).add(a).unbind("."+this.namespace);b.trigger=function(){}}).done(function(a){b.load().debug("api",
b.api);a=c.extend(true,{},a);F(a);b.trigger("open",a)});this.one("load",function(){a.trigger("resize")})};elFinder.prototype={res:function(a,c){return this.resources[a]&&this.resources[a][c]},i18:{en:{translator:"",language:"English",direction:"ltr",messages:{}}},kinds:{unknown:"Unknown",directory:"Folder",symlink:"Alias","symlink-broken":"AliasBroken","application/x-empty":"TextPlain","application/postscript":"Postscript","application/vnd.ms-office":"MsOffice","application/vnd.ms-word":"MsWord",
"application/vnd.ms-excel":"MsExcel","application/vnd.ms-powerpoint":"MsPP","application/pdf":"PDF","application/xml":"XML","application/vnd.oasis.opendocument.text":"OO","application/x-shockwave-flash":"AppFlash","application/flash-video":"Flash video","application/x-bittorrent":"Torrent","application/javascript":"JS","application/rtf":"RTF","application/rtfd":"RTF","application/x-font-ttf":"TTF","application/x-font-otf":"OTF","application/x-rpm":"RPM","application/x-web-config":"TextPlain","application/xhtml+xml":"HTML",
"application/docbook+xml":"DOCBOOK","application/x-awk":"AWK","application/x-gzip":"GZIP","application/x-bzip2":"BZIP","application/zip":"ZIP","application/x-rar":"RAR","application/x-tar":"TAR","application/x-7z-compressed":"7z","application/x-jar":"JAR","text/plain":"TextPlain","text/x-php":"PHP","text/html":"HTML","text/javascript":"JS","text/css":"CSS","text/rtf":"RTF","text/rtfd":"RTF","text/x-c":"C","text/x-csrc":"C","text/x-chdr":"CHeader","text/x-c++":"CPP","text/x-c++src":"CPP","text/x-c++hdr":"CPPHeader",
"text/x-shellscript":"Shell","application/x-csh":"Shell","text/x-python":"Python","text/x-java":"Java","text/x-java-source":"Java","text/x-ruby":"Ruby","text/x-perl":"Perl","text/x-sql":"SQL","text/xml":"XML","text/x-comma-separated-values":"CSV","image/x-ms-bmp":"BMP","image/jpeg":"JPEG","image/gif":"GIF","image/png":"PNG","image/tiff":"TIFF","image/x-targa":"TGA","image/vnd.adobe.photoshop":"PSD","image/xbm":"XBITMAP","image/pxm":"PXM","audio/mpeg":"AudioMPEG","audio/midi":"AudioMIDI","audio/ogg":"AudioOGG",
"audio/mp4":"AudioMPEG4","audio/x-m4a":"AudioMPEG4","audio/wav":"AudioWAV","audio/x-mp3-playlist":"AudioPlaylist","video/x-dv":"VideoDV","video/mp4":"VideoMPEG4","video/mpeg":"VideoMPEG","video/x-msvideo":"VideoAVI","video/quicktime":"VideoMOV","video/x-ms-wmv":"VideoWM","video/x-flv":"VideoFlash","video/x-matroska":"VideoMKV","video/ogg":"VideoOGG"},rules:{defaults:function(a){return!a||a.added&&!c.isArray(a.added)||a.removed&&!c.isArray(a.removed)||a.changed&&!c.isArray(a.changed)?false:true},open:function(a){return a&&
a.cwd&&a.files&&c.isPlainObject(a.cwd)&&c.isArray(a.files)},tree:function(a){return a&&a.tree&&c.isArray(a.tree)},parents:function(a){return a&&a.tree&&c.isArray(a.tree)},tmb:function(a){return a&&a.images&&(c.isPlainObject(a.images)||c.isArray(a.images))},upload:function(a){return a&&(c.isPlainObject(a.added)||c.isArray(a.added))},search:function(a){return a&&a.files&&c.isArray(a.files)}},sorts:{nameDirsFirst:1,kindDirsFirst:2,sizeDirsFirst:3,name:4,kind:5,size:6},commands:{},parseUploadData:function(a){var d;
if(!c.trim(a))return{error:["errResponse","errDataEmpty"]};try{d=c.parseJSON(a)}catch(b){return{error:["errResponse","errDataNotJSON"]}}if(!this.validResponse("upload",d))return{error:["errResponse"]};d=this.normalize(d);d.removed=c.map(d.added||[],function(a){return a.hash});return d},iframeCnt:0,uploads:{iframe:function(a,d){var b=d?d:this,e=a.input,g=c.Deferred().fail(function(a){a&&b.error(a)}).done(function(a){a.warning&&b.error(a.warning);a.removed&&b.remove(a);a.added&&b.add(a);a.changed&&
b.change(a);b.trigger("upload",a)}),h="iframe-"+b.namespace+ ++b.iframeCnt,f=c('<form action="'+b.options.url+'" method="post" enctype="multipart/form-data" encoding="multipart/form-data" target="'+h+'" style="display:none"><input type="hidden" name="cmd" value="upload" /></form>'),i=c.browser.msie,j=function(){p&&clearTimeout(p);m&&clearTimeout(m);q&&b.notify({type:"upload",cnt:-k});setTimeout(function(){i&&c('<iframe src="javascript:false;"/>').appendTo(f);f.remove();l.remove()},100)},l=c('<iframe src="'+
(i?"javascript:false;":"about:blank")+'" name="'+h+'" style="position:absolute;left:-1000px;top:-1000px" />').bind("load",function(){l.unbind("load").bind("load",function(){var a=b.parseUploadData(l.contents().text());j();a.error?g.reject(a.error):g.resolve(a)});m=setTimeout(function(){q=true;b.notify({type:"upload",cnt:k})},b.options.notifyDelay);b.options.iframeTimeout>0&&(p=setTimeout(function(){j();g.reject([errors.connect,errors.timeout])},b.options.iframeTimeout));f.submit()}),k,q,m,p;if(e&&
c(e).is(":file")&&c(e).val())f.append(e);else return g.reject();k=e.files?e.files.length:1;f.append('<input type="hidden" name="'+(b.newAPI?"target":"current")+'" value="'+b.cwd().hash+'"/>').append('<input type="hidden" name="html" value="1"/>').append(c(e).attr("name","upload[]"));c.each(b.options.onlyMimes||[],function(a,b){f.append('<input type="hidden" name="mimes[]" value="'+b+'"/>')});c.each(b.options.customData,function(a,b){f.append('<input type="hidden" name="'+a+'" value="'+b+'"/>')});
f.appendTo("body");l.appendTo("body");return g},xhr:function(a,d){var b=d?d:this,e=c.Deferred().fail(function(a){a&&b.error(a)}).done(function(a){a.warning&&b.error(a.warning);a.removed&&b.remove(a);a.added&&b.add(a);a.changed&&b.change(a);b.trigger("upload",a)}).always(function(){q&&clearTimeout(q);l&&b.notify({type:"upload",cnt:-i,progress:100*i})}),g=new XMLHttpRequest,h=new FormData,f=a.input?a.input.files:a.files,i=f.length,j=5,l=false,k=function(){return setTimeout(function(){l=true;b.notify({type:"upload",
cnt:i,progress:j*i})},b.options.notifyDelay)},q;if(!i)return e.reject();g.addEventListener("error",function(){e.reject("errConnect")},false);g.addEventListener("abort",function(){e.reject(["errConnect","errAbort"])},false);g.addEventListener("load",function(){var a=g.status;if(a>500)return e.reject("errResponse");if(a!=200)return e.reject("errConnect");if(g.readyState!=4)return e.reject(["errConnect","errTimeout"]);if(!g.responseText)return e.reject(["errResponse","errDataEmpty"]);a=b.parseUploadData(g.responseText);
a.error?e.reject(a.error):e.resolve(a)},false);g.upload.addEventListener("progress",function(a){var c=j;a.lengthComputable&&(a=parseInt(a.loaded*100/a.total),a>0&&!q&&(q=k()),a-c>4&&(j=a,l&&b.notify({type:"upload",cnt:0,progress:(j-c)*i})))},false);g.open("POST",b.options.url,true);h.append("cmd","upload");h.append(b.newAPI?"target":"current",b.cwd().hash);c.each(b.options.customData,function(a,b){h.append(a,b)});c.each(b.options.onlyMimes,function(a,b){h.append("mimes["+a+"]",b)});c.each(f,function(a,
b){h.append("upload["+a+"]",b)});g.onreadystatechange=function(){g.readyState==4&&g.status==0&&e.reject(["errConnect","errAbort"])};g.send(h);if(!c.browser.safari||!a.files)q=k();return e}},one:function(a,d){var b=this,e=c.proxy(d,function(a){setTimeout(function(){b.unbind(a.type,e)},3);return d.apply(this,arguments)});return this.bind(a,e)},localStorage:function(a,c){var b=window.localStorage,a="elfinder-"+a+this.id;c!==void 0&&b.setItem(a,c);return b.getItem(a)||""},cookie:function(a,d){var b,e,
a="elfinder-"+a+this.id;if(d===void 0){if(document.cookie&&document.cookie!=""){b=document.cookie.split(";");a+="=";for(e=0;e<b.length;e++)if(b[e]=c.trim(b[e]),b[e].substring(0,a.length)==a)return decodeURIComponent(b[e].substring(a.length))}return""}e=c.extend({},this.options.cookie);if(d===null)d="",e.expires=-1;if(typeof e.expires=="number")b=new Date,b.setTime(b.getTime()+e.expires*864E5),e.expires=b;document.cookie=a+"="+encodeURIComponent(d)+"; expires="+e.expires.toUTCString()+(e.path?"; path="+
e.path:"")+(e.domain?"; domain="+e.domain:"")+(e.secure?"; secure":"");return d},lastDir:function(a){return this.storage("lastdir",a)},_node:c("<span/>"),escape:function(a){return this._node.text(a).html()},normalize:function(a){var d=function(a){if(a&&a.hash&&a.name&&a.mime){if(a.mime=="application/x-empty")a.mime="text/plain";return a}return null};if(a.files)a.files=c.map(a.files,d);if(a.tree)a.tree=c.map(a.tree,d);if(a.added)a.added=c.map(a.added,d);if(a.changed)a.changed=c.map(a.changed,d);if(a.api)a.init=
true;return a},compare:function(a,c){var b=a.mime,e=c.mime,g=b=="directory",h=e=="directory";a.name.toLowerCase();c.name.toLowerCase();var f=g?0:a.size||0,i=h?0:c.size||0,j=this.sort;if(j<=3){if(g&&!h)return-1;if(!g&&h)return 1}return(j==2||j==5)&&b!=e?b>e?1:-1:(j==3||j==6)&&f!=i?f>i?1:-1:a.name.localeCompare(c.name)},sortFiles:function(a){return a.sort(c.proxy(this.compare,this))},notify:function(a){var d=a.type,b=this.messages["ntf"+d]?this.i18n("ntf"+d):this.i18n("ntfsmth"),e=this.ui.notify,g=
e.children(".elfinder-notify-"+d),h=a.cnt,f=a.progress>=0&&a.progress<=100?a.progress:0,i;if(!d)return this;g.length||(g=c('<div class="elfinder-notify elfinder-notify-{type}"><span class="elfinder-dialog-icon elfinder-dialog-icon-{type}"/><span class="elfinder-notify-msg">{msg}</span> <span class="elfinder-notify-cnt"/><div class="elfinder-notify-progressbar"><div class="elfinder-notify-progress"/></div></div>'.replace(/\{type\}/g,d).replace(/\{msg\}/g,b)).appendTo(e).data("cnt",0),f&&g.data({progress:0,
total:0}));d=h+parseInt(g.data("cnt"));if(d>0){if(!a.hideCnt&&g.children(".elfinder-notify-cnt").text("("+d+")"),e.is(":hidden")&&e.elfinderdialog("open"),g.data("cnt",d),f<100&&g.data("total")>=0&&(i=g.data("progress"))>=0)a=h+parseInt(g.data("total")),i=f+i,f=parseInt(i/a),g.data({progress:i,total:a}),e.find(".elfinder-notify-progress").animate({width:(f<100?f:100)+"%"},20)}else g.remove(),!e.children().length&&e.elfinderdialog("close");return this},confirm:function(a){var d=false,b={cssClass:"elfinder-dialog-confirm",
modal:true,resizable:false,title:this.i18n(a.title||"confirmReq"),buttons:{},close:function(){!d&&a.cancel.callback();c(this).elfinderdialog("destroy")}},e=this.i18n("apllyAll"),g;a.reject&&(b.buttons[this.i18n(a.reject.label)]=function(){a.reject.callback(!(!g||!g.prop("checked")));d=true;c(this).elfinderdialog("close")});b.buttons[this.i18n(a.accept.label)]=function(){a.accept.callback(!(!g||!g.prop("checked")));d=true;c(this).elfinderdialog("close")};b.buttons[this.i18n(a.cancel.label)]=function(){c(this).elfinderdialog("close")};
if(a.all){if(a.reject)b.width=370;b.create=function(){g=c('<input type="checkbox" />');c(this).next().children().before(c("<label>"+e+"</label>").prepend(g))};b.open=function(){var a=c(this).next(),b=parseInt(a.children(":first").outerWidth()+a.children(":last").outerWidth());b>parseInt(a.width())&&c(this).closest(".elfinder-dialog").width(b+30)}}return this.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-confirm"/>'+this.i18n(a.text),b)},uniqueName:function(a,c){var b=0,e="",g,a=this.i18n(a),
c=c||this.cwd().hash;if((g=a.indexOf(".txt"))!=-1)e=".txt",a=a.substr(0,g);g=a+e;if(!this.fileByName(g,c))return g;for(;b<1E4;)if(g=a+" "+ ++b+e,!this.fileByName(g,c))return g;return a+Math.random()+e},i18n:function(){var a=this,d=this.messages,b=[],e=[],g=function(b){var c;return b.indexOf("#")===0&&(c=a.file(b.substr(1)))?c.name:b},h,f,i;for(h=0;h<arguments.length;h++)if(i=arguments[h],typeof i=="string")b.push(g(i));else if(c.isArray(i))for(f=0;f<i.length;f++)typeof i[f]=="string"&&b.push(g(i[f]));
for(h=0;h<b.length;h++)c.inArray(h,e)===-1&&(i=b[h],i=d[i]||i,i=i.replace(/\$(\d+)/g,function(a,c){c=h+parseInt(c);c>0&&b[c]&&e.push(c);return b[c]||""}),b[h]=i);return c.map(b,function(a,b){return c.inArray(b,e)===-1?a:null}).join("<br>")},mime2class:function(a){a=a.split("/");return"elfinder-cwd-icon-"+a[0]+(a[0]!="image"&&a[1]?" elfinder-cwd-icon-"+a[1].replace(/(\.|\+)/g,"-"):"")},mime2kind:function(a){var c=typeof a=="object"?a.mime:a,a=a.alias?"Alias":this.kinds[c]?this.kinds[c]:c.indexOf("text")===
0?"Text":c.indexOf("image")===0?"Image":c.indexOf("audio")===0?"Audio":c.indexOf("video")===0?"Video":c.indexOf("application")===0?"App":c;return this.messages["kind"+a]?this.i18n("kind"+a):c},formatDate:function(a){var c=this;return a=="unknown"?c.i18n("dateUnknown"):(""+a).replace(/([a-z]+)\s/i,function(a,e){return c.i18n(e)+" "})},perms2class:function(a){var c="";!a.read&&!a.write?c="elfinder-na":a.read?a.write||(c="elfinder-ro"):c="elfinder-wo";return c},formatPermissions:function(a){var c=[];
a.read&&c.push(this.i18n("read"));a.write&&c.push(this.i18n("write"));return c.length?c.join(" "+this.i18n("and")+" "):this.i18n("noaccess")},formatSize:function(a){var c=1,b="bytes";a>1073741824?(c=1073741824,b="Gb"):a>1048576?(c=1048576,b="Mb"):a>1024&&(c=1024,b="Kb");return(a>0?Math.round(a/c):0)+" "+b},navHash2Id:function(a){return"nav-"+a},navId2Hash:function(a){return typeof a=="string"?a.substr(4):false},log:function(a){window.console&&window.console.log&&window.console.log(a);return this},
debug:function(a,d){var b=this.options.debug;(b=="all"||b===true||c.isArray(b)&&c.inArray(a,b)!=-1)&&window.console&&window.console.log&&window.console.log("elfinder debug: ["+a+"] ["+this.id+"]",d);return this},time:function(a){window.console&&window.console.time&&window.console.time(a)},timeEnd:function(a){window.console&&window.console.timeEnd&&window.console.timeEnd(a)}};elFinder.prototype.version="2.0 beta";c.fn.elfinder=function(a){return a=="instance"?this.getElFinder():this.each(function(){var c=
typeof a=="string"?a:"";this.elfinder||new elFinder(this,typeof a=="object"?a:{});switch(c){case "close":case "hide":this.elfinder.hide();break;case "open":case "show":this.elfinder.show();break;case "destroy":this.elfinder.destroy()}})};c.fn.getElFinder=function(){var a;this.each(function(){if(this.elfinder)return a=this.elfinder,false});return a};elFinder.prototype.options={url:"",requestType:"get",transport:{},dragUploadAllow:"auto",iframeTimeout:0,customData:{token:"42",test:"test"},handlers:{},
lang:"en",cssClass:"",commands:"open,reload,home,up,back,forward,getfile,quicklook,download,rm,duplicate,rename,mkdir,mkfile,upload,copy,cut,paste,edit,extract,archive,search,info,view,help".split(","),commandsOptions:{getfile:{multiple:false,folders:false,oncomplete:""},upload:{ui:"uploadbutton"},quicklook:{autoplay:true,jplayer:"extensions/jplayer"}},getFileCallback:null,ui:["toolbar","places","tree","path","stat"],uiOptions:{toolbar:[["back","forward"],["mkdir","mkfile","upload"],["open","download",
"getfile"],["info"],["quicklook"],["copy","cut","paste"],["rm"],["duplicate","rename","edit"],["extract","archive"],["search"],["view"],["help"]],tree:{openRootOnLoad:true,syncTree:true}},onlyMimes:[],sort:"nameDirsFirst",width:"auto",height:400,resizable:true,notifyDelay:500,allowShortcuts:true,rememberLastDir:true,showFiles:30,showThreshold:50,validName:false,sync:1E3,loadTmbs:5,cookie:{expires:30,domain:"",path:"/",secure:false},contextmenu:{navbar:"open,|,copy,cut,paste,duplicate,|,rm,|,info".split(","),
cwd:"reload,back,|,upload,mkdir,mkfile,paste,|,search,|,info".split(","),files:"getfile,|,open,quicklook,|,download,|,edit,|,copy,cut,paste,duplicate,|,rm,|,archive,extract,|,info".split(",")},debug:["error","warning"]};elFinder.prototype.history=function(a){var d=this,b=true,e=[],g,h=function(){e=[a.cwd().hash];g=0;b=true},f=function(f){return f&&d.canForward()||!f&&d.canBack()?(b=false,a.exec("open",e[f?++g:--g]).fail(h)):c.Deferred().reject()};this.canBack=function(){return g>0};this.canForward=
function(){return g<e.length-1};this.back=f;this.forward=function(){return f(true)};a.open(function(){var c=e.length,d=a.cwd().hash;b&&(g>=0&&c>g+1&&e.splice(g+1),e[e.length-1]!=d&&e.push(d),g=e.length-1);b=true}).reload(h)};elFinder.prototype.command=function(a){this.fm=a;this.title=this.name="";this.state=-1;this.disableOnSearch=this._disabled=this.alwaysEnabled=false;this.updateOnSelect=true;this._handlers={enable:function(){this.update(void 0,this.value)},disable:function(){this.update(-1,this.value)},
"open reload load":function(){this._disabled=!(this.alwaysEnabled||this.fm.isCommandEnabled(this.name));this.update(void 0,this.value);this.change()}};this.handlers={};this.shortcuts=[];this.options={ui:"button"};this.setup=function(a,b){var e=this,g=this.fm,h,f;this.name=a;this.title=g.messages["cmd"+a]?g.i18n("cmd"+a):a;this.options=c.extend({},this.options,b);this.listeners=[];if(this.updateOnSelect)this._handlers.select=function(){this.update(void 0,this.value)};c.each(c.extend({},e._handlers,
e.handlers),function(a,b){g.bind(a,c.proxy(b,e))});for(h=0;h<this.shortcuts.length;h++)f=this.shortcuts[h],f.callback=c.proxy(f.callback||function(){this.exec()},this),!f.description&&(f.description=this.title),g.shortcut(f);this.disableOnSearch&&g.bind("search searchend",function(a){e._disabled=a.type=="search";e.update(void 0,e.value)});this.init()};this.init=function(){};this.exec=function(){return c.Deferred().reject()};this.disabled=function(){return this.state<0};this.enabled=function(){return this.state>
-1};this.active=function(){return this.state>0};this.getstate=function(){return-1};this.update=function(a,c){var e=this.state,g=this.value;this.state=this._disabled?-1:a!==void 0?a:this.getstate();this.value=c;(e!=this.state||g!=this.value)&&this.change()};this.change=function(a){var c;if(typeof a==="function")this.listeners.push(a);else for(c=0;c<this.listeners.length;c++){a=this.listeners[c];try{a(this.state,this.value)}catch(e){this.fm.debug("error",e)}}return this};this.hashes=function(d){return d?
c.map(c.isArray(d)?d:[d],function(c){return a.file(c)?c:null}):a.selected()};this.files=function(a){var b=this.fm;return a?c.map(c.isArray(a)?a:[a],function(a){return b.file(a)||null}):b.selectedFiles()}};elFinder.prototype.resources={"class":{hover:"ui-state-hover",active:"ui-state-active",disabled:"ui-state-disabled",draggable:"ui-draggable",droppable:"ui-droppable",adroppable:"elfinder-droppable-active",cwdfile:"elfinder-cwd-file",cwd:"elfinder-cwd",tree:"elfinder-tree",treeroot:"elfinder-navbar-root",
navdir:"elfinder-navbar-dir",navdirwrap:"elfinder-navbar-dir-wrapper",navarrow:"elfinder-navbar-arrow",navsubtree:"elfinder-navbar-subtree",navcollapse:"elfinder-navbar-collapsed",navexpand:"elfinder-navbar-expanded",treedir:"elfinder-tree-dir",placedir:"elfinder-place-dir",searchbtn:"elfinder-button-search"},tpl:{perms:'<span class="elfinder-perms"/>',symlink:'<span class="elfinder-symlink"/>',navicon:'<span class="elfinder-nav-icon"/>',navspinner:'<span class="elfinder-navbar-spinner"/>',navdir:'<div class="elfinder-navbar-wrapper"><span id="{id}" class="ui-corner-all elfinder-navbar-dir {cssclass}"><span class="elfinder-navbar-arrow"/><span class="elfinder-navbar-icon"/>{symlink}{permissions}{name}</span><div class="elfinder-navbar-subtree"/></div>'},
mimes:{text:"application/x-empty,application/javascript,application/xhtml+xml,audio/x-mp3-playlist,application/x-web-config,application/docbook+xml,application/x-php,application/x-perl,application/x-awk,application/x-config,application/x-csh,application/xml".split(",")},mixin:{make:function(){var a=this.fm,d=this.name,b=a.getUI("cwd"),e=c.Deferred().fail(function(c){c&&a.error(c)}).always(function(){j.remove();i.remove();a.enable()}),g="tmp_"+parseInt(Math.random()*1E5),h=a.cwd().hash,f=new Date,
f={hash:g,name:a.uniqueName(this.prefix),mime:this.mime,read:true,write:true,date:"Today "+f.getHours()+":"+f.getMinutes()},i=b.trigger("create."+a.namespace,f).find("#"+g),j=c('<input type="text"/>').keydown(function(a){a.stopImmediatePropagation();a.keyCode==c.ui.keyCode.ESCAPE?e.reject():a.keyCode==c.ui.keyCode.ENTER&&j.blur()}).mousedown(function(a){a.stopPropagation()}).blur(function(){var b=c.trim(j.val()),f=j.parent();if(f.length){if(!b)return e.reject("errInvName");if(a.fileByName(b,h))return e.reject(["errExists",
b]);f.html(a.escape(b));a.lockfiles({files:[g]});a.request({data:{cmd:d,name:b,target:h},notify:{type:d,cnt:1},preventFail:true,syncOnFail:true}).fail(function(a){e.reject(a)}).done(function(a){e.resolve(a)})}});if(!i.length)return e.reject();a.disable();i.find(".elfinder-cwd-filename").empty("").append(j.val(f.name));j.select().focus();return e}}};c.fn.dialogelfinder=function(a){this.not(".elfinder").each(function(){c(document);var b=c('<div class="ui-widget-header dialogelfinder-drag ui-corner-top">'+
(a.title||"Files")+"</div>");c('<a href="#" class="dialogelfinder-drag-close ui-corner-all"><span class="ui-icon ui-icon-closethick"/></a>').appendTo(b).click(function(a){a.preventDefault();d.dialogelfinder("close")});var d=c(this).addClass("dialogelfinder").css("position","absolute").hide().appendTo("body").draggable({handle:".dialogelfinder-drag"}).elfinder(a).prepend(b);d.elfinder("instance");d.width(parseInt(d.width())||840).data("elfinderDestroyOnClose",!!a.destroyOnClose).find(".elfinder-toolbar").removeClass("ui-corner-top");
a.position&&d.data("elfinderPosition",a.position);a.autoOpen!==false&&c(this).dialogelfinder("open")});if(a=="open"){var d=c(this),b=d.data("elfinderPosition")||{top:parseInt((c(document).height()-d.height())/2-12),left:parseInt((c(document).width()-d.width())/2)},e=100;d.is(":hidden")&&(c("body").find(":visible").each(function(){var a=c(this),b;if(this!==d[0]&&a.css("position")=="absolute"&&(b=parseInt(a.zIndex()))>e)e=b+1}),d.zIndex(e).css(b).show().trigger("resize"),setTimeout(function(){d.trigger("resize").mousedown()},
200))}else a=="close"&&(d=c(this),d.is(":visible")&&(d.data("elfinderDestroyOnClose")?d.elfinder("destroy").remove():d.elfinder("close")));return this};if(elFinder&&elFinder.prototype&&typeof elFinder.prototype.i18=="object")elFinder.prototype.i18.en={translator:"Troex Nevelin &lt;troex@fury.scancode.ru&gt;",language:"English",direction:"ltr",messages:{error:"Error",errUnknown:"Unknown error.",errUnknownCmd:"Unknown command.",errJqui:"Invalid jQuery UI configuration. Selectable, draggable and droppable components must be included.",
errNode:"elFinder requires DOM Element to be created.",errURL:"Invalid elFinder configuration! URL option is not set.",errAccess:"Access denied.",errConnect:"Unable to connect to backend.",errAbort:"Connection aborted.",errTimeout:"Connection timeout.",errNotFound:"Backend not found.",errResponse:"Invalid backend response.",errConf:"Invalid backend configuration.",errJSON:"PHP JSON module not installed.",errNoVolumes:"Readable volumes not available.",errCmdParams:'Invalid parameters for command "$1".',
errDataNotJSON:"Data is not JSON.",errDataEmpty:"Data is empty.",errCmdReq:"Backend request requires command name.",errOpen:'Unable to open "$1".',errNotFolder:"Object is not a folder.",errNotFile:"Object is not a file.",errRead:'Unable to read "$1".',errWrite:'Unable to write into "$1".',errPerm:"Permission denied.",errLocked:'"$1" is locked and can not be renamed, moved or removed.',errExists:'File named "$1" already exists.',errInvName:"Invalid file name.",errFolderNotFound:"Folder not found.",
errFileNotFound:"File not found.",errTrgFolderNotFound:'Target folder "$1" not found.',errPopup:"Browser prevented opening popup window. To open file enable it in browser options.",errMkdir:'Unable to create folder "$1".',errMkfile:'Unable to create file "$1".',errRename:'Unable to rename "$1".',errCopyFrom:'Copying files from volume "$1" not allowed.',errCopyTo:'Copying files to volume "$1" not allowed.',errUploadCommon:"Upload error.",errUpload:'Unable to upload "$1".',errUploadNoFiles:"No files found for upload.",
errMaxSize:"Data exceeds the maximum allowed size.",errFileMaxSize:"File exceeds maximum allowed size.",errUploadMime:"File type not allowed.",errUploadTransfer:'"$1" transfer error.',errSave:'Unable to save "$1".',errCopy:'Unable to copy "$1".',errMove:'Unable to move "$1".',errCopyInItself:'Unable to copy "$1" into itself.',errRm:'Unable to remove "$1".',errExtract:'Unable to extract files from "$1".',errArchive:"Unable to create archive.",errArcType:"Unsupported archive type.",errNoArchive:"File is not archive or has unsupported archive type.",
errCmdNoSupport:"Backend does not support this command.",cmdarchive:"Create archive",cmdback:"Back",cmdcopy:"Copy",cmdcut:"Cut",cmddownload:"Download",cmdduplicate:"Duplicate",cmdedit:"Edit file",cmdextract:"Extract files from archive",cmdforward:"Forward",cmdgetfile:"Select files",cmdhelp:"About this software",cmdhome:"Home",cmdinfo:"Get info",cmdmkdir:"New folder",cmdmkfile:"New text file",cmdopen:"Open",cmdpaste:"Paste",cmdquicklook:"Preview",cmdreload:"Reload",cmdrename:"Rename",cmdrm:"Delete",
cmdsearch:"Find files",cmdup:"Go to parent directory",cmdupload:"Upload files",cmdview:"View",btnClose:"Close",btnSave:"Save",btnRm:"Remove",btnCancel:"Cancel",btnNo:"No",btnYes:"Yes",ntfopen:"Open folder",ntffile:"Open file",ntfreload:"Reload folder content",ntfmkdir:"Creating directory",ntfmkfile:"Creating files",ntfrm:"Delete files",ntfcopy:"Copy files",ntfmove:"Move files",ntfprepare:"Prepare to copy files",ntfrename:"Rename files",ntfupload:"Uploading files",ntfdownload:"Downloading files",ntfsave:"Save files",
ntfarchive:"Creating archive",ntfextract:"Extracting files from archive",ntfsearch:"Searching files",ntfsmth:"Doing something >_<",dateUnknown:"unknown",Today:"Today",Yesterday:"Yesterday",Jan:"Jan",Feb:"Feb",Mar:"Mar",Apr:"Apr",May:"May",Jun:"Jun",Jul:"Jul",Aug:"Aug",Sep:"Sep",Oct:"Oct",Nov:"Nov",Dec:"Dec",confirmReq:"Confirmation required",confirmRm:"Are you sure you want to remove files?<br/>This cannot be undone!",confirmRepl:"Replace old file with new one?",apllyAll:"Apply to all",name:"Name",
size:"Size",perms:"Permissions",modify:"Modified",kind:"Kind",read:"read",write:"write",noaccess:"no access",and:"and",unknown:"unknown",selectall:"Select all files",selectfiles:"Select file(s)",selectffile:"Select first file",selectlfile:"Select last file",viewlist:"List view",viewicons:"Icons view",places:"Places",calc:"Calculate",path:"Path",aliasfor:"Alias for",locked:"Locked",dim:"Dimensions",files:"Files",folders:"Folders",items:"Items",yes:"yes",no:"no",link:"Link",searcresult:"Search results",
selected:"selected items",about:"About",shortcuts:"Shortcuts",help:"Help",webfm:"Web file manager",ver:"Version",protocol:"protocol version",homepage:"Project home",docs:"Documentation",github:"Fork us on Github",twitter:"Follow us on twitter",facebook:"Join us on facebook",team:"Team",chiefdev:"chief developer",developer:"developer",contributor:"contributor",maintainer:"maintainer",translator:"translator",icons:"Icons",dontforget:"and don't forget to take your towel",shortcutsof:"Shortcuts disabled",
dropFiles:"Drop files here",or:"or",selectForUpload:"Select files to upload",moveFiles:"Move files",copyFiles:"Copy files",kindUnknown:"Unknown",kindFolder:"Folder",kindAlias:"Alias",kindAliasBroken:"Broken alias",kindApp:"Application",kindPostscript:"Postscript document",kindMsOffice:"Microsoft Office document",kindMsWord:"Microsoft Word document",kindMsExcel:"Microsoft Excel document",kindMsPP:"Microsoft Powerpoint presentation",kindOO:"Open Office document",kindAppFlash:"Flash application",kindPDF:"Portable Document Format (PDF)",
kindTorrent:"Bittorrent file",kind7z:"7z archive",kindTAR:"TAR archive",kindGZIP:"GZIP archive",kindBZIP:"BZIP archive",kindZIP:"ZIP archive",kindRAR:"RAR archive",kindJAR:"Java JAR file",kindTTF:"True Type font",kindOTF:"Open Type font",kindRPM:"RPM package",kindText:"Text document",kindTextPlain:"Plain text",kindPHP:"PHP source",kindCSS:"Cascading style sheet",kindHTML:"HTML document",kindJS:"Javascript source",kindRTF:"Rich Text Format",kindC:"C source",kindCHeader:"C header source",kindCPP:"C++ source",
kindCPPHeader:"C++ header source",kindShell:"Unix shell script",kindPython:"Python source",kindJava:"Java source",kindRuby:"Ruby source",kindPerl:"Perl script",kindSQL:"SQL source",kindXML:"XML document",kindAWK:"AWK source",kindCSV:"Comma separated values",kindDOCBOOK:"Docbook XML document",kindImage:"Image",kindBMP:"BMP image",kindJPEG:"JPEG image",kindGIF:"GIF Image",kindPNG:"PNG Image",kindTIFF:"TIFF image",kindTGA:"TGA image",kindPSD:"Adobe Photoshop image",kindXBITMAP:"X bitmap image",kindPXM:"Pixelmator image",
kindAudio:"Audio media",kindAudioMPEG:"MPEG audio",kindAudioMPEG4:"MPEG-4 audio",kindAudioMIDI:"MIDI audio",kindAudioOGG:"Ogg Vorbis audio",kindAudioWAV:"WAV audio",AudioPlaylist:"MP3 playlist",kindVideo:"Video media",kindVideoDV:"DV movie",kindVideoMPEG:"MPEG movie",kindVideoMPEG4:"MPEG-4 movie",kindVideoAVI:"AVI movie",kindVideoMOV:"Quick Time movie",kindVideoWM:"Windows Media movie",kindVideoFlash:"Flash movie",kindVideoMKV:"Matroska movie",kindVideoOGG:"Ogg movie"}};c.fn.elfinderbutton=function(a){return this.each(function(){var d=
a.fm,b=d.res("class","disabled"),e=d.res("class","active"),g=d.res("class","hover"),h,f=c(this).addClass("ui-state-default elfinder-button").attr("title",a.title).append('<span class="elfinder-button-icon elfinder-button-icon-'+a.name+'"/>').hover(function(){!f.is("."+b)&&f.toggleClass(g)}).click(function(c){f.is("."+b)||(h&&a.variants.length>1?(h.is(":hidden")&&a.fm.getUI().click(),c.stopPropagation(),h.slideToggle(100)):a.exec())}),d=function(){h.hide()};c.isArray(a.variants)&&(f.addClass("elfinder-menubutton"),
h=c('<div class="ui-widget ui-widget-content elfinder-button-menu ui-corner-all"/>').hide().appendTo(f).zIndex(10+f.zIndex()).delegate(".elfinder-button-menu-item","hover",function(){c(this).toggleClass(g)}).delegate(".elfinder-button-menu-item","click",function(b){b.preventDefault();a.exec(a.fm.selected(),c(this).data("value"))}),a.fm.bind("disable select",d).getUI().click(d),a.change(function(){h.html("");c.each(a.variants,function(a,b){h.append(c('<div class="elfinder-button-menu-item">'+b[1]+
"</div>").data("value",b[0]))})}));a.change(function(){a.disabled()?f.removeClass(e).addClass(b):(f.removeClass(b),f[a.active()?"addClass":"removeClass"](e))}).change()})};c.fn.elfindercontextmenu=function(a){return this.each(function(){var d=c.browser.opera?"click":"contextmenu",b=a.res("class","hover"),e=a.res("class","disabled"),g=a.res("class","cwdfile"),h=a.res("class","treedir"),f=a.res("class","navdirwrap"),i=a.direction=="ltr"?"left":"right",j=c(this).addClass("ui-helper-reset ui-widget ui-state-default ui-corner-all elfinder-contextmenu elfinder-contextmenu-"+
a.direction).hide().appendTo("body").delegate(".elfinder-contextmenu-item","hover",function(){var a=c(this).toggleClass(b);a.is(".elfinder-contextmenu-group")&&a.children(".elfinder-contextmenu-sub").toggle()}).delegate(".elfinder-contextmenu-item","click",function(b){var d=c(this),e=d.data();b.preventDefault();b.stopPropagation();d.is(".elfinder-contextmenu-group")||(e&&e.cmd&&a.exec(e.cmd,j.data("targets"),e.variant,true),q())}),l=c.extend({navbar:[],cwd:[]},a.options.contextmenu),k=function(b,
d){var e=l[b],f=false;j.text("").data("targets",d);c.each(e,function(b,e){var g=a.command(e),h,i;!g||!g.name?e=="|"&&f&&(j.append('<div class="elfinder-contextmenu-separator"/>'),f=false):g.getstate(d)!=-1&&(h=c('<div class="elfinder-contextmenu-item"><span class="elfinder-button-icon elfinder-button-icon-'+g.name+' elfinder-contextmenu-icon"/><span>'+g.title+"</span></div>").data({cmd:g.name}),g.variants&&(i=c('<div class="ui-corner-all elfinder-contextmenu-sub"/>').appendTo(h.addClass("elfinder-contextmenu-group").append('<span class="elfinder-contextmenu-arrow"/>')),
c.each(g.variants,function(a,b){i.append(c('<div class="elfinder-contextmenu-item"><span>'+b[1]+"</span></div>").data({cmd:g.name,variant:b[0]}))})),j.append(h),f=true)})},q=function(){j.hide().text("").removeData("targets")},m=function(b,d){var e=c(window),f=j.outerWidth(),g=j.outerHeight(),h=e.width(),l=e.height(),k=e.scrollTop(),e=e.scrollLeft(),f={top:(d+g<l?d:d-g>0?d-g:d)+k,left:(b+f<h?b:b-f)+e,"z-index":100+a.getUI("workzone").zIndex()};j.children().length&&(j.css(f).show(),f={"z-index":f["z-index"]+
10},f[i]=parseInt(j.width()),j.find(".elfinder-contextmenu-sub").css(f))},p;a.one("load",function(){p=a.getUI("cwd").bind(d,function(b){var d=c(b.target).closest("."+g),f=[],h="files";b.preventDefault();if(d.length){if(d.is("."+e))return;p.trigger("selectfile",d.attr("id"));f=a.selected()}else p.trigger("unselectall"),f.push(a.cwd().hash),h="cwd";k(h,f);m(b.clientX,b.clientY)});a.getUI("navbar").bind(d,function(b){var d=c(b.target),e=[];b.preventDefault();d.is("."+h+",."+f)&&(d.is("."+f)&&(d=d.children("."+
h)),d.length&&(e.push(a.navId2Hash(d.attr("id"))),k("navbar",e),m(b.clientX,b.clientY)))});a.bind("disable select",q).getUI().click(q)}).one("destroy",function(){j.remove()})})};c.fn.elfindercwd=function(a){this.not(".elfinder-cwd").each(function(){var d=a.storage("view")=="list",b="select."+a.namespace,e="unselect."+a.namespace,g="disable."+a.namespace,h="enable."+a.namespace,f=a.res("class","cwdfile"),i="."+f,j=a.res("class","disabled"),l=a.res("class","draggable"),k=a.res("class","droppable"),
q=a.res("class","hover"),m=a.res("class","adroppable"),p=f+"-tmp",n=a.options.loadTmbs>0?a.options.loadTmbs:5,u={icon:'<div id="{hash}" class="'+f+' {permsclass} {dirclass} ui-corner-all"><div class="elfinder-cwd-file-wrapper ui-corner-all"><div class="elfinder-cwd-icon {mime} ui-corner-all" unselectable="on" {style}/>{marker}</div><div class="elfinder-cwd-filename" title="{name}">{name}</div></div>',row:'<tr id="{hash}" class="'+f+' {permsclass} {dirclass}"><td><div class="elfinder-cwd-file-wrapper"><span class="elfinder-cwd-icon {mime}"/>{marker}<span class="elfinder-cwd-filename">{name}</span></div></td><td>{perms}</td><td>{date}</td><td>{size}</td><td>{kind}</td></tr>'},
s=a.res("tpl","perms"),r=a.res("tpl","symlink"),y={permsclass:function(c){return a.perms2class(c)},perms:function(c){return a.formatPermissions(c)},dirclass:function(a){return a.mime=="directory"?"directory":""},mime:function(c){return a.mime2class(c.mime)},size:function(c){return a.formatSize(c.size)},date:function(c){return a.formatDate(c.date)},kind:function(c){return a.mime2kind(c)},marker:function(a){return(a.alias||a.mime=="symlink-broken"?r:"")+(!a.read||!a.write?s:"")}},A=function(c){c.name=
a.escape(c.name);return u[d?"row":"icon"].replace(/\{([a-z]+)\}/g,function(a,b){return y[b]?y[b](c):c[b]?c[b]:""})},C=false,D=function(a,f){function g(a,c){return a[c+"All"]("[id]:not(."+j+"):first")}var h=c.ui.keyCode,i=a==h.LEFT||a==h.UP,l=o.find("[id].ui-selected"),k,r,q;if(l.length)if(k=l.filter(i?":first":":last"),r=g(k,i?"prev":"next"),r.length)if(d||a==h.LEFT||a==h.RIGHT)h=r;else if(q=k.position().top,r=k.position().left,h=k,i){do h=h.prev("[id]");while(h.length&&!(h.position().top<q&&h.position().left<=
r));h.is("."+j)&&(h=g(h,"next"))}else{do h=h.next("[id]");while(h.length&&!(h.position().top>q&&h.position().left>=r));h.is("."+j)&&(h=g(h,"prev"));h.length||(r=o.find("[id]:not(."+j+"):last"),r.position().top>q&&(h=r))}else h=k;else h=o.find("[id]:not(."+j+"):"+(i?"last":"first"));h&&h.length&&(f?h=k.add(k[i?"prevUntil":"nextUntil"]("#"+h.attr("id"))).add(h):l.trigger(e),h.trigger(b),z(h.filter(i?":first":":last")),t())},B=function(a){o.find("#"+a).trigger(b)},x=function(){o.find("[id].ui-selected").trigger(e)},
F=function(){return c.map(o.find("[id].ui-selected"),function(a){a=c(a);return a.is("."+j)?null:c(a).attr("id")})},t=function(){a.trigger("select",{selected:F()})},z=function(a){var c=a.position().top,a=a.outerHeight(true),b=o.innerHeight(),d=o.scrollTop();c<0?o.scrollTop(Math.ceil(c+d)-9):c+a>b&&o.scrollTop(Math.ceil(c+a-b+d))},w=[],G=function(a){for(var c=w.length;c--;)if(w[c].hash==a)return c;return-1},E="scroll."+a.namespace,v=function(){var b=[],e=false,f=[],g={},b=o.find("[id]:last"),h=!b.length,
i=d?o.children("table").children("tbody"):o,j;if(!w.length)return o.unbind(E);for(;(!b.length||o.innerHeight()-b.position().top+a.options.showThreshold>0)&&(j=w.splice(0,a.options.showFiles)).length;)b=c.map(j,function(a){if(a.hash&&a.name){a.mime=="directory"&&(e=true);if(a.tmb)a.tmb===1?f.push(a.hash):g[a.hash]=a.tmb;return A(a)}return null}),i.append(b.join("")),b=o.find("[id]:last"),h&&o.scrollTop(0);I(g);f.length&&H(f);e&&K()},f=c.extend({},a.droppable,{over:function(b,d){var e=a.cwd().hash;
c.each(d.helper.data("files"),function(c,b){if(a.file(b).phash==e)return o.removeClass(m),false})}}),K=function(){setTimeout(function(){o.find(".directory:not(."+k+",.elfinder-na,.elfinder-ro)").droppable(a.droppable)},20)},I=function(b){var d=a.option("tmbUrl"),e=true,f;c.each(b,function(a,b){var g=o.find("#"+a);if(g.length)(function(a,b){c("<img/>").load(function(){a.find(".elfinder-cwd-icon").css("background","url('"+b+"') center center no-repeat")}).attr("src",b)})(g,d+b);else if(e=false,(f=G(a))!=
-1)w[f].tmb=b});return e},H=function(c){var b=[];a.oldAPI?a.request({data:{cmd:"tmb",current:a.cwd().hash},preventFail:true}).done(function(a){I(a.images||[])&&a.tmb&&H()}):(b=b=c.splice(0,n),b.length&&a.request({data:{cmd:"tmb",targets:b},preventFail:true}).done(function(a){I(a.images||[])&&H(c)}))},M=function(c){for(var b=d?o.find("tbody"):o,e=c.length,f=[],g={},h=false,i=function(c){for(var b=o.find("[id]:first"),d;b.length;){if((d=a.file(b.attr("id")))&&a.compare(c,d)<0)return b;b=b.next("[id]")}},
j=function(c){var b=w.length,d;for(d=0;d<b;d++)if(a.compare(c,w[d])<0)return d;return b||-1},k,l,r,q;e--;)if(k=c[e],l=k.hash,!o.find("#"+l).length&&((r=i(k))&&r.length?r.before(A(k)):(q=j(k))>=0?w.splice(q,0,k):b.append(A(k)),o.find("#"+l).length))if(k.mime=="directory")h=true;else if(k.tmb)k.tmb===1?f.push(l):g[l]=k.tmb;I(g);f.length&&H(f);h&&K()},L=function(c){for(var b=c.length,d,e,f;b--;)if(d=c[b],(e=o.find("#"+d)).length)try{e.detach()}catch(g){a.debug("error",g)}else(f=G(d))!=-1&&w.splice(f,
1)},N=a.i18n("name"),O=a.i18n("perms"),P=a.i18n("modify"),Q=a.i18n("size"),R=a.i18n("kind"),J=function(b,e){var f=a.cwd().hash;try{o.children("table,"+i).remove().end()}catch(g){o.html("")}o.removeClass("elfinder-cwd-view-icons elfinder-cwd-view-list").addClass("elfinder-cwd-view-"+(d?"list":"icons"));d&&o.html('<table><thead><tr class="ui-state-default"><td >'+N+"</td><td>"+O+"</td><td>"+P+"</td><td>"+Q+"</td><td>"+R+"</td></tr></thead><tbody/></table>");w=c.map(b,function(a){return e||a.phash==
f?a:null});w=a.sortFiles(w);o.bind(E,v).trigger(E);t()},o=c(this).addClass("elfinder-cwd").attr("unselectable","on").delegate(i,"click."+a.namespace,function(a){var d=this.id?c(this):c(this).parents("[id]:first"),f=d.prevAll(".ui-selected:first"),g=d.nextAll(".ui-selected:first"),h=f.length,i=g.length;a.stopImmediatePropagation();a.shiftKey&&(h||i)?(a=h?d.prevUntil("#"+f.attr("id")):d.nextUntil("#"+g.attr("id")),a.add(d).trigger(b)):a.ctrlKey||a.metaKey?d.trigger(d.is(".ui-selected")?e:b):(o.find("[id].ui-selected").trigger(e),
d.trigger(b));t()}).delegate(i,"dblclick."+a.namespace,function(){a.dblclick({file:this.id})}).delegate(i,"mouseenter."+a.namespace,function(){var b=c(this),e=d?b:b.children();!b.is("."+p)&&!e.is("."+l+",."+j)&&e.draggable(a.draggable)}).delegate(i,"dropover",function(a,b){var d=c(this);a.preventDefault();a.stopImmediatePropagation();o.droppable("disable").removeClass(j+" "+m);c.inArray(d.attr("id"),b.helper.data("files"))===-1?d.children().addClass(q):d.removeClass(m)}).delegate(i,"dropout drop",
function(a){var b=c(this);a.preventDefault();a.stopImmediatePropagation();o.droppable("enable").trigger("dropover");b.removeClass(m);b.is(".ui-selected")||b.children().removeClass(q)}).delegate(i,b,function(){var a=c(this);!C&&!a.is("."+j)&&a.addClass("ui-selected").children().addClass(q)}).delegate(i,e,function(){!C&&c(this).removeClass("ui-selected").children().removeClass(q)}).delegate(i,g,function(){var a=c(this).removeClass("ui-selected").addClass(j),b=(d?a:a.children()).removeClass(q);a.is("."+
k)&&a.droppable("disable");b.is("."+l)&&b.draggable("disable");!d&&b.removeClass(j)}).delegate(i,h,function(){var a=c(this).removeClass(j),b=d?a:a.children();a.is("."+k)&&a.droppable("enable");b.is("."+l)&&b.draggable("enable")}).delegate(i,"scrolltoview",function(){z(c(this))}).selectable({filter:i,stop:t,selected:function(a,d){c(d.selected).trigger(b)},unselected:function(a,b){c(b.unselected).trigger(e)}}).droppable(f).bind("create."+a.namespace,function(a,b){var e=d?o.find("tbody"):o;o.trigger("unselectall");
e.prepend(c(A(b)).addClass(p));o.scrollTop(0)}).bind("unselectall",function(){o.find("[id].ui-selected").trigger(e);t()}).bind("selectfile",function(a,c){o.find("#"+c).trigger(b);t()}),S=c(this).parent().resize(function(){var a=0;o.siblings(".elfinder-panel:visible").each(function(){a+=c(this).outerHeight(true)});o.height(S.height()-T-a)}).children(".elfinder-workzone").append(this),T=o.outerHeight(true)-o.height();a.dragUpload&&(o[0].addEventListener("dragenter",function(a){a.preventDefault();a.stopPropagation();
o.addClass(m)},false),o[0].addEventListener("dragleave",function(a){a.preventDefault();a.stopPropagation();o.removeClass(m)},false),o[0].addEventListener("dragover",function(a){a.preventDefault();a.stopPropagation()},false),o[0].addEventListener("drop",function(b){b.preventDefault();o.removeClass(m);b.dataTransfer&&b.dataTransfer.files&&b.dataTransfer.files.length&&a.upload({files:b.dataTransfer.files})},false));a.bind("open search",function(a){J(a.data.files,a.type=="search")}).searchend(function(){J(a.files())}).bind("viewchange",
function(){var b=a.selected(),e=a.storage("view")=="list";e!=d&&(d=e,J(a.files()),c.each(b,function(a,b){B(b)}),t())}).add(function(b){var d=a.cwd().hash;M(c.map(b.data.added||[],function(a){return a.phash==d?a:null}))}).change(function(b){var d=a.cwd().hash,e=a.selected();c.each(c.map(b.data.changed||[],function(a){return a.phash==d?a:null}),function(a,b){L([b.hash]);M([b]);c.inArray(b.hash,e)!==-1&&B(b.hash)});t()}).remove(function(a){L(a.data.removed||[]);t()}).dragstart(function(a){var d=c(a.data.target),
a=a.data.originalEvent;d.is(i)&&(d.is(".ui-selected")||(!a.ctrlKey&&!a.metaKey&&!a.shiftKey&&x(),d.trigger(b),t()),o.droppable("disable"));o.selectable("disable").removeClass(j);C=true}).dragstop(function(){o.selectable("enable");C=false}).bind("lockfiles unlockfiles",function(a){for(var b=a.type=="lockfiles"?g:h,a=a.data.files||[],c=a.length;c--;)o.find("#"+a[c]).trigger(b);t()}).bind("mkdir mkfile duplicate upload rename archive",function(b){var d=a.cwd().hash;o.trigger("unselectall");c.each(b.data.added||
[],function(a,b){b&&b.phash==d&&B(b.hash)});t()}).shortcut({pattern:"ctrl+a",description:"selectall",callback:function(){o.find("[id]:not(.ui-selected)").trigger(b);t()}}).shortcut({pattern:"left right up down shift+left shift+right shift+up shift+down",description:"selectfiles",type:"keydown",callback:function(a){D(a.keyCode,a.shiftKey)}}).shortcut({pattern:"home",description:"selectffile",callback:function(){x();o.find("[id]:first").trigger(b);t()}}).shortcut({pattern:"end",description:"selectlfile",
callback:function(){x();o.find("[id]:last").trigger(b);t()}})});return this};c.fn.elfinderdialog=function(a){var d;if(typeof a=="string"&&(d=this.closest(".ui-dialog")).length)a=="open"&&d.is(":hidden")?d.fadeIn(150,function(){d.trigger("open")}):a=="close"&&d.is(":visible")?d.hide().trigger("close"):a=="destroy"&&d.hide().remove();a=c.extend({},c.fn.elfinderdialog.defaults,a);this.filter(":not(.ui-dialog-content)").each(function(){var b=c(this).addClass("ui-dialog-content ui-widget-content"),d=b.parent(),
g=parseInt(Math.random()*1E6),h=d.children(".elfinder-overlay"),f=c('<div class="ui-dialog-buttonset"/>'),i=c('<div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"/>').append(f),j=c('<div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable std42-dialog  elfinder-dialog '+a.cssClass+'"/>').hide().append(b).appendTo(d).draggable({handle:".ui-dialog-titlebar"}).css({width:a.width,height:a.height}).mousedown(function(a){a.stopPropagation();c(document).mousedown();
j.is(".elfinder-dialog-active")||(d.find(".elfinder-dialog:visible").removeClass("elfinder-dialog-active"),j.addClass("elfinder-dialog-active").zIndex(l()+1))}).bind("open",function(){a.modal&&h.elfinderoverlay("show");j.mousedown().find(".ui-button:first").focus();j.find(":text:first").focus();typeof a.open=="function"&&c.proxy(a.open,b[0])();j.is(".elfinder-dialog-notify")||d.find(".elfinder-dialog:visible").not(".elfinder-dialog-notify").each(function(){var a=c(this),b=parseInt(a.css("top")),d=
parseInt(a.css("left")),e=parseInt(j.css("top")),f=parseInt(j.css("left"));a[0]!=j[0]&&(b>=e||d>=f)&&j.css({top:b+10+"px",left:d+10+"px"})})}).bind("close",function(){var f=d.find(".elfinder-dialog:visible"),g=l();a.modal&&h.elfinderoverlay("hide");f.length?f.each(function(){var a=c(this);if(a.zIndex()>=g)return a.mousedown(),false}):d.mousedown();typeof a.close=="function"?c.proxy(a.close,b[0])():a.destroyOnClose&&j.hide().remove()}),l=function(){var a=d.zIndex()+10;d.find(".elfinder-dialog:visible").each(function(){var b;
this!=j[0]&&(b=c(this).zIndex(),b>a&&(a=b))});return a},k;if(!a.position)k=parseInt((d.height()-j.outerHeight())/2-42),a.position={top:(k>0?k:0)+"px",left:parseInt((d.width()-j.outerWidth())/2)+"px"};j.css(a.position);a.closeOnEscape&&c(document).bind("keyup."+g,function(a){a.keyCode==c.ui.keyCode.ESCAPE&&j.is(".elfinder-dialog-active")&&(b.elfinderdialog("close"),c(document).unbind("keyup."+g))});j.prepend(c('<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix">'+a.title+
"</div>").prepend(c('<a href="#" class="ui-dialog-titlebar-close ui-corner-all"><span class="ui-icon ui-icon-closethick"/></a>').mousedown(function(a){a.preventDefault();b.elfinderdialog("close")})));c.each(a.buttons,function(a,d){var e=c('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">'+a+"</span></button>").click(c.proxy(d,b[0])).hover(function(a){c(this)[a.type=="mouseenter"?"focus":"blur"]()}).focus(function(){c(this).addClass("ui-state-hover")}).blur(function(){c(this).removeClass("ui-state-hover")}).keydown(function(a){a.keyCode==
c.ui.keyCode.ENTER?c(this).click():a.keyCode==c.ui.keyCode.TAB&&(a=c(this).next(".ui-button"),a.length?a.focus():c(this).parent().children(".ui-button:first").focus())});f.append(e)});f.children().length&&j.append(i);a.resizable&&c.fn.resizable&&j.resizable({minWidth:a.minWidth,minHeight:a.minHeight,alsoResize:this});typeof a.create=="function"&&c.proxy(a.create,this)();a.autoOpen&&b.elfinderdialog("open")});return this};c.fn.elfinderdialog.defaults={cssClass:"",title:"",modal:false,resizable:true,
autoOpen:true,closeOnEscape:true,buttons:{},position:null,width:300,height:"auto",minWidth:200,minHeight:110};c.fn.elfindernavbar=function(a){this.not(".elfinder-navbar").each(function(){var d=c(this).addClass("ui-state-default elfinder-navbar"),b=d.parent().resize(function(){d.height(e.height()-g)}),e=b.children(".elfinder-workzone").append(d),g=d.outerHeight()-d.height(),h=a.direction=="ltr",f;c.fn.resizable&&(f=d.resizable({handles:h?"e":"w"}).scroll(function(){f.css("top",parseInt(d.scrollTop())+
"px")}).find(".ui-resizable-handle").zIndex(d.zIndex()+10),h||d.resize(function(){d.css("left",null).css("right",0)}),a.one("open",function(){setTimeout(function(){b.trigger("resize")},100)}))});return this};c.fn.elfinderoverlay=function(a){this.filter(":not(.elfinder-overlay)").each(function(){a=c.extend({},a);c(this).addClass("ui-widget-overlay elfinder-overlay").hide().mousedown(function(a){a.preventDefault();a.stopPropagation()}).data({cnt:0,show:typeof a.show=="function"?a.show:function(){},
hide:typeof a.hide=="function"?a.hide:function(){}})});if(a=="show"){var d=this.eq(0),b=d.data("cnt")+1,e=d.data("show");d.data("cnt",b);d.is(":hidden")&&(d.zIndex(d.parent().zIndex()+1),d.show(),e())}a=="hide"&&(d=this.eq(0),b=d.data("cnt")-1,e=d.data("hide"),d.data("cnt",b),b==0&&d.is(":visible")&&(d.hide(),e()));return this};c.fn.elfinderpanel=function(a){return this.each(function(){var d=c(this).addClass("elfinder-panel ui-state-default ui-corner-all"),b="margin-"+(a.direction=="ltr"?"left":"right");
a.one("load",function(){var c=a.getUI("navbar");d.css(b,parseInt(c.outerWidth(true)));c.bind("resize",function(){d.is(":visible")&&d.css(b,parseInt(c.outerWidth(true)))})})})};c.fn.elfinderpath=function(a){return this.each(function(){var d=c(this).addClass("elfinder-path").html("&nbsp;").delegate("a","click",function(b){var d=c(this).attr("href").substr(1);b.preventDefault();d!=a.cwd().hash&&a.exec("open",d)}).prependTo(a.getUI("statusbar").show());a.bind("open searchend",function(){var b=[];c.each(a.parents(a.cwd().hash),
function(c,d){b.push('<a href="#'+d+'">'+a.escape(a.file(d).name)+"</a>")});d.html(b.join(a.option("separator")))}).bind("search",function(){d.html(a.i18n("searcresult"))})})};c.fn.elfinderplaces=function(a,d){return this.each(function(){var b=[],e=a.res("class","navdir"),g=a.res("class","navcollapse"),h=a.res("class","navexpand");a.res("class","hover");var f=a.res("tpl","navdir"),i=a.res("tpl","perms"),j=c(a.res("tpl","navspinner")),l=function(a){return a.substr(6)},k=function(){a.storage("places",
b.join(","))},q=function(b){return c(f.replace(/\{id\}/,"place-"+b.hash).replace(/\{name\}/,a.escape(b.name)).replace(/\{cssclass\}/,a.perms2class(b)).replace(/\{permissions\}/,!b.read||!b.write?i:"").replace(/\{symlink\}/,""))},m=function(d){var f=q(d);s.children().length&&c.each(s.children(),function(){var a=c(this);if(d.name.localeCompare(a.children("."+e).text())<0)return!f.insertBefore(a)});b.push(d.hash);!f.parent().length&&s.append(f);u.addClass(g);f.draggable({appendTo:"body",revert:false,
helper:function(){var b=c(this);b.children().removeClass("ui-state-hover");return c('<div class="elfinder-place-drag elfinder-'+a.direction+'"/>').append(b.clone()).data("hash",l(b.children(":first").attr("id")))},start:function(){c(this).hide()},stop:function(a,b){var d=r.offset().top,e=r.offset().left,f=r.width(),g=r.height(),h=a.clientX,i=a.clientY;h>e&&h<e+f&&i>d&&i<i+g?c(this).show():(p(b.helper.data("hash")),k())}})},p=function(a){var d=c.inArray(a,b);d!==-1&&(b.splice(d,1),s.find("#place-"+
a).parent().remove(),!s.children().length&&u.removeClass(g+" "+h))},n=q({hash:"root-"+a.namespace,name:a.i18n(d.name,"places"),read:true,write:true}),u=n.children("."+e).addClass(a.res("class","treeroot")).click(function(){u.is("."+g)&&(r.toggleClass(h),s.slideToggle(),a.storage("placesState",r.is("."+h)?1:0))}),s=n.children("."+a.res("class","navsubtree")),r=c(this).addClass(a.res("class","tree")+" elfinder-places ui-corner-all").hide().append(n).appendTo(a.getUI("navbar")).delegate("."+e,"hover",
function(){c(this).toggleClass("ui-state-hover")}).delegate("."+e,"click",function(){a.exec("open",c(this).attr("id").substr(6))}).droppable({tolerance:"pointer",accept:".elfinder-cwd-file-wrapper,.elfinder-tree-dir,.elfinder-cwd-file",hoverClass:a.res("class","adroppable"),drop:function(d,e){var f=true;c.each(e.helper.data("files"),function(d,e){var g=a.file(e);g&&g.mime=="directory"&&c.inArray(g.hash,b)===-1?m(g):f=false});k();f&&e.helper.hide()}});a.one("load",function(){a.oldAPI||(r.show().parent().show(),
b=c.map(a.storage("places").split(","),function(a){return a||null}),b.length&&(u.prepend(j),a.request({data:{cmd:"info",targets:b},preventDefault:true}).done(function(d){b=[];c.each(d.files,function(a,b){b.mime=="directory"&&m(b)});k();a.storage("placesState")>0&&u.click()}).always(function(){j.remove()})),a.remove(function(a){c.each(a.data.removed,function(a,b){p(b)});k()}).change(function(a){c.each(a.data.changed,function(a,d){c.inArray(d.hash,b)!==-1&&(p(d.hash),d.mime=="directory"&&m(d))});k()}).bind("sync",
function(){b.length&&(u.prepend(j),a.request({data:{cmd:"info",targets:b},preventDefault:true}).done(function(a){c.each(a.files||[],function(a,d){c.inArray(d.hash,b)===-1&&p(d.hash)});k()}).always(function(){j.remove()}))}))})})};c.fn.elfindersearchbutton=function(a){return this.each(function(){var d=false,b=c(this).hide().addClass("ui-widget-content elfinder-button "+a.fm.res("class","searchbtn")+""),e=function(){a.exec(c.trim(h.val())).done(function(){d=true;h.focus()})},g=function(){h.val("");
d&&(d=false,a.fm.trigger("searchend"))},h=c('<input type="text" size="42"/>').appendTo(b).keypress(function(a){a.stopPropagation()}).keydown(function(a){a.stopPropagation();a.keyCode==13&&e();a.keyCode==27&&(a.preventDefault(),g())});c('<span class="ui-icon ui-icon-search" title="'+a.title+'"/>').appendTo(b).click(e);c('<span class="ui-icon ui-icon-close"/>').appendTo(b).click(g);setTimeout(function(){b.parent().detach();a.fm.getUI("toolbar").prepend(b.show());if(c.browser.msie){var d=b.children(a.fm.direction==
"ltr"?".ui-icon-close":".ui-icon-search");d.css({right:"",left:parseInt(b.width())-d.outerWidth(true)})}},200);a.fm.error(function(){h.unbind("keydown")}).select(function(){h.blur()}).viewchange(g).shortcut({pattern:"ctrl+f f3",description:a.title,callback:function(){h.select().focus()}})})};c.fn.elfinderstat=function(a){return this.each(function(){var d=c(this).addClass("elfinder-stat-size"),b=c('<div class="elfinder-stat-selected"/>'),e=a.i18n("size").toLowerCase(),g=a.i18n("items").toLowerCase(),
h=a.i18n("selected"),f=function(b,f){var h=0,k=0;c.each(b,function(a,b){if(!f||b.phash==f)h++,k+=parseInt(b.size)||0});d.html(g+": "+h+", "+e+": "+a.formatSize(k))};a.getUI("statusbar").prepend(d).append(b).show();a.bind("open reload add remove change searchend",function(){f(a.files(),a.cwd().hash)}).search(function(a){f(a.data.files)}).select(function(){var d=0,f=0;c.each(a.selectedFiles(),function(a,b){f++;d+=parseInt(b.size)||0});b.html(f?h+": "+f+", "+e+": "+a.formatSize(d):"&nbsp;")})})};c.fn.elfindertoolbar=
function(a,d){this.not(".elfinder-toolbar").each(function(){var b=a._commands,e=c(this).addClass("ui-helper-clearfix ui-widget-header ui-corner-top elfinder-toolbar"),g=d||[],h=g.length,f,i,j,l;for(e.prev().length&&e.parent().prepend(this);h--;){j=c('<div class="ui-widget-content ui-corner-all elfinder-buttonset"/>');for(f=g[h].length;f--;)if(i=b[g[h][f]])l="elfinder"+i.options.ui,c.fn[l]&&j.prepend(c("<div/>")[l](i));j.children().length&&e.prepend(j);j.children(":not(:last),:not(:first):not(:last)").after('<span class="ui-widget-content elfinder-toolbar-button-separator"/>')}e.children().length&&
e.show()});return this};c.fn.elfindertree=function(a,d){var b=a.res("class","tree");this.not("."+b).each(function(){var e=a.res("class","treeroot"),g=d.openRootOnLoad,h=a.res("class","navsubtree"),f=a.res("class","treedir"),i=a.res("class","navcollapse"),j=a.res("class","navexpand"),l=a.res("class","navarrow"),k=a.res("class","active"),q=a.res("class","adroppable"),m=a.res("class","hover"),p=a.res("class","disabled"),n=a.res("class","draggable"),u=a.res("class","droppable"),s=c.extend({},a.droppable,
{hoverClass:m+" "+q,over:function(){var a=c(this);a.is("."+i+":not(."+j+")")&&setTimeout(function(){a.is("."+q)&&a.children("."+l).click()},500)}}),r=c(a.res("tpl","navspinner")),y=a.res("tpl","navdir"),A=a.res("tpl","perms"),C=a.res("tpl","symlink"),D={id:function(b){return a.navHash2Id(b.hash)},cssclass:function(b){return(b.phash?"":e)+" "+f+" "+a.perms2class(b)+" "+(b.dirs&&!b.link?i:"")},permissions:function(a){return!a.read||!a.write?A:""},symlink:function(a){return a.alias?C:""}},B=function(b){b.name=
a.escape(b.name);return y.replace(/(?:\{([a-z]+)\})/ig,function(a,c){return b[c]||(D[c]?D[c](b):"")})},x=function(a){return c.map(a||[],function(a){return a.mime=="directory"?a:null})},F=function(b){return b?v.find("#"+a.navHash2Id(b)).next("."+h):v},t=function(b,d){for(var e=b.children(":first"),f;e.length;){if((f=a.file(a.navId2Hash(e.children("[id]").attr("id"))))&&d.name.localeCompare(f.name)<0)return e;e=e.next()}return c("")},z=function(b){var c=b.length,d=[],e,f,g,h,i;for(e=0;e<c;e++)f=b[e],
v.find("#"+a.navHash2Id(f.hash)).length||((h=F(f.phash)).length?(g=B(f),f.phash&&(i=t(h,f)).length?i.before(g):h.append(g)):d.push(f));if(d.length&&d.length<c)return z(d);G()},w=function(){var b=a.cwd().hash,c=v.find("#"+a.navHash2Id(b)),i;g&&(i=v.find("#"+a.navHash2Id(a.root())),i.is(".elfinder-subtree-loaded")&&i.addClass(j).next("."+h).show(),g=false);c.is("."+k)||(v.find("."+f+"."+k).removeClass(k),c.addClass(k));d.syncTree&&(c.length?c.parentsUntil("."+e).filter("."+h).show().prev("."+f).addClass(j):
a.newAPI&&a.request({data:{cmd:"parents",target:b},preventFail:true}).done(function(c){c=x(c.tree);z(c);E(c,"elfinder-subtree-loaded");b==a.cwd().hash&&w()}))},G=function(){v.find("."+f+":not(."+u+",.elfinder-ro,.elfinder-na)").droppable(s)},E=function(b,d){var e=d=="elfinder-subtree-loaded"?"."+i+":not(.elfinder-subtree-loaded)":":not(."+i+")";c.each(b,function(b,f){v.find("#"+a.navHash2Id(f.phash)+e).filter(function(){return c(this).next("."+h).children().length>0}).addClass(d)})},v=c(this).addClass(b).delegate("."+
f,"hover",function(b){var d=c(this),b=b.type=="mouseenter";d.is("."+q+" ,."+p)||(b&&!d.is("."+e+",."+n+",.elfinder-na,.elfinder-wo")&&d.draggable(a.draggable),d.toggleClass(m,b))}).delegate("."+f,"dropover dropout drop",function(a){c(this)[a.type=="dropover"?"addClass":"removeClass"](q+" "+m)}).delegate("."+f,"click",function(){var b=c(this),d=a.navId2Hash(b.attr("id"));d!=a.cwd().hash&&!b.is("."+p)?a.exec("open",d):b.is("."+i)&&b.children("."+l).click()}).delegate("."+f+"."+i+" ."+l,"click",function(b){var d=
c(this),e=d.parent("."+f),g=e.next("."+h);b.stopPropagation();e.is(".elfinder-subtree-loaded")?(e.toggleClass(j),g.slideToggle()):(r.insertBefore(d),e.removeClass(i),a.request({cmd:"tree",target:a.navId2Hash(e.attr("id"))}).done(function(a){z(x(a.tree));g.children().length&&(e.addClass(i+" "+j),g.slideDown());w()}).always(function(){r.remove();e.addClass("elfinder-subtree-loaded")}))});v.parent().find(".elfinder-navbar").append(v).show();a.open(function(a){var a=a.data,b=x(a.files);a.init&&v.empty();
b.length&&(z(b),E(b,"elfinder-subtree-loaded"));w()}).add(function(a){a=x(a.data.added);a.length&&(z(a),E(a,i))}).change(function(b){for(var b=x(b.data.changed),d=b.length,e,g,i,k,l,r;d--;)if(e=b[d],(g=v.find("#"+a.navHash2Id(e.hash))).length){if(e.phash){i=g.closest("."+h);k=F(e.phash);l=g.parent().next();r=t(k,e);if(!k.length)continue;if(k[0]!==i[0]||l.get(0)!==r.get(0))r.length?r.before(g):k.append(g)}k=g.is("."+j);l=g.is(".elfinder-subtree-loaded");i=c(B(e));g.replaceWith(i.children("."+f));if(e.dirs&&
(k||l)&&(g=v.find("#"+a.navHash2Id(e.hash)))&&g.next("."+h).children().length)k&&g.addClass(j),l&&g.addClass("elfinder-subtree-loaded")}w();G()}).remove(function(b){for(var b=b.data.removed,c=b.length,d,e;c--;)if((d=v.find("#"+a.navHash2Id(b[c]))).length)e=d.closest("."+h),d.parent().detach(),e.children().length||e.hide().prev("."+f).removeClass(i+" "+j+" elfinder-subtree-loaded")}).bind("search searchend",function(b){v.find("#"+a.navHash2Id(a.cwd().hash))[b.type=="search"?"removeClass":"addClass"](k)}).bind("lockfiles unlockfiles",
function(b){var d=b.type=="lockfiles",e=d?"disable":"enable",b=c.map(b.data.files||[],function(b){var c=a.file(b);return c&&c.mime=="directory"?b:null});c.each(b,function(b,c){var f=v.find("#"+a.navHash2Id(c));f.length&&(f.is("."+n)&&f.draggable(e),f.is("."+u)&&f.droppable(k),f[d?"addClass":"removeClass"](p))})})});return this};c.fn.elfinderuploadbutton=function(a){return this.each(function(){var d=c(this).elfinderbutton(a).unbind("click"),b=c("<form/>").appendTo(d),e=c('<input type="file" multiple="true"/>').appendTo(b).change(function(){var c;
e.val()&&(c=e.clone(true),a.exec({input:e.remove()[0]}),e=c.appendTo(b))})})};c.fn.elfinderviewbutton=function(a){return this.each(function(){var d=c(this).elfinderbutton(a),b=d.children(".elfinder-button-icon");a.change(function(){var c=a.value=="icons";b.toggleClass("elfinder-button-icon-view-list",c);d.attr("title",a.fm.i18n(c?"viewlist":"viewicons"))})})};c.fn.elfinderworkzone=function(){this.not(".elfinder-workzone").each(function(){var a=c(this).addClass("elfinder-workzone"),d=a.outerHeight(true)-
a.height(),b=a.parent();b.add(window).bind("resize",function(){var e=b.height();b.children(":visible:not(.elfinder-workzone)").each(function(){var a=c(this);a.css("position")!="absolute"&&(e-=a.outerHeight(true))});a.height(e-d)})});return this};elFinder.prototype.commands.archive=function(){var a=this,d=a.fm,b=[];this.variants=[];this.disableOnSearch=true;d.bind("open reload",function(){a.variants=[];c.each(b=d.option("archivers").create||[],function(b,c){a.variants.push([c,d.mime2kind(c)])});a.change()});
this.getstate=function(){return b.length&&d.selected().length&&d.cwd().write?0:-1};this.exec=function(a,g){var h=this.files(a),f=h.length,i=g||b[0],j=d.cwd(),l=["errArchive","errPerm"],k=c.Deferred().fail(function(a){a&&d.error(a)});if(!f||!(b.length&&c.inArray(i,b)!==-1))return k.reject();if(!j.write)return k.reject(l);for(j=0;j<f;j++)if(!h[j].read)return k.reject(l);return d.request({data:{cmd:"archive",targets:this.hashes(a),type:i},notify:{type:"archive",cnt:1},syncOnFail:true})}};elFinder.prototype.commands.back=
function(){this.alwaysEnabled=true;this.updateOnSelect=false;this.shortcuts=[{pattern:"ctrl+left backspace"}];this.getstate=function(){return this.fm.history.canBack()?0:-1};this.exec=function(){return this.fm.history.back()}};elFinder.prototype.commands.copy=function(){this.shortcuts=[{pattern:"ctrl+c ctrl+insert"}];this.getstate=function(a){var a=this.files(a),d=a.length;return d&&c.map(a,function(a){return a.phash&&a.read?a:null}).length==d?0:-1};this.exec=function(a){var d=this.fm,b=c.Deferred().fail(function(a){d.error(a)});
c.each(this.files(a),function(a,c){if(!c.read||!c.phash)return!b.reject(["errCopy",c.name,"errPerm"])});return b.isRejected()?b:b.resolve(d.clipboard(this.hashes(a)))}};elFinder.prototype.commands.cut=function(){this.shortcuts=[{pattern:"ctrl+x shift+insert"}];this.getstate=function(a){var a=this.files(a),d=a.length;return d&&c.map(a,function(a){return a.phash&&a.read&&!a.locked?a:null}).length==d?0:-1};this.exec=function(a){var d=this.fm,b=c.Deferred().fail(function(a){d.error(a)});c.each(this.files(a),
function(a,c){if(!c.read||!c.phash)return!b.reject(["errCopy",c.name,"errPerm"]);if(c.locked)return!b.reject(["errLocked",c.name])});return b.isRejected()?b:b.resolve(d.clipboard(this.hashes(a),true))}};elFinder.prototype.commands.download=function(){var a=this,d=function(b){return c.map(a.files(b),function(a){return a.mime=="directory"?null:a})};this.alwaysEnabled=true;this.shortcuts=[{pattern:"shift+enter"}];this.getstate=function(){var a=this.fm.selected(),c=a.length;return c&&c==d(a).length?0:
-1};this.exec=function(a){var e=this.fm,g=e.options.url,h=d(a),f=c.Deferred(),i;if(e.oldAPI)return e.error("errCmdNoSupport"),f.reject();g+=g.indexOf("?")===-1?"?":"&";for(e=0;e<h.length;e++)i=c('<iframe style="display:none" src="'+g+"cmd=file&target="+h[e].hash+'&download=1"/>').appendTo("body").load(function(){setTimeout(function(){i.remove()},1E3)});return f.resolve(a)}};elFinder.prototype.commands.duplicate=function(){var a=this.fm;this.disableOnSearch=true;this.getstate=function(d){var d=this.files(d),
b=d.length;return b&&a.cwd().write&&c.map(d,function(a){return a.phash&&a.read?a:null}).length==b?0:-1};this.exec=function(a){var b=this.fm,e=this.files(a),g=e.length,h=c.Deferred().fail(function(a){a&&b.error(a)});if(!g)return h.reject();c.each(e,function(a,c){if(!c.read)return!h.reject(["errCopy",c.name,"errPerm"]);if(!b.file(c.phash).write)return!h.reject(["errCopy",c.name,"errPerm"])});return h.isRejected()?h:b.request({data:{cmd:"duplicate",targets:this.hashes(a)},notify:{type:"copy",cnt:g}})}};
elFinder.prototype.commands.edit=function(){var a=this,d=this.fm,b=d.res("mimes","text")||[],e=function(a){return c.map(a,function(a){return a.mime.indexOf("text/")===0||c.inArray(a.mime,b)!==-1&&a.read&&a.write?a:null})},g=function(b){var e=b.hash,g=c.Deferred();d.url(e);var j=function(j){var l=c('<textarea class="elfinder-file-edit" rows="20">'+j+"</textarea>").keydown(function(a){var b=a.keyCode,c,d;a.stopPropagation();if(b==9&&(a.preventDefault(),this.setSelectionRange))c=this.value,d=this.selectionStart,
this.value=c.substr(0,d)+"\t"+c.substr(this.selectionEnd),d+=1,this.setSelectionRange(d,d);if(a.ctrlKey||a.metaKey){if(b==81||b==87)a.preventDefault(),m();b==83&&(a.preventDefault(),p())}}),j={title:b.name,width:a.options.dialogWidth||450,buttons:{},close:function(){c(this).elfinderdialog("destroy")},open:function(){d.disable();l.focus();l[0].setSelectionRange&&l[0].setSelectionRange(0,0)}},m=function(){g.resolve();l.elfinderdialog("close")},p=function(){var a=l.val();l.elfinderdialog("close");d.request({options:{type:"post"},
data:{cmd:"put",target:e,content:a},notify:{type:"save",cnt:1},syncOnFail:true}).fail(function(a){g.reject(a)}).done(function(a){a.changed&&a.changed.length&&d.change(a);g.resolve(a)})};j.buttons[d.i18n("Save")]=p;j.buttons[d.i18n("Cancel")]=m;d.dialog(l,j)},l;if(!b.read||!b.write)return l=["errOpen",b.name,"errPerm"],d.error(l),g.reject(l);d.request({data:{cmd:"get",target:e},notify:{type:"openfile",cnt:1}}).done(function(a){j(a.content)}).fail(function(a){g.reject(a)});return g};this.shortcuts=
[{pattern:"ctrl+e"}];this.getstate=function(a){var a=this.files(a),b=a.length;return b&&e(a).length==b?0:-1};this.exec=function(a){for(var a=e(this.files(a)),b=[],d;d=a.shift();)b.push(g(d));return b.length?c.when.apply(null,b):c.Deferred().reject()}};elFinder.prototype.commands.extract=function(){var a=this,d=a.fm,b=[],e=function(a){return c.map(a,function(a){return a.read&&c.inArray(a.mime,b)!==-1?a:null})};this.disableOnSearch=true;d.bind("open reload",function(){b=d.option("archivers").extract||
[];a.change()});this.getstate=function(a){var a=this.files(a),b=a.length;return b&&e(a).length==b?0:-1};this.exec=function(a){var a=this.files(a),e=c.Deferred(),f=a.length,i=f,j,l;if(!f||!b.length)return e.reject();for(j=0;j<f;j++){l=a[j];if(!l.read||!d.file(l.phash).write)return a=["errExtract",l.name,"errPerm"],d.error(a),e.reject(a);if(c.inArray(l.mime,b)===-1)return a=["errExtract",l.name,"errNoArchive"],d.error(a),e.reject(a);d.request({data:{cmd:"extract",target:l.hash},notify:{type:"extract",
cnt:1},syncOnFail:true}).fail(function(a){d.error(a);e.isRejected()||e.reject(a)}).done(function(){i--;i==0&&e.resolve()})}return e}};elFinder.prototype.commands.forward=function(){this.updateOnSelect=this.alwaysEnabled=true;this.shortcuts=[{pattern:"ctrl+right"}];this.getstate=function(){return this.fm.history.canForward()?0:-1};this.exec=function(){return this.fm.history.forward()}};elFinder.prototype.commands.getfile=function(){var a=this,d=this.fm,b=function(b){var d=a.options,b=c.map(b,function(a){return a.mime!=
"directory"||d.folders?a:null});return d.multiple||b.length==1?b:[]};this.alwaysEnabled=true;this.callback=d.options.getFileCallback;this._disabled=typeof this.callback=="function";this.getstate=function(a){var a=this.files(a),c=a.length;return this.callback&&c&&b(a).length==c?0:-1};this.exec=function(b){var d=this.fm,h=this.options,f=this.files(b),b=f.length,i=d.option("url"),j=d.option("tmbUrl"),l=c.Deferred().done(function(b){d.trigger("getfile",{files:b});a.callback(b,d);h.oncomplete=="close"?
d.hide():h.oncomplete=="destroy"&&d.destroy()}),k=[],q,m,p;if(this.getstate()==-1)return l.reject();for(q=0;q<b;q++){m=f[q];if(m.mime=="directory"&&!h.folders)return l.reject();m.baseUrl=i;m.url=d.url(m.hash);m.path=d.path(m.hash);if(m.tmb&&m.tmb!=1)m.tmb=j+m.tmb;m.dim?(p=m.dim.split("x"),m.width=p[0],m.height=p[1]):m.mime.indexOf("image")!==-1&&k.push(d.request({data:{cmd:"dim",target:m.hash},preventDefault:true}).done(c.proxy(function(a){if(a.dim)p=a.dim.split("x"),this.width=p[0],this.height=p[1];
this.dim=a.dim},f[q])))}return k.length?(c.when.apply(null,k).always(function(){l.resolve(h.multiple?f:f[0])}),l):l.resolve(h.multiple?f:f[0])}};elFinder.prototype.commands.help=function(){var a=this.fm,d;this.alwaysEnabled=true;this.updateOnSelect=false;this.state=0;this.shortcuts=[{pattern:"f1",description:this.title}];this.fm.one("open",function(){setTimeout(function(){var b=/\{url\}/,e=/\{link\}/,g=/\{author\}/,h=/\{work\}/,f=['<div class="ui-tabs ui-widget ui-widget-content ui-corner-all elfinder-help">',
'<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">'],i=a.shortcuts();c.each({main:"about",shortcuts:"shortcuts",help:"help"},function(b,c){f.push('<li class="ui-state-default ui-corner-top"><a href="#{id}">{title}</a></li>'.replace(/\{id\}/,b).replace(/\{title\}/,a.i18n(c)))});f.push("</ul>");f.push('<div id="main" class="ui-tabs-panel ui-widget-content ui-corner-bottom"><div class="elfinder-help-logo"/>');f.push("<h3>elFinder</h3>");f.push('<div class="ui-priority-primary">'+
a.i18n("webfm")+"</div>");f.push('<div class="ui-priority-secondary">'+a.i18n("ver")+": "+a.version+", "+a.i18n("protocol")+": "+a.api+"</div>");f.push('<div class="ui-priority-secondary">jQuery/jQuery UI: '+c().jquery+"/"+c.ui.version+"</div>");f.push('<div class="elfinder-help-separator"/>');f.push('<div class="elfinder-help-link"> <a href="{url}">{link}</a></div>'.replace(b,"http://elfinder.org/").replace(e,a.i18n("homepage")));f.push('<div class="elfinder-help-link"> <a href="{url}">{link}</a></div>'.replace(b,
"https://github.com/Studio-42/elFinder/wiki").replace(e,a.i18n("docs")));f.push('<div class="elfinder-help-link"> <a href="{url}">{link}</a></div>'.replace(b,"https://github.com/Studio-42/elFinder").replace(e,a.i18n("github")));f.push('<div class="elfinder-help-link"> <a href="{url}">{link}</a></div>'.replace(b,"http://twitter.com/elrte_elfinder").replace(e,a.i18n("twitter")));f.push('<div class="elfinder-help-separator"/>');f.push('<div class="ui-priority-primary">'+a.i18n("team")+"</div>");f.push('<div class="elfinder-help-team"><div>{author}</div>{work}</div>'.replace(g,
'Dmitry "dio" Levashov &lt;dio@std42.ru&gt;').replace(h,a.i18n("chiefdev")));f.push('<div class="elfinder-help-team"><div>{author}</div>{work}</div>'.replace(g,"Troex Nevelin &lt;troex@fury.scancode.ru&gt;").replace(h,a.i18n("maintainer")));f.push('<div class="elfinder-help-team"><div>{author}</div>{work}</div>'.replace(g,"Alexey Sukhotin &lt;strogg@yandex.ru&gt;").replace(h,a.i18n("contributor")));a.i18[a.lang].translator&&f.push('<div class="elfinder-help-team"><div>{author}</div>{work}</div>'.replace(g,
a.i18[a.lang].translator).replace(h,a.i18n("translator")+" ("+a.i18[a.lang].language+")"));f.push('<div class="elfinder-help-separator"/>');f.push('<div class="elfinder-help-license">'+a.i18n("icons")+': <a href="http://pixelmixer.ru/" target="_blank">Pixelmixer</a>, <a href="http://p.yusukekamiyamane.com" target="_blank">Fugue</a></div>');f.push('<div class="elfinder-help-separator"/>');f.push('<div class="elfinder-help-license">Licence: BSD Licence</div>');f.push('<div class="elfinder-help-license">Copyright \u00a9 2009-2011, Studio 42</div>');
f.push('<div class="elfinder-help-license">\u201e \u2026'+a.i18n("dontforget")+" \u201d</div>");f.push("</div>");f.push('<div id="shortcuts" class="ui-tabs-panel ui-widget-content ui-corner-bottom">');i.length?(f.push('<div class="ui-widget-content elfinder-help-shortcuts">'),c.each(i,function(a,b){f.push('<div class="elfinder-help-shortcut"><div class="elfinder-help-shortcut-pattern">{pattern}</div> {descrip}</div>'.replace(/\{pattern\}/,b[0]).replace(/\{descrip\}/,b[1]))}),f.push("</div>")):f.push('<div class="elfinder-help-disabled">'+
a.i18n("shortcutsof")+"</div>");f.push("</div>");f.push('<div id="help" class="ui-tabs-panel ui-widget-content ui-corner-bottom">');f.push('<a href="http://elrte.org/redmine/projects/elfinder/boards" target="_blank" class="elfinder-dont-panic"><span>DON\'T PANIC</span></a>');f.push("</div>");f.push("</div>");d=c(f.join(""));d.find(".ui-tabs-nav li").hover(function(){c(this).toggleClass("ui-state-hover")}).children().click(function(a){var b=c(this);a.preventDefault();a.stopPropagation();b.is(".ui-tabs-selected")||
(b.parent().addClass("ui-tabs-selected ui-state-active").siblings().removeClass("ui-tabs-selected").removeClass("ui-state-active"),d.find(".ui-tabs-panel").hide().filter(b.attr("href")).show())}).filter(":first").click()},200)});this.getstate=function(){return 0};this.exec=function(){this.fm.dialog(d,{title:this.title,width:530})}};elFinder.prototype.commands.home=function(){this.title="Home";this.alwaysEnabled=true;this.updateOnSelect=false;this.shortcuts=[{pattern:"ctrl+home ctrl+shift+up",description:"Home"}];
this.getstate=function(){var a=this.fm.root(),c=this.fm.cwd().hash;return a&&c&&a!=c?0:-1};this.exec=function(){return this.fm.exec("open",this.fm.root())}};elFinder.prototype.commands.info=function(){var a=this.fm,d={calc:a.i18n("calc"),size:a.i18n("size"),unknown:a.i18n("unknown"),path:a.i18n("path"),aliasfor:a.i18n("aliasfor"),modify:a.i18n("modify"),perms:a.i18n("perms"),locked:a.i18n("locked"),dim:a.i18n("dim"),kind:a.i18n("kind"),files:a.i18n("files"),folders:a.i18n("folders"),items:a.i18n("items"),
yes:a.i18n("yes"),no:a.i18n("no"),link:a.i18n("link")};this.tpl={main:'<div class="ui-helper-clearfix elfinder-info-title"><span class="elfinder-cwd-icon {class} ui-corner-all"/>{title}</div><table class="elfinder-info-tb">{content}</table>',itemTitle:'<strong>{name}</strong><span class="elfinder-info-kind">{kind}</span>',groupTitle:"<strong>{items}: {num}</strong>",row:"<tr><td>{label} : </td><td>{value}</td></tr>",spinner:'<span>{text}</span> <span class="elfinder-info-spinner"/>'};this.alwaysEnabled=
true;this.updateOnSelect=false;this.shortcuts=[{pattern:"ctrl+i"}];this.init=function(){c.each(d,function(b,c){d[b]=a.i18n(c)})};this.getstate=function(){return 0};this.exec=function(a){var e=this.fm,g=this.tpl,h=g.row,f=this.files(a),i=f.length,a=[],j=g.main,l={title:this.title,width:"auto",close:function(){c(this).elfinderdialog("destroy")}},k=[],q=function(a){m.find(".elfinder-info-spinner").parent().text(a)},m,p,n,u,s;if(!i)return c.Deferred().reject();i==1?(f=f[0],j=j.replace("{class}",e.mime2class(f.mime)),
u=g.itemTitle.replace("{name}",f.name).replace("{kind}",e.mime2kind(f)),f.tmb&&(n=e.option("tmbUrl")+f.tmb),f.read?f.mime!="directory"||f.alias?p=e.formatSize(f.size):(p=g.spinner.replace("{text}",d.calc),k.push(f.hash)):p=d.unknown,a.push(h.replace("{label}",d.size).replace("{value}",p)),f.alias&&a.push(h.replace("{label}",d.aliasfor).replace("{value}",f.alias)),a.push(h.replace("{label}",d.path).replace("{value}",e.escape(e.path(f.hash)))),f.read&&a.push(h.replace("{label}",d.link).replace("{value}",
'<a href="'+e.url(f.hash)+'" target="_blank">'+f.name+"</a>")),f.dim?a.push(h.replace("{label}",d.dim).replace("{value}",f.dim)):f.mime.indexOf("image")!==-1&&(a.push(h.replace("{label}",d.dim).replace("{value}",g.spinner.replace("{text}",d.calc))),e.request({data:{cmd:"dim",target:f.hash},preventDefault:true}).fail(function(){q(d.unknown)}).done(function(a){q(a.dim||d.unknown)})),a.push(h.replace("{label}",d.modify).replace("{value}",e.formatDate(f.date))),a.push(h.replace("{label}",d.perms).replace("{value}",
e.formatPermissions(f))),a.push(h.replace("{label}",d.locked).replace("{value}",f.locked?d.yes:d.no))):(j=j.replace("{class}","elfinder-cwd-icon-group"),u=g.groupTitle.replace("{items}",d.items).replace("{num}",i),(s=c.map(f,function(a){return a.mime=="directory"?1:null}).length)?(a.push(h.replace("{label}",d.kind).replace("{value}",s==i?d.folders:d.folders+" "+s+", "+d.files+" "+(i-s))),a.push(h.replace("{label}",d.size).replace("{value}",g.spinner.replace("{text}",d.calc))),k=c.map(f,function(a){return a.hash})):
(p=0,c.each(f,function(a,b){p+=b.size}),a.push(h.replace("{label}",d.kind).replace("{value}",d.files)),a.push(h.replace("{label}",d.size).replace("{value}",e.formatSize(p)))));j=j.replace("{title}",u).replace("{content}",a.join(""));m=e.dialog(j,l);n&&c("<img/>").load(function(){m.find(".elfinder-cwd-icon").css("background",'url("'+n+'") center center no-repeat')}).attr("src",n);k.length&&e.request({data:{cmd:"size",targets:k},preventDefault:true}).fail(function(){q(d.unknown)}).done(function(a){a=
parseInt(a.size);q(a>=0?e.formatSize(a):d.unknown)})}};elFinder.prototype.commands.mkdir=function(){this.disableOnSearch=true;this.updateOnSelect=false;this.mime="directory";this.prefix="untitled folder";this.exec=c.proxy(this.fm.res("mixin","make"),this);this.shortcuts=[{pattern:"ctrl+shift+n"}];this.getstate=function(){return this.fm.cwd().write?0:-1}};elFinder.prototype.commands.mkfile=function(){this.disableOnSearch=true;this.updateOnSelect=false;this.mime="text/plain";this.prefix="untitled folder.txt";
this.exec=c.proxy(this.fm.res("mixin","make"),this);this.getstate=function(){return this.fm.cwd().write?0:-1}};elFinder.prototype.commands.open=function(){this.alwaysEnabled=true;this._handlers={dblclick:function(a){a.preventDefault();this.exec()},"select enable disable reload":function(a){this.update(a.type=="disable"?-1:void 0)}};this.shortcuts=[{pattern:"ctrl+down numpad_enter"+(this.fm.OS!="mac"&&" enter")}];this.getstate=function(a){var a=this.files(a),d=a.length;return d==1?0:d?c.map(a,function(a){return a.mime==
"directory"?null:a}).length==d?0:-1:-1};this.exec=function(a){var d=this.fm,b=c.Deferred().fail(function(a){a&&d.error(a)}),e=this.files(a),g=e.length,h,f,i;if(!g)return b.reject();if(g==1&&(h=e[0])&&h.mime=="directory")return h&&!h.read?b.reject(["errOpen",h.name,"errPerm"]):d.request({data:{cmd:"open",target:h.hash},notify:{type:"open",cnt:1,hideCnt:true},syncOnFail:true});e=c.map(e,function(a){return a.mime!="directory"?a:null});if(g!=e.length)return b.reject();for(g=e.length;g--;){h=e[g];if(!h.read)return b.reject(["errOpen",
h.name,"errPerm"]);if(!(f=d.url(h.hash)))f=d.options.url,f=f+(f.indexOf("?")===-1?"?":"&")+(d.oldAPI?"cmd=open&current="+h.phash:"cmd=file")+"&target="+h.hash;i="";h.dim&&(h=h.dim.split("x"),i="width="+(parseInt(h[0])+20)+",height="+(parseInt(h[1])+20));if(!window.open(f,"_blank",i+",top=50,left=50,scrollbars=yes,resizable=yes"))return b.reject("errPopup")}return b.resolve(a)}};elFinder.prototype.commands.paste=function(){this.disableOnSearch=true;this.updateOnSelect=false;this.handlers={changeclipboard:function(){this.update()}};
this.shortcuts=[{pattern:"ctrl+v shift+insert"}];this.getstate=function(a){if(a){if(c.isArray(a)){if(a.length!=1)return-1;a=this.fm.file(a[0])}}else a=this.fm.cwd();return this.fm.clipboard().length&&a.mime=="directory"&&a.write?0:-1};this.exec=function(a){var d=this.fm,a=a?this.files(a)[0]:d.cwd(),b=d.clipboard(),e=b.length,g=e?b[0].cut:false,h=g?"errMove":"errCopy",f=[],i=[],j=c.Deferred().fail(function(a){a&&d.error(a)}),l;if(!e||!a||a.mime!="directory")return j.reject();if(!a.write)return j.reject([h,
b[0].name,"errPerm"]);l=d.parents(a.hash);c.each(b,function(d,e){if(!e.read)return!j.reject([h,b[0].name,"errPerm"]);if(g&&e.locked)return!j.reject(["errLocked",e.name]);if(c.inArray(e.hash,l)!==-1)return!j.reject(["errCopyInItself",e.name]);e.phash==a.hash?i.push(e.hash):f.push({hash:e.hash,phash:e.phash,name:e.name})});return c.when(i.length&&d._commands.duplicate?d.exec("duplicate",i):c.Deferred().resolve(),function(b){var e=c.Deferred(),f=[],h=function(a){var c=b[f[a]],i=a==f.length-1;c&&d.confirm({title:d.i18n(g?
"moveFiles":"copyFiles"),text:d.i18n(["errExists",c.name,"confirmRepl"]),all:!i,accept:{label:"btnYes",callback:function(c){!i&&!c?h(++a):j(b)}},reject:{label:"btnNo",callback:function(c){var d;if(c)for(d=f.length;a<d--;)b[f[d]].remove=true;else b[f[a]].remove=true;!i&&!c?h(++a):j(b)}},cancel:{label:"btnCancel",callback:function(){e.resolve()}}})},i=function(a){for(var d=[],e=b.length;e--;)c.inArray(b[e].name,a)!==-1&&d.unshift(e);f=d;f.length?h(0):j(b)},j=function(b){var b=c.map(b,function(a){return!a.remove?
a:null}),f=b.length,h;if(!f)return e.resolve();h=b[0].phash;b=c.map(b,function(a){return a.hash});d.request({data:{cmd:"paste",dst:a.hash,targets:b,cut:g?1:0,src:h},notify:{type:g?"move":"copy",cnt:f}}).always(function(){d.unlockfiles({files:b})})};if(!b.length)return e.resolve();d.oldAPI?j(b):d.option("copyOverwrite")?a.hash==d.cwd().hash?i(c.map(d.files(),function(b){return b.phash==a.hash?b.name:null})):d.request({data:{cmd:"ls",target:a.hash},notify:{type:"prepare",cnt:1,hideCnt:true},preventFail:true}).always(function(a){i(a.list||
[])}):j(b);return e}(f)).always(function(){g&&d.clipboard([])})}};elFinder.prototype.commands.quicklook=function(){var a=this,d=a.fm,b=0,e=c.browser.mozilla||c.browser.opera?"keypress":"keydown",g=function(a){c(document).trigger(c.Event(e,{keyCode:a,ctrlKey:false,shiftKey:false,altKey:false,metaKey:false}))},h=function(a){return{opacity:0,width:20,height:d.view=="list"?1:20,top:a.offset().top+"px",left:a.offset().left+"px"}},f=function(){var a=c(window);return{opacity:1,width:j,height:l,top:parseInt(k.position().top+
a.scrollTop()),left:parseInt((a.width()-j)/2)}},i=function(a){var b=document.createElement(a.substr(0,a.indexOf("/")));return(a=b.canPlayType&&b.canPlayType(a))&&a!==""&&a!="no"},j,l,k,q,m=c('<div class="elfinder-quicklook-title"/>'),p=c("<div/>"),n=c('<div class="elfinder-quicklook-info"/>'),u=c('<div class="elfinder-quicklook-navbar-icon elfinder-quicklook-navbar-icon-fullscreen"/>').mousedown(function(b){var e=a.window,f=e.is(".elfinder-quicklook-fullscreen"),g="scroll."+d.namespace,h=c(window);
b.stopPropagation();f?(e.css(e.data("position")).unbind("mousemove"),h.unbind(g).trigger(a.resize).unbind(a.resize),s.unbind("mouseenter").unbind("mousemove")):(e.data("position",{left:e.css("left"),top:e.css("top"),width:e.width(),height:e.height()}).css({width:"100%",height:"100%"}),c(window).bind(g,function(){e.css({left:parseInt(c(window).scrollLeft())+"px",top:parseInt(c(window).scrollTop())+"px"})}).bind(a.resize,function(){a.preview.trigger("changesize")}).trigger(g).trigger(a.resize),e.bind("mousemove",
function(){s.stop(true,true).show().delay(3E3).fadeOut("slow")}).mousemove(),s.mouseenter(function(){s.stop(true,true).show()}).mousemove(function(a){a.stopPropagation()}));s.attr("style","").draggable(f?"destroy":{});e.toggleClass("elfinder-quicklook-fullscreen");c(this).toggleClass("elfinder-quicklook-navbar-icon-fullscreen-off");c.fn.resizable&&k.add(e).resizable(f?"enable":"disable").removeClass("ui-state-disabled")}),s=c('<div class="elfinder-quicklook-navbar"/>').append(c('<div class="elfinder-quicklook-navbar-icon elfinder-quicklook-navbar-icon-prev"/>').mousedown(function(){g(37)})).append(u).append(c('<div class="elfinder-quicklook-navbar-icon elfinder-quicklook-navbar-icon-next"/>').mousedown(function(){g(39)})).append('<div class="elfinder-quicklook-navbar-separator"/>').append(c('<div class="elfinder-quicklook-navbar-icon elfinder-quicklook-navbar-icon-close"/>').mousedown(function(){a.window.trigger("close")}));
this.resize="resize."+d.namespace;this.info=c('<div class="elfinder-quicklook-info-wrapper"/>').append(p).append(n);this.preview=c('<div class="elfinder-quicklook-preview ui-helper-clearfix"/>').bind("change",function(){a.info.attr("style","").hide();p.removeAttr("class").attr("style","");n.html("")}).bind("update",function(b){var d=a.fm,e=b.file,f;e?(!e.read&&b.stopImmediatePropagation(),a.window.data("hash",e.hash),a.preview.unbind("changesize").trigger("change").children().remove(),m.html(d.escape(e.name)),
n.html('<div class="elfinder-quicklook-info-data">{value}</div>'.replace(/\{value\}/,e.name)+'<div class="elfinder-quicklook-info-data">{value}</div>'.replace(/\{value\}/,d.mime2kind(e))+(e.mime=="directory"?"":'<div class="elfinder-quicklook-info-data">{value}</div>'.replace(/\{value\}/,d.formatSize(e.size)))+'<div class="elfinder-quicklook-info-data">{value}</div>'.replace(/\{value\}/,d.i18n("modify")+": "+d.formatDate(e.date))),p.addClass("elfinder-cwd-icon ui-corner-all "+d.mime2class(e.mime)),
e.tmb&&c("<img/>").hide().appendTo(a.preview).load(function(){p.css("background",'url("'+f+'") center center no-repeat');c(this).remove()}).attr("src",f=d.tmb(e.hash)),a.info.delay(100).fadeIn(10)):b.stopImmediatePropagation()});this.window=c('<div class="ui-helper-reset ui-widget elfinder-quicklook" style="position:absolute"/>').click(function(a){a.stopPropagation()}).append(c('<div class="elfinder-quicklook-titlebar"/>').append(m).append(c('<span class="ui-icon ui-icon-circle-close"/>').mousedown(function(b){b.stopPropagation();
a.window.trigger("close")}))).append(this.preview.add(s)).append(a.info.hide()).draggable({handle:"div.elfinder-quicklook-titlebar"}).bind("open",function(){var c=a.window,d=a.value,e;if(a.closed()&&d&&(e=q.find("#"+d.hash)).length)b=1,e.trigger("scrolltoview"),c.css(h(e)).show().animate(f(),550,function(){b=2;a.update(1,a.value)})}).bind("close",function(){var c=a.window,d=a.preview.trigger("change"),e=q.find("#"+c.data("hash")),f=function(){b=0;c.hide();d.children().remove();a.update(0,a.value)};
a.opened()&&(b=1,c.is(".elfinder-quicklook-fullscreen")&&u.mousedown(),e.length?c.animate(h(e),500,f):f())});this.alwaysEnabled=true;this.value=null;this.handlers={select:function(){this.update(void 0,this.fm.selectedFiles()[0])},error:function(){a.window.is(":visible")&&a.window.data("hash","").trigger("close")},"searchshow searchhide":function(){this.opened()&&this.window.trigger("close")}};this.shortcuts=[{pattern:"space"}];this.support={audio:{ogg:i('audio/ogg; codecs="vorbis"'),mp3:i("audio/mpeg;"),
wav:i('audio/wav; codecs="1"'),m4a:i("audio/x-m4a;")||i("audio/aac;")},video:{ogg:i('video/ogg; codecs="theora"'),webm:i('video/webm; codecs="vp8, vorbis"'),mp4:i('video/mp4; codecs="avc1.42E01E"')||i('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')}};this.closed=function(){return b==0};this.opened=function(){return b==2};this.init=function(){var b=this.options,e=this.window,f=this.preview;j=b.width>0?parseInt(b.width):450;l=b.height>0?parseInt(b.height):300;d.one("load",function(){k=d.getUI();q=d.getUI("cwd");
e.appendTo("body").zIndex(100+k.zIndex());c(document).keydown(function(b){b.keyCode==27&&a.opened()&&e.trigger("close")});c.fn.resizable&&e.resizable({handles:"se",minWidth:350,minHeight:120,resize:function(){f.trigger("changesize")}});a.change(function(){a.opened()&&(a.value?f.trigger(c.Event("update",{file:a.value})):e.trigger("close"))});c.each(d.commands.quicklook.plugins||[],function(b,c){typeof c=="function"&&new c(a)});f.bind("update",function(){a.info.show()})})};this.getstate=function(){return this.fm.selected().length==
1?b==2?1:0:-1};this.exec=function(){this.enabled()&&this.window.trigger(this.opened()?"close":"open")};this.hideinfo=function(){this.info.stop(true).hide()}};elFinder.prototype.commands.quicklook.plugins=[function(a){var d=["image/jpeg","image/png","image/gif"],b=a.preview;c.each(navigator.mimeTypes,function(a,b){var h=b.type;h.indexOf("image/")===0&&c.inArray(h,d)&&d.push(h)});b.bind("update",function(e){var g=e.file,h;c.inArray(g.mime,d)!==-1&&(e.stopImmediatePropagation(),h=c("<img/>").hide().appendTo(b).load(function(){setTimeout(function(){var c=
(h.width()/h.height()).toFixed(2);b.bind("changesize",function(){var a=parseInt(b.width()),d=parseInt(b.height()),e;c<(a/d).toFixed(2)?(e=d,a=Math.floor(e*c)):e=Math.floor(a/c);h.width(a).height(e).css("margin-top",e<d?Math.floor((d-e)/2):0)}).trigger("changesize");a.hideinfo();h.fadeIn(100)},1)}).attr("src",a.fm.url(g.hash)))})},function(a){var d=["text/html","application/xhtml+xml"],b=a.preview,e=a.fm;b.bind("update",function(g){var h=g.file,f;c.inArray(h.mime,d)!==-1&&(g.stopImmediatePropagation(),
b.one("change",function(){!f.isResolved()&&!f.isRejected()&&f.reject()}),f=e.request({data:{cmd:"get",target:h.hash,current:h.phash},preventDefault:true}).done(function(d){a.hideinfo();doc=c('<iframe class="elfinder-quicklook-preview-html"/>').appendTo(b)[0].contentWindow.document;doc.open();doc.write(d.content);doc.close()}))})},function(a){var d=a.fm,b=d.res("mimes","text"),e=a.preview;e.bind("update",function(g){var h=g.file,f=h.mime,i;if(f.indexOf("text/")===0||c.inArray(f,b)!==-1)g.stopImmediatePropagation(),
e.one("change",function(){!i.isResolved()&&!i.isRejected()&&i.reject()}),i=d.request({data:{cmd:"get",target:h.hash},preventDefault:true}).done(function(b){a.hideinfo();c('<div class="elfinder-quicklook-preview-text-wrapper"><pre class="elfinder-quicklook-preview-text">'+d.escape(b.content)+"</pre></div>").appendTo(e)})})},function(a){var d=a.fm,b=a.preview,e=false;c.browser.safari&&navigator.platform.indexOf("Mac")!=-1||c.browser.msie?e=true:c.each(navigator.plugins,function(a,b){c.each(b,function(a,
b){if(b.type=="application/pdf")return!(e=true)})});e&&b.bind("update",function(e){var h=e.file,f;h.mime=="application/pdf"&&(e.stopImmediatePropagation(),b.one("change",function(){f.unbind("load").remove()}),f=c('<iframe class="elfinder-quicklook-preview-pdf"/>').hide().appendTo(b).load(function(){a.hideinfo();f.show()}).attr("src",d.url(h.hash)))})},function(a){var d=a.fm,b=a.preview,e=false;c.each(navigator.plugins,function(a,b){c.each(b,function(a,b){if(b.type=="application/x-shockwave-flash")return!(e=
true)})});e&&b.bind("update",function(e){var h=e.file;h.mime=="application/x-shockwave-flash"&&(e.stopImmediatePropagation(),a.hideinfo(),b.append(c('<embed class="elfinder-quicklook-preview-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+d.url(h.hash)+'" quality="high" type="application/x-shockwave-flash" />')))})},function(a){var d=a.preview,b=!!a.options.autoplay,e={"audio/mpeg":"mp3","audio/mpeg3":"mp3","audio/mp3":"mp3","audio/x-mpeg3":"mp3","audio/x-mp3":"mp3","audio/x-wav":"wav",
"audio/wav":"wav","audio/x-m4a":"m4a","audio/aac":"m4a","audio/mp4":"m4a","audio/x-mp4":"m4a","audio/ogg":"ogg"},g;d.bind("update",function(h){var f=h.file;a.support.audio[e[f.mime]]&&(h.stopImmediatePropagation(),g=c('<audio class="elfinder-quicklook-preview-audio" controls preload="auto" autobuffer><source src="'+a.fm.url(f.hash)+'" /></audio>').appendTo(d),b&&g[0].play())}).bind("change",function(){g&&g.parent().length&&(g[0].pause(),g.remove(),g=null)})},function(a){var d=a.preview,b=!!a.options.autoplay,
e={"video/mp4":"mp4","video/x-m4v":"mp4","video/ogg":"ogg","application/ogg":"ogg","video/webm":"webm"},g;d.bind("update",function(h){var f=h.file;a.support.video[e[f.mime]]&&(h.stopImmediatePropagation(),a.hideinfo(),g=c('<video class="elfinder-quicklook-preview-video" controls preload="auto" autobuffer><source src="'+a.fm.url(f.hash)+'" /></video>').appendTo(d),b&&g[0].play())}).bind("change",function(){g&&g.parent().length&&(g[0].pause(),g.remove(),g=null)})},function(a){var d=a.preview,b=[],e;
c.each(navigator.plugins,function(a,d){c.each(d,function(a,c){(c.type.indexOf("audio/")===0||c.type.indexOf("video/")===0)&&b.push(c.type)})});d.bind("update",function(g){var h=g.file,f=h.mime;c.inArray(h.mime,b)!==-1&&(g.stopImmediatePropagation(),(g=f.indexOf("video/")===0)&&a.hideinfo(),e=c('<embed src="'+a.fm.url(h.hash)+'" type="'+f+'" class="elfinder-quicklook-preview-'+(g?"video":"audio")+'"/>').appendTo(d))}).bind("change",function(){e&&e.parent().length&&(e.remove(),e=null)})}];elFinder.prototype.commands.reload=
function(){this.updateOnSelect=this.alwaysEnabled=true;this.shortcuts=[{pattern:"ctrl+shift+r f5"}];this.getstate=function(){return 0};this.exec=function(){var a=this.fm,c=a.sync(),b=setTimeout(function(){a.notify({type:"reload",cnt:1,hideCnt:true});c.always(function(){a.notify({type:"reload",cnt:-1})})},a.notifyDelay);return c.always(function(){clearTimeout(b);a.trigger("reload")})}};elFinder.prototype.commands.rename=function(){this.disableOnSearch=true;this.shortcuts=[{pattern:"f2"+(this.fm.OS==
"mac"&&" enter")}];this.getstate=function(){var a=this.fm.selectedFiles();return a.length==1&&a[0].phash&&!a[0].locked?0:-1};this.exec=function(){var a=this.fm,d=a.getUI("cwd"),b=a.selected(),e=b.length,g=a.file(b.shift()),h=c.Deferred().fail(function(b){var c=f.parent(),e=a.escape(g.name);b&&a.error(b);c.length?(f.remove(),c.html(e)):d.find("#"+g.hash).find(".elfinder-cwd-filename").html(e)}).always(function(){a.enable()}),f=c('<input type="text"/>').keydown(function(a){a.stopPropagation();a.stopImmediatePropagation();
a.keyCode==c.ui.keyCode.ESCAPE?h.reject():a.keyCode==c.ui.keyCode.ENTER&&f.blur()}).mousedown(function(a){a.stopPropagation()}).blur(function(){var b=c.trim(f.val()),d=f.parent();if(d.length){if(b==g.name)return h.reject();if(!b)return h.reject("errInvName");if(a.fileByName(b,g.phash))return h.reject(["errExists",b]);d.html(a.escape(b));a.lockfiles({files:[g.hash]});a.request({data:{cmd:"rename",target:g.hash,name:b},notify:{type:"rename",cnt:1}}).fail(function(){h.reject();a.sync()}).done(function(a){h.resolve(a)}).always(function(){a.unlockfiles({files:[g.hash]})})}}),
b=d.find("#"+g.hash).find(".elfinder-cwd-filename").empty().append(f.val(g.name));if(!g||e>1||!b.length)return h.reject("errCmdParams",this.title);if(g.locked)return h.reject(["errLocked",g.name]);a.disable();f.select().focus();return h}};elFinder.prototype.commands.rm=function(){this.shortcuts=[{pattern:"delete ctrl+backspace"}];this.getstate=function(a){var d=this.fm,a=a||d.selected();return a.length&&c.map(a,function(a){var c=d.file(a);return c&&c.phash&&!c.locked?a:null}).length==a.length?0:-1};
this.exec=function(a){var d=this.fm,b=c.Deferred().fail(function(a){a&&d.error(a)}),e=this.files(a),g=e.length,h=d.cwd().hash,f=false;if(!g)return b.reject();c.each(e,function(a,c){if(!c.phash)return!b.reject(["errRm",c.name,"errPerm"]);if(c.locked)return!b.reject(["errLocked",c.name]);c.hash==h&&(f=d.root(c.hash))});b.isRejected()||(e=this.hashes(a),d.confirm({title:this.title,text:"confirmRm",accept:{label:"btnRm",callback:function(){d.lockfiles({files:e});d.request({data:{cmd:"rm",targets:e},notify:{type:"rm",
cnt:g},preventFail:true}).fail(function(a){b.reject(a)}).done(function(a){b.done(a);f&&d.exec("open",f)}).always(function(){d.unlockfiles({files:e})})}},cancel:{label:"btnCancel",callback:function(){b.reject()}}}));return b}};elFinder.prototype.commands.search=function(){this.title="Find files";this.options={ui:"searchbutton"};this.alwaysEnabled=true;this.updateOnSelect=false;this.getstate=function(){return 0};this.exec=function(a){var d=this.fm;if(typeof a=="string"&&a)return d.request({data:{cmd:"search",
q:a},notify:{type:"search",cnt:1,hideCnt:true}});d.getUI("toolbar").find("."+d.res("class","searchbtn")+" :text").focus();return c.Deferred().reject()}};elFinder.prototype.commands.up=function(){this.alwaysEnabled=true;this.updateOnSelect=false;this.shortcuts=[{pattern:"ctrl+up"}];this.getstate=function(){return this.fm.cwd().phash?0:-1};this.exec=function(){return this.fm.cwd().phash?this.fm.exec("open",this.fm.cwd().phash):c.Deferred().reject()}};elFinder.prototype.commands.upload=function(){var a=
this.fm.res("class","hover");this.disableOnSearch=true;this.updateOnSelect=false;this.shortcuts=[{pattern:"ctrl+u"}];this.getstate=function(){return this.fm.cwd().write?0:-1};this.exec=function(d){var b=this.fm,e=function(a){h.elfinderdialog("close");b.upload(a).fail(function(a){g.reject(a)}).done(function(a){g.resolve(a)})},g,h,f,i,j;if(d&&(d.input||d.files))return b.upload(d);g=c.Deferred();f=c('<input type="file" multiple="true"/>').change(function(){e({input:f[0]})});i=c('<div class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">'+
b.i18n("selectForUpload")+"</span></div>").append(c("<form/>").append(f)).hover(function(){i.toggleClass(a)});h=c('<div class="elfinder-upload-dialog-wrapper"/>').append(i);b.dragUpload&&(j=c('<div class="ui-corner-all elfinder-upload-dropbox">'+b.i18n("dropFiles")+"</div>").prependTo(h).after('<div class="elfinder-upload-dialog-or">'+b.i18n("or")+"</div>")[0],j.addEventListener("dragenter",function(b){b.stopPropagation();b.preventDefault();c(j).addClass(a)},false),j.addEventListener("dragleave",
function(b){b.stopPropagation();b.preventDefault();c(j).removeClass(a)},false),j.addEventListener("dragover",function(a){a.stopPropagation();a.preventDefault()},false),j.addEventListener("drop",function(a){a.stopPropagation();a.preventDefault();e({files:a.dataTransfer.files})},false));b.dialog(h,{title:this.title,modal:true,resizable:false,destroyOnClose:true});return g}};elFinder.prototype.commands.view=function(){this.value=this.fm.storage("view");this.alwaysEnabled=true;this.updateOnSelect=false;
this.options={ui:"viewbutton"};this.getstate=function(){return 0};this.exec=function(){var a=this.fm.storage("view",this.value=="list"?"icons":"list");this.fm.viewchange();this.update(void 0,a)}}})(jQuery);
