/*
 * jQuery Pines Steps (psteps) Plugin 0.0.1alpha
 *
 * http://pinesframework.org/psteps/
 * Copyright (c) 2012 Angela Murrell
 *
 * Triple license under the GPL, LGPL, and MPL:
 *	  http://www.gnu.org/licenses/gpl.html
 *	  http://www.gnu.org/licenses/lgpl.html
 *	  http://www.mozilla.org/MPL/MPL-1.1.html
 */
(function(e){e.fn.psteps=function(m){var b=e.extend({},e.fn.psteps.defaults,m);this.each(function(){var a=e(this);a.psteps_version="0.0.1alpha";if(a.hasClass("steps-transformed"))return true;a.addClass("steps-transformed");a.opts=b;var p=a.find(".step-content"),n=a.find(".step-title"),g=a.find(".step-name"),q=a.find(".next-button"),h=a.find(".back-button"),o=a.find(".submit-button"),i=a.find(".next-button, .submit-button"),r=a.find(".step-title").length,s=true,k=false;a.get_max_height=function(a){var b=
-1;a.each(function(){var a=e(this).height();b=a>b?a:b});return b};b.step_order||a.find(".step-order").hide();a.make_step_content_headings=function(){a.find(".step-title").each(function(c){var d=e(this).find(".step-name"),c=a.find(".step-content").eq(c);if(d.length==1){var f=b.content_headings_hr?"<hr/>":"",d='<div class="step-content-name"><'+b.content_headings_element+">"+d.html()+"</"+b.content_headings_element+">"+f+"</div>";b.content_headings_after!=false&&c.find(b.content_headings_after).length>
0?c.find(b.content_headings_after).after(d):c.prepend(d)}})};if(b.content_height_equalize||b.steps_height_equalize||b.steps_width_percentage||b.shrink_step_names){if(b.steps_height_equalize)var j=a.find(".step-title"),m=a.get_max_height(j);if(b.content_height_equalize){j=a.find(".step-content");j.addClass("clearfix");var t=a.get_max_height(j)}e(window).resize(function(){if(b.steps_width_percentage){var c=100/r-1;e(window).width()<parseInt(b.alter_width_at_viewport)&&a.find(".step-title").css({width:c+
"%","padding-left":"0px","padding-right":"0px"})}b.shrink_step_names&&(e(window).width()<=parseInt(b.alter_names_at_viewport)?setTimeout(function(){a.find(".step-content-name").remove();a.find(".step-name").hide();a.find(".step-order").show();a.make_step_content_headings()},200):setTimeout(function(){a.find(".step-content-name").remove();b.step_order||a.find(".step-order").hide();b.step_names&&a.find(".step-name").show();b.content_headings?a.make_step_content_headings():a.find(".step-content-name").remove()},
200));if(b.steps_height_equalize){c=a.find(".step-title");c.css("min-height",m);var d=a.get_max_height(c);c.css("min-height",d)}b.content_height_equalize&&setTimeout(function(){var b=a.find(".step-content");b.css("min-height",t);var c=a.get_max_height(b);b.css("min-height",c)},2E3)}).resize()}a.check_progress_titles=function(){a.find(".step-content").each(function(c){var d=e(this);d.addClass("pstep"+(c+1));c=a.find(".step-title").eq(c);if(b.traverse_titles=="visited"&&c.hasClass("step-visited")||
b.traverse_titles=="never"&&c.hasClass("step-visited")||b.traverse_titles=="always"){var f=b.validation_rule.call(d);f=="warning"?(c.removeClass("step-error btn-info btn-success btn-warning btn-danger").addClass("step-warning"),a.trigger_error(d)):f=="error"?(c.removeClass("step-warning btn-info btn-success btn-warning btn-danger").addClass("step-error"),a.trigger_error(d)):f?(c.removeClass("step-warning btn-info btn-warning btn-danger step-error").addClass("btn-success"),b.check_marks&&c.find("i.step-mark").remove().end().prepend('<i class="icon-ok step-mark"></i> ')):
f||c.removeClass("step-warning btn-info btn-success btn-danger btn-warning step-error").addClass("btn-info").find("i.step-mark").remove()}});a.toggle_buttons_function()};a.toggle_buttons_function=function(){a.find(".step-content").last().hasClass("step-active")?(q.hide(),o.show()):(q.show(),o.hide());var c=a.find(".step-title.step-active");c.hasClass("btn-success")||c.hasClass("step-warning")?i.removeClass("btn-info").addClass("btn-success"):c.hasClass("btn-info")?i.removeClass("btn-success").addClass("btn-info"):
c.hasClass("step-error")&&i.removeClass("btn-success btn-info").addClass("btn-danger");if(b.validate_submit_all_steps){var d;n.each(function(){var a=d;e(this).hasClass("btn-success")||(d=true);e(this).hasClass("step-warning")&&!a&&(d=false);e(this).hasClass("step-error")&&!a&&b.ignore_errors_on_submit&&(d=false)});d&&o.removeClass("btn-success").addClass("btn-info")}b.back?a.find(".step-title").first().hasClass("step-active")?h.hide():(c=a.find(".step-title.step-active").prevAll(".step-title:first"),
c.hasClass("btn-info")?h.removeClass("btn-success btn-warning btn-danger").addClass("btn-info").css("cursor","pointer"):c.hasClass("btn-success")?h.removeClass("btn-info btn-warning btn-danger").addClass("btn-success").css("cursor","pointer"):c.hasClass("btn-warning")?h.removeClass("btn-info btn-success btn-danger").addClass("btn-warning").css("cursor","pointer"):c.hasClass("btn-danger")&&h.removeClass("btn-success btn-warning btn-info").addClass("btn-danger").css("cursor","pointer"),h.show()):h.hide()};
a.go_to_step=function(c){var d=1,f=a.find(".step-title.last-active"),g=a.find(".step-content.last-active"),h=a.find(".step-content.step-active"),i=a.find(".step-title.step-active"),l,j;c>r||(a.find(".step-content").each(function(){d==c&&(l=e(this));d++}),d=1,a.find(".step-title").each(function(){d==c&&(j=e(this));d++}),l.hasClass("step-loaded")||b.steps_onload.call(l),b.steps_hide.call(h),f.removeClass("last-active"),g.removeClass("last-active"),h.hide().removeClass("step-active").addClass("last-active"),
l.show().addClass("step-active step-visited step-loaded"),b.steps_show.call(l),i.removeClass("step-active").addClass("disabled last-active"),j.addClass("step-active step-visited").removeClass("disabled"),b.traverse_titles=="visited"&&i.css("cursor","pointer"),s?s=false:k?k=false:a.check_progress_titles())};a.next_step_function=function(){var b=a.find(".step-title.step-active").prevAll(".step-title").length+2;a.go_to_step(b)};a.previous_step_function=function(){var b=a.find(".step-title.step-active").prevAll(".step-title").length;
a.go_to_step(b)};a.traverse_titles_function=function(){a.change_traverse(b.traverse_titles)};a.change_traverse=function(b){b=="always"?(b=a.find(".step-title"),b.unbind("click"),b.click(function(){var b=e(this).prevAll(".step-title").length+1;a.go_to_step(b)}).css("cursor","pointer")):b=="visited"?(a.find(".step-title.step-visited").css("cursor","pointer"),a.off("click",".step-title.step-visited"),a.on("click",".step-title.step-visited",function(){var b=e(this);b.prevAll(".step-title:first").hasClass("step-active")?
a.next_step_function():b.nextAll(".step-title:first").hasClass("step-active")?a.previous_step_function():(b=b.prevAll(".step-title").length+1,a.go_to_step(b))})):b=="never"&&(b=a.find(".step-title"),b.css("cursor","default"),a.off("click",".step-title.step-active"),a.on("click",".step-title.step-active",function(){var b=e(this).prevAll(".step-title").length+1;a.go_to_step(b)}))};a.trigger_error=function(c){var d=c.prevAll(".step-content").length+1,f,g=1;a.find(".step-title").each(function(){g==d&&
(f=e(this));g++});f.hasClass("step-warning")?(f.removeClass("btn-info btn-success").addClass("btn-warning"),b.check_marks&&f.find("i.step-mark").remove().end().prepend('<i class="icon-remove step-mark"></i> ')):f.hasClass("step-error")&&(f.removeClass("btn-info btn-success").addClass("btn-danger"),b.check_marks&&f.find("i.step-mark").remove().end().prepend('<i class="icon-remove step-mark"></i> '))};p.hide().first().addClass("step-visited step-active").show();n.addClass("disabled btn").first().addClass("step-visited step-active").removeClass("disabled");
b.step_names||g.hide();a.traverse_titles_function();a.check_progress_titles();b.content_headings&&a.make_step_content_headings();b.start_incomplete_step?(g=a.find(".step-title.btn-info").first().prevAll(".step-title"),g=g.length+1,a.go_to_step(g)):b.start_warning_step?(g=a.find(".step-title.step-warning").first().prevAll(".step-title"),g=g.length+1,a.go_to_step(g)):b.start_error_step?(g=a.find(".step-title.step-error").first().prevAll(".step-title"),g=g.length+1,a.go_to_step(g)):a.go_to_step(b.step_start);
h.click(function(){a.previous_step_function()});a.bind("validate_psteps",function(){k=true;a.check_progress_titles()});a.bind("traverse_never",function(){a.change_traverse("never")});a.bind("traverse_always",function(){a.change_traverse("always")});a.bind("traverse_visited",function(){a.change_traverse("visited")});a.bind("load_after_steps",function(){b.load_after_steps.call(a)});p.bind("psteps_step_error",function(){a.trigger_error(e(this))});n.bind("go_to_step",function(){var b=e(this).prevAll(".step-title").length+
1;a.go_to_step(b)});a.bind("go_to_first_incomplete",function(){var b=a.find(".step-title.btn-info:first").prevAll(".step-title").length+1;a.go_to_step(b)});a.bind("go_to_first_warning",function(){var b=a.find(".step-title.step-warning:first").prevAll(".step-title").length+1;a.go_to_step(b)});a.bind("go_to_first_error",function(){var b=a.find(".step-title.step-error:first").prevAll(".step-title").length+1;a.go_to_step(b)});i.click(function(c){var d=e(this);k?k=false:a.check_progress_titles();var f=
a.find(".step-title.step-active");if(f.hasClass("step-error")&&b.validate_errors&&!b.validate_next_step)b.validate_use_error_msg?alert(b.validate_error_msg):f.click();else if(!f.hasClass("step-error")||!b.validate_next_step||b.ignore_errors_on_next)f.hasClass("step-error")&&b.ignore_errors_on_next?a.next_step_function():d.hasClass("btn-success")?a.next_step_function():d.hasClass("submit-button")&&(b.validate_submit_all_steps||b.validate_next_step)?(b.use_before_submit&&alert(b.before_submit),c.preventDefault()):
b.validate_next_step&&b.use_before_next?alert(b.before_next):a.next_step_function()});this.pines_steps=a});return this};e.fn.psteps.defaults={traverse_titles:"never",content_headings:false,content_headings_element:"h4",content_headings_hr:true,content_headings_after:false,step_order:true,step_names:true,check_marks:true,alter_width_at_viewport:"1000",steps_width_percentage:false,steps_height_equalize:false,content_height_equalize:false,alter_names_at_viewport:"650",shrink_step_names:true,back:true,
step_start:"1",steps_onload:function(){},steps_show:function(){},steps_hide:function(){},start_incomplete_step:false,start_warning_step:false,start_error_step:false,validation_rule:function(){return true},validate_next_step:true,validate_submit_all_steps:true,validate_errors:true,ignore_errors_on_next:false,ignore_errors_on_submit:false,validate_error_msg:"There was an error processing the step.",validate_use_error_msg:true,use_before_submit:true,before_submit:"Please complete all of the required steps before submitting.",
use_before_next:true,before_next:"Please complete this step before advancing to the next step.",load_after_steps:function(){}}})(jQuery);
