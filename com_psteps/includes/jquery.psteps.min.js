/*
 * jQuery Pines Steps (psteps) Plugin 0.0.1alpha
 *
 * http://pinesframework.org/psteps/
 * Copyright (c) 2012 Angela Murrell
 *
 * Triple license under the GPL, LGPL, and MPL:
 *	  http://www.gnu.org/licenses/gpl.html
 *	  http://www.gnu.org/licenses/lgpl.html
 *	  http://www.mozilla.org/MPL/MPL-1.1.html
 */
(function(c){c.fn.psteps=function(p){var q=c.extend({},c.fn.psteps.defaults,p);this.each(function(){var a=c(this);a.psteps_version="0.0.1alpha";if(a.hasClass("steps-transformed"))return true;a.addClass("steps-transformed");a.extend(a,q);var l=a.find(".step-content"),m=a.find(".step-title"),n=a.find(".next-button"),g=a.find(".back-button"),j=a.find(".submit-button"),i=a.find(".next-button, .submit-button"),o=a.find(".step-title").length;if(a.steps_width_percentage){var k=o*10;c(window).width()<650&&
a.find(".step-title").css("width",k+"%")}a.shrink_step_names&&c(window).width()<650&&a.find(".step-name").css("display","none");a.check_progress_titles=function(){var b=1;a.find(".step-content").each(function(){var d=1,e=c(this);e.addClass("pstep"+b);a.find(".step-title").each(function(){if(d==b){var f=c(this);if(a.traverse_titles=="visited"&&f.hasClass("step-visited")||a.traverse_titles=="never"&&f.hasClass("step-visited")||a.traverse_titles=="always"){var h=a.validation_rule.call(e);h=="warning"?
(f.addClass("step-warning"),a.trigger_error(e)):h=="error"?(f.addClass("step-error"),a.trigger_error(e)):h?f.removeClass("btn-info").addClass("btn-success").find("i").remove().end().prepend('<i class="icon-ok"></i> '):h||f.removeClass("btn-success").addClass("btn-info").find("i").remove()}}d++});b++});a.toggle_buttons_function()};a.toggle_buttons_function=function(){a.find(".step-content").last().hasClass("step-active")?(n.hide(),j.show()):(n.show(),j.hide());var b=a.find(".step-title.step-active");
b.hasClass("btn-success")||b.hasClass("step-warning")?i.removeClass("btn-info").addClass("btn-success"):b.hasClass("btn-info")?i.removeClass("btn-success").addClass("btn-info"):b.hasClass("step-error")&&i.removeClass("btn-success btn-info").addClass("btn-danger");if(a.validate_submit_all_steps){var d;m.each(function(){var a=d;c(this).hasClass("btn-success")||(d=true);c(this).hasClass("step-warning")&&!a&&(d=false)});d&&j.removeClass("btn-success").addClass("btn-info")}a.back?a.find(".step-title").first().hasClass("step-active")?
g.hide():(b=a.find(".step-title.step-active").prev(".step-title"),b.hasClass("btn-info")?g.removeClass("btn-success btn-warning btn-danger").addClass("btn-info").css("cursor","pointer"):b.hasClass("btn-success")?g.removeClass("btn-info btn-warning btn-danger").addClass("btn-success").css("cursor","pointer"):b.hasClass("btn-warning")?g.removeClass("btn-info btn-success btn-danger").addClass("btn-warning").css("cursor","pointer"):b.hasClass("btn-danger")&&g.removeClass("btn-success btn-warning btn-info").addClass("btn-danger").css("cursor",
"pointer"),g.show()):g.hide()};a.go_to_step=function(b){var d=1,e=a.find(".step-content.step-active"),f=a.find(".step-title.step-active"),h,g;b>o||(a.find(".step-content").each(function(){d==b&&(h=c(this));d++}),d=1,a.find(".step-title").each(function(){d==b&&(g=c(this));d++}),h.hasClass("step-loaded")||a.steps_onload.call(h),e.hide().removeClass("step-active"),h.show().addClass("step-active step-visited step-loaded"),f.removeClass("step-active").addClass("disabled"),g.addClass("step-active step-visited").removeClass("disabled"),
a.traverse_titles=="visited"&&f.css("cursor","pointer"),a.check_progress_titles())};a.next_step_function=function(){var b=a.find(".step-title.step-active").prevAll(".step-title").length+2;a.go_to_step(b)};a.previous_step_function=function(){var b=a.find(".step-title.step-active").prevAll(".step-title").length;a.go_to_step(b)};a.traverse_titles_function=function(){if(a.traverse_titles=="always")a.find(".step-title").click(function(){var b=c(this).prevAll(".step-title").length+1;a.go_to_step(b)}).css("cursor",
"pointer");else if(a.traverse_titles=="visited")a.on("click",".step-title.step-visited",function(){var b=c(this);b.prev(".step-title").hasClass("step-active")?a.next_step_function():b.next(".step-title").hasClass("step-active")?a.previous_step_function():(b=b.prevAll(".step-title").length+1,a.go_to_step(b))})};a.trigger_error=function(b){var d=b.prevAll(".step-content").length+1,e,f=1;a.find(".step-title").each(function(){f==d&&(e=c(this));f++});e.hasClass("step-warning")?e.removeClass("btn-info btn-success").addClass("btn-warning").find("i").remove().end().prepend('<i class="icon-remove"></i> '):
e.hasClass("step-error")&&e.removeClass("btn-info btn-success").addClass("btn-danger").find("i").remove().end().prepend('<i class="icon-remove"></i> ')};l.hide().first().addClass("step-visited step-active").show();m.addClass("disabled").first().addClass("step-visited step-active").removeClass("disabled");a.traverse_titles_function();a.check_progress_titles();a.start_incomplete_step?(k=a.find(".step-title.btn-info").first().prevAll(".step-title").length+1,a.go_to_step(k)):a.go_to_step(a.step_start);
g.click(function(){a.previous_step_function()});a.bind("validate_psteps",function(){a.check_progress_titles()});l.bind("psteps_step_error",function(){a.trigger_error(c(this))});i.click(function(b){var d=c(this),e=a.find(".step-title.step-active");e.hasClass("step-error")?a.validate_use_error_msg?alert(a.validate_error_msg):e.click():d.hasClass("btn-success")?a.next_step_function():d.hasClass("submit-button")&&(a.validate_submit_all_steps||a.validate_next_step)?(alert(a.before_submit),b.preventDefault()):
a.validate_next_step?alert(a.before_next):a.next_step_function()});this.pines_steps=a});return this};c.fn.psteps.defaults={traverse_titles:"never",steps_width_percentage:false,shrink_step_names:true,back:true,step_start:"1",steps_onload:function(){},start_incomplete_step:false,validation_rule:function(){return true},validate_next_step:true,validate_submit_all_steps:true,validate_errors:true,validate_error_msg:"There was an error processing the step.",validate_use_error_msg:true,before_submit:"Please complete all of the required steps before submitting.",
before_next:"Please complete this step before advancing to the next step."}})(jQuery);
