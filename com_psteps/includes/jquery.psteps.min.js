/*
 * jQuery Pines Steps (psteps) Plugin 0.0.1alpha
 *
 * http://pinesframework.org/psteps/
 * Copyright (c) 2012 Angela Murrell
 *
 * Triple license under the GPL, LGPL, and MPL:
 *	  http://www.gnu.org/licenses/gpl.html
 *	  http://www.gnu.org/licenses/lgpl.html
 *	  http://www.mozilla.org/MPL/MPL-1.1.html
 */
(function(f){f.fn.psteps=function(m){var c=f.extend({},f.fn.psteps.defaults,m);this.each(function(){var a=f(this);a.psteps_version="0.0.1alpha";if(a.hasClass("steps-transformed"))return true;a.addClass("steps-transformed");a.opts=c;var o=a.find(".step-content"),i=a.find(".step-title"),g=a.find(".step-name"),p=a.find(".next-button"),h=a.find(".back-button"),n=a.find(".submit-button"),j=a.find(".next-button, .submit-button"),q=a.find(".step-title").length,r=true;a.get_max_height=function(a){var c=-1;
a.each(function(){var a=f(this).height();c=a>c?a:c});return c};c.step_order||a.find(".step-order").hide();a.make_step_content_headings=function(){a.find(".step-title").each(function(b){var d=f(this).find(".step-name"),b=a.find(".step-content").eq(b);if(d.length==1){var e=c.content_headings_hr?"<hr/>":"",d='<div class="step-content-name"><'+c.content_headings_element+">"+d.html()+"</"+c.content_headings_element+">"+e+"</div>";c.content_headings_after!=false&&b.find(c.content_headings_after).length>
0?b.find(c.content_headings_after).after(d):b.prepend(d)}})};if(c.content_height_equalize||c.steps_height_equalize||c.steps_width_percentage||c.shrink_step_names){if(c.steps_height_equalize)var l=a.find(".step-title"),m=a.get_max_height(l);if(c.content_height_equalize){l=a.find(".step-content");l.addClass("clearfix");var t=a.get_max_height(l)}f(window).resize(function(){if(c.steps_width_percentage){var b=100/q-1;f(window).width()<parseInt(c.alter_width_at_viewport)&&a.find(".step-title").css({width:b+
"%","padding-left":"0","padding-right":"0"})}c.shrink_step_names&&(f(window).width()<=parseInt(c.alter_names_at_viewport)?setTimeout(function(){a.find(".step-content-name").remove();a.find(".step-name").hide();a.find(".step-order").show();a.make_step_content_headings()},200):setTimeout(function(){a.find(".step-content-name").remove();c.step_order||a.find(".step-order").hide();c.step_names&&a.find(".step-name").show();c.content_headings&&a.make_step_content_headings()},200));c.steps_height_equalize&&
(b=a.find(".step-title"),b.css("min-height",m),b.css("min-height",a.get_max_height(b)));c.content_height_equalize&&setTimeout(function(){var b=a.find(".step-content");b.css("min-height",t);b.css("min-height",a.get_max_height(b))},2E3)}).resize()}a.check_progress_titles=function(){a.find(".step-content").each(function(b){var d=f(this);d.addClass("pstep"+(b+1));b=a.find(".step-title").eq(b);if(c.traverse_titles=="visited"&&b.hasClass("step-visited")||c.traverse_titles=="never"&&b.hasClass("step-visited")||
c.traverse_titles=="always"){var e=c.validation_rule.call(d);e=="warning"?(b.removeClass("step-error btn-info btn-success btn-warning btn-danger").addClass("step-warning"),a.trigger_error(d)):e=="error"?(b.removeClass("step-warning btn-info btn-success btn-warning btn-danger").addClass("step-error"),a.trigger_error(d)):e?(b.removeClass("step-warning btn-info btn-warning btn-danger step-error").addClass("btn-success"),c.check_marks&&b.find("i.step-mark").remove().end().prepend('<i class="icon-ok step-mark"></i> ')):
e||b.removeClass("step-warning btn-info btn-success btn-danger btn-warning step-error").addClass("btn-info").find("i.step-mark").remove()}});a.toggle_buttons_function();a.trigger("validation_complete")};a.toggle_buttons_function=function(){a.find(".step-content").last().hasClass("step-active")?(p.hide(),n.show()):(p.show(),n.hide());var b=a.find(".step-title.step-active");b.hasClass("btn-success")||b.hasClass("step-warning")?j.removeClass("btn-info").addClass("btn-success"):b.hasClass("btn-info")?
j.removeClass("btn-success").addClass("btn-info"):b.hasClass("step-error")&&j.removeClass("btn-success btn-info").addClass("btn-danger");c.validate_submit_all_steps&&(i.filter(".btn-info").length||i.filter(".step-error").length&&!c.ignore_errors_on_submit)&&n.removeClass("btn-success").addClass("btn-info");c.back?a.find(".step-title").first().hasClass("step-active")?h.hide():(b=a.find(".step-title.step-active").prevAll(".step-title:first"),b.hasClass("btn-info")?h.removeClass("btn-success btn-warning btn-danger").addClass("btn-info").css("cursor",
"pointer"):b.hasClass("btn-success")?h.removeClass("btn-info btn-warning btn-danger").addClass("btn-success").css("cursor","pointer"):b.hasClass("btn-warning")?h.removeClass("btn-info btn-success btn-danger").addClass("btn-warning").css("cursor","pointer"):b.hasClass("btn-danger")&&h.removeClass("btn-success btn-warning btn-info").addClass("btn-danger").css("cursor","pointer"),h.show()):h.hide()};a.go_to_step=function(b){var d=1,e=a.find(".step-title.last-active"),g=a.find(".step-content.last-active"),
h=a.find(".step-content.step-active"),i=a.find(".step-title.step-active"),k,j;b>q||(a.find(".step-content").each(function(){d==b&&(k=f(this));d++}),d=1,a.find(".step-title").each(function(){d==b&&(j=f(this));d++}),k.hasClass("step-loaded")||c.steps_onload.call(k),c.steps_hide.call(h),e.removeClass("last-active"),g.removeClass("last-active"),h.hide().removeClass("step-active").addClass("last-active"),k.show().addClass("step-active step-visited step-loaded"),c.steps_show.call(k),i.removeClass("step-active").addClass("disabled last-active"),
j.addClass("step-active step-visited").removeClass("disabled"),c.traverse_titles=="visited"&&i.css("cursor","pointer"),r?r=false:a.trigger("validate_psteps"),a.toggle_buttons_function())};a.next_step_function=function(){var b=a.find(".step-title.step-active").prevAll(".step-title").length+2;a.go_to_step(b)};a.previous_step_function=function(){var b=a.find(".step-title.step-active").prevAll(".step-title").length;a.go_to_step(b)};a.traverse_titles_function=function(){a.change_traverse(c.traverse_titles)};
a.change_traverse=function(b){b=="always"?(b=a.find(".step-title"),b.unbind("click"),b.click(function(){var b=f(this).prevAll(".step-title").length+1;a.go_to_step(b)}).css("cursor","pointer")):b=="visited"?(a.find(".step-title.step-visited").css("cursor","pointer"),a.off("click",".step-title.step-visited"),a.on("click",".step-title.step-visited",function(){var b=f(this);b.prevAll(".step-title:first").hasClass("step-active")?a.next_step_function():b.nextAll(".step-title:first").hasClass("step-active")?
a.previous_step_function():(b=b.prevAll(".step-title").length+1,a.go_to_step(b))})):b=="never"&&(b=a.find(".step-title"),b.css("cursor","default"),a.off("click",".step-title.step-active"),a.on("click",".step-title.step-active",function(){var b=f(this).prevAll(".step-title").length+1;a.go_to_step(b)}))};a.trigger_error=function(b){var d=b.prevAll(".step-content").length+1,e,g=1;a.find(".step-title").each(function(){g==d&&(e=f(this));g++});e.hasClass("step-warning")?(e.removeClass("btn-info btn-success").addClass("btn-warning"),
c.check_marks&&e.find("i.step-mark").remove().end().prepend('<i class="icon-remove step-mark"></i> ')):e.hasClass("step-error")&&(e.removeClass("btn-info btn-success").addClass("btn-danger"),c.check_marks&&e.find("i.step-mark").remove().end().prepend('<i class="icon-remove step-mark"></i> '))};o.hide().first().addClass("step-visited step-active").show();i.addClass("disabled btn").first().addClass("step-visited step-active").removeClass("disabled");c.step_names||g.hide();a.traverse_titles_function();
a.check_progress_titles();c.content_headings&&a.make_step_content_headings();c.start_incomplete_step?(g=a.find(".step-title.btn-info").first().prevAll(".step-title"),g=g.length+1,a.go_to_step(g)):c.start_warning_step?(g=a.find(".step-title.step-warning").first().prevAll(".step-title"),g=g.length+1,a.go_to_step(g)):c.start_error_step?(g=a.find(".step-title.step-error").first().prevAll(".step-title"),g=g.length+1,a.go_to_step(g)):a.go_to_step(c.step_start);h.click(function(){a.previous_step_function()});
var s=0;a.bind("validate_psteps",function(b){console.log(b);b.timeStamp<s+500?(b.preventDefault(),b.stopPropagation()):(s=b.timeStamp,a.check_progress_titles())});a.bind("traverse_never",function(){a.change_traverse("never")});a.bind("traverse_always",function(){a.change_traverse("always")});a.bind("traverse_visited",function(){a.change_traverse("visited")});a.bind("load_after_steps",function(){c.load_after_steps.call(a)});o.bind("psteps_step_error",function(){a.trigger_error(f(this))});i.bind("go_to_step",
function(){var b=f(this).prevAll(".step-title").length+1;a.go_to_step(b)});a.bind("go_to_first_incomplete",function(){var b=a.find(".step-title.btn-info:first").prevAll(".step-title").length+1;a.go_to_step(b)});a.bind("go_to_first_warning",function(){var b=a.find(".step-title.step-warning:first").prevAll(".step-title").length+1;a.go_to_step(b)});a.bind("go_to_first_error",function(){var b=a.find(".step-title.step-error:first").prevAll(".step-title").length+1;a.go_to_step(b)});j.click(function(b){var d=
f(this);a.trigger("validate_psteps");var e=a.find(".step-title.step-active");if(e.hasClass("step-error")&&c.validate_errors&&!c.validate_next_step)c.validate_use_error_msg?alert(c.validate_error_msg):e.click();else if(!e.hasClass("step-error")||!c.validate_next_step||c.ignore_errors_on_next)e.hasClass("step-error")&&c.ignore_errors_on_next?a.next_step_function():d.hasClass("btn-success")?a.next_step_function():d.hasClass("submit-button")&&(c.validate_submit_all_steps||c.validate_next_step)?(c.use_before_submit&&
alert(c.before_submit),b.preventDefault()):c.validate_next_step&&c.use_before_next?alert(c.before_next):a.next_step_function()});this.pines_steps=a});return this};f.fn.psteps.defaults={traverse_titles:"never",content_headings:false,content_headings_element:"h4",content_headings_hr:true,content_headings_after:false,step_order:true,step_names:true,check_marks:true,alter_width_at_viewport:"1000",steps_width_percentage:false,steps_height_equalize:false,content_height_equalize:false,alter_names_at_viewport:"650",
shrink_step_names:true,back:true,step_start:"1",steps_onload:function(){},steps_show:function(){},steps_hide:function(){},start_incomplete_step:false,start_warning_step:false,start_error_step:false,validation_rule:function(){return true},validate_next_step:true,validate_submit_all_steps:true,validate_errors:true,ignore_errors_on_next:false,ignore_errors_on_submit:false,validate_error_msg:"There was an error processing the step.",validate_use_error_msg:true,use_before_submit:true,before_submit:"Please complete all of the required steps before submitting.",
use_before_next:true,before_next:"Please complete this step before advancing to the next step.",load_after_steps:function(){}}})(jQuery);
