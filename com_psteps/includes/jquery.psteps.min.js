/*
 * jQuery Pines Steps (psteps) Plugin 0.0.1alpha
 *
 * http://pinesframework.org/psteps/
 * Copyright (c) 2012 Angela Murrell
 *
 * Triple license under the GPL, LGPL, and MPL:
 *	  http://www.gnu.org/licenses/gpl.html
 *	  http://www.gnu.org/licenses/lgpl.html
 *	  http://www.mozilla.org/MPL/MPL-1.1.html
 */
(function(e){e.fn.psteps=function(l){var s=e.extend({},e.fn.psteps.defaults,l);this.each(function(){var a=e(this);a.psteps_version="0.0.1alpha";if(a.hasClass("steps-transformed"))return true;a.addClass("steps-transformed");a.extend(a,s);var o=a.find(".step-content"),m=a.find(".step-title"),c=a.find(".step-name"),p=a.find(".next-button"),f=a.find(".back-button"),n=a.find(".submit-button"),h=a.find(".next-button, .submit-button"),q=a.find(".step-title").length,r=true,j=false;a.get_max_height=function(a){var d=
-1;a.each(function(){var a=e(this).height();d=a>d?a:d});return d};a.step_order||a.find(".step-order").hide();a.make_step_content_headings=function(){var b=1;a.find(".step-name").each(function(){var d=1,g=e(this);a.find(".step-content").each(function(){if(b==d){var a=e(this);g.length==1&&a.prepend('<div class="step-content-name"><h4>'+g.html()+"</h4><hr/></div>")}d++});b++})};if(a.content_height_equalize||a.steps_height_equalize||a.steps_width_percentage||a.shrink_step_names){if(a.steps_height_equalize)var i=
a.find(".step-title"),l=a.get_max_height(i);if(a.content_height_equalize){i=a.find(".step-content");i.addClass("clearfix");var t=a.get_max_height(i)}e(window).resize(function(){if(a.steps_width_percentage){var b=100/q-1;e(window).width()<parseInt(a.alter_width_at_viewport)&&a.find(".step-title").css({width:b+"%","padding-left":"0px","padding-right":"0px"})}a.shrink_step_names&&(e(window).width()<=parseInt(a.alter_names_at_viewport)?setTimeout(function(){a.find(".step-content-name").remove();a.find(".step-name").hide();
a.find(".step-order").show();a.make_step_content_headings()},200):setTimeout(function(){a.find(".step-content-name").remove();a.step_order||a.find(".step-order").hide();a.step_names&&a.find(".step-name").show();a.content_headings?a.make_step_content_headings():a.find(".step-content-name").remove()},200));if(a.steps_height_equalize){b=a.find(".step-title");b.css("min-height",l);var d=a.get_max_height(b);b.css("min-height",d)}a.content_height_equalize&&setTimeout(function(){var b=a.find(".step-content");
b.css("min-height",t);var d=a.get_max_height(b);b.css("min-height",d)},2E3)}).resize()}a.check_progress_titles=function(){var b=1;a.find(".step-content").each(function(){var d=1,g=e(this);g.addClass("pstep"+b);a.find(".step-title").each(function(){if(d==b){var c=e(this);if(a.traverse_titles=="visited"&&c.hasClass("step-visited")||a.traverse_titles=="never"&&c.hasClass("step-visited")||a.traverse_titles=="always"){var f=a.validation_rule.call(g);f=="warning"?(c.removeClass("step-error btn-info btn-success btn-warning btn-danger").addClass("step-warning"),
a.trigger_error(g)):f=="error"?(c.removeClass("step-warning btn-info btn-success btn-warning btn-danger").addClass("step-error"),a.trigger_error(g)):f?(c.removeClass("step-warning btn-info btn-warning btn-danger step-error").addClass("btn-success"),a.check_marks&&c.find("i.step-mark").remove().end().prepend('<i class="icon-ok step-mark"></i> ')):f||c.removeClass("step-warning btn-info btn-success btn-danger btn-warning step-error").addClass("btn-info").find("i.step-mark").remove()}}d++});b++});a.toggle_buttons_function()};
a.toggle_buttons_function=function(){a.find(".step-content").last().hasClass("step-active")?(p.hide(),n.show()):(p.show(),n.hide());var b=a.find(".step-title.step-active");b.hasClass("btn-success")||b.hasClass("step-warning")?h.removeClass("btn-info").addClass("btn-success"):b.hasClass("btn-info")?h.removeClass("btn-success").addClass("btn-info"):b.hasClass("step-error")&&h.removeClass("btn-success btn-info").addClass("btn-danger");if(a.validate_submit_all_steps){var d;m.each(function(){var b=d;e(this).hasClass("btn-success")||
(d=true);e(this).hasClass("step-warning")&&!b&&(d=false);e(this).hasClass("step-error")&&!b&&a.ignore_errors_on_submit&&(d=false)});d&&n.removeClass("btn-success").addClass("btn-info")}a.back?a.find(".step-title").first().hasClass("step-active")?f.hide():(b=a.find(".step-title.step-active").prevAll(".step-title:first"),b.hasClass("btn-info")?f.removeClass("btn-success btn-warning btn-danger").addClass("btn-info").css("cursor","pointer"):b.hasClass("btn-success")?f.removeClass("btn-info btn-warning btn-danger").addClass("btn-success").css("cursor",
"pointer"):b.hasClass("btn-warning")?f.removeClass("btn-info btn-success btn-danger").addClass("btn-warning").css("cursor","pointer"):b.hasClass("btn-danger")&&f.removeClass("btn-success btn-warning btn-info").addClass("btn-danger").css("cursor","pointer"),f.show()):f.hide()};a.go_to_step=function(b){var d=1,g=a.find(".step-title.last-active"),c=a.find(".step-content.last-active"),f=a.find(".step-content.step-active"),h=a.find(".step-title.step-active"),k,i;b>q||(a.find(".step-content").each(function(){d==
b&&(k=e(this));d++}),d=1,a.find(".step-title").each(function(){d==b&&(i=e(this));d++}),k.hasClass("step-loaded")||a.steps_onload.call(k),a.steps_hide.call(f),g.removeClass("last-active"),c.removeClass("last-active"),f.hide().removeClass("step-active").addClass("last-active"),k.show().addClass("step-active step-visited step-loaded"),a.steps_show.call(k),h.removeClass("step-active").addClass("disabled last-active"),i.addClass("step-active step-visited").removeClass("disabled"),a.traverse_titles=="visited"&&
h.css("cursor","pointer"),r?r=false:j?j=false:a.check_progress_titles())};a.next_step_function=function(){var b=a.find(".step-title.step-active").prevAll(".step-title").length+2;a.go_to_step(b)};a.previous_step_function=function(){var b=a.find(".step-title.step-active").prevAll(".step-title").length;a.go_to_step(b)};a.traverse_titles_function=function(){a.change_traverse(a.traverse_titles)};a.change_traverse=function(b){b=="always"?(b=a.find(".step-title"),b.unbind("click"),b.click(function(){var b=
e(this).prevAll(".step-title").length+1;a.go_to_step(b)}).css("cursor","pointer")):b=="visited"?(a.find(".step-title.step-visited").css("cursor","pointer"),a.off("click",".step-title.step-visited"),a.on("click",".step-title.step-visited",function(){var b=e(this);b.prevAll(".step-title:first").hasClass("step-active")?a.next_step_function():b.nextAll(".step-title:first").hasClass("step-active")?a.previous_step_function():(b=b.prevAll(".step-title").length+1,a.go_to_step(b))})):b=="never"&&(b=a.find(".step-title"),
b.css("cursor","default"),a.off("click",".step-title.step-active"),a.on("click",".step-title.step-active",function(){var b=e(this).prevAll(".step-title").length+1;a.go_to_step(b)}))};a.trigger_error=function(b){var d=b.prevAll(".step-content").length+1,c,f=1;a.find(".step-title").each(function(){f==d&&(c=e(this));f++});c.hasClass("step-warning")?(c.removeClass("btn-info btn-success").addClass("btn-warning"),a.check_marks&&c.find("i.step-mark").remove().end().prepend('<i class="icon-remove step-mark"></i> ')):
c.hasClass("step-error")&&(c.removeClass("btn-info btn-success").addClass("btn-danger"),a.check_marks&&c.find("i.step-mark").remove().end().prepend('<i class="icon-remove step-mark"></i> '))};o.hide().first().addClass("step-visited step-active").show();m.addClass("disabled btn").first().addClass("step-visited step-active").removeClass("disabled");a.step_names||c.hide();a.traverse_titles_function();a.check_progress_titles();a.content_headings&&a.make_step_content_headings();a.start_incomplete_step?
(c=a.find(".step-title.btn-info").first().prevAll(".step-title"),c=c.length+1,a.go_to_step(c)):a.start_warning_step?(c=a.find(".step-title.step-warning").first().prevAll(".step-title"),c=c.length+1,a.go_to_step(c)):a.start_error_step?(c=a.find(".step-title.step-error").first().prevAll(".step-title"),c=c.length+1,a.go_to_step(c)):a.go_to_step(a.step_start);f.click(function(){a.previous_step_function()});a.bind("validate_psteps",function(){j=true;a.check_progress_titles()});a.bind("traverse_never",
function(){a.change_traverse("never")});a.bind("traverse_always",function(){a.change_traverse("always")});a.bind("traverse_visited",function(){a.change_traverse("visited")});a.bind("load_after_steps",function(){a.load_after_steps.call(a)});o.bind("psteps_step_error",function(){a.trigger_error(e(this))});m.bind("go_to_step",function(){var b=e(this).prevAll(".step-title").length+1;a.go_to_step(b)});a.bind("go_to_first_incomplete",function(){var b=a.find(".step-title.btn-info:first").prevAll(".step-title").length+
1;a.go_to_step(b)});a.bind("go_to_first_warning",function(){var b=a.find(".step-title.step-warning:first").prevAll(".step-title").length+1;a.go_to_step(b)});a.bind("go_to_first_error",function(){var b=a.find(".step-title.step-error:first").prevAll(".step-title").length+1;a.go_to_step(b)});h.click(function(b){var c=e(this);j?j=false:a.check_progress_titles();var f=a.find(".step-title.step-active");if(f.hasClass("step-error")&&a.validate_errors&&!a.validate_next_step)a.validate_use_error_msg?alert(a.validate_error_msg):
f.click();else if(!f.hasClass("step-error")||!a.validate_next_step||a.ignore_errors_on_next)f.hasClass("step-error")&&a.ignore_errors_on_next?a.next_step_function():c.hasClass("btn-success")?a.next_step_function():c.hasClass("submit-button")&&(a.validate_submit_all_steps||a.validate_next_step)?(a.use_before_submit&&alert(a.before_submit),b.preventDefault()):a.validate_next_step&&a.use_before_next?alert(a.before_next):a.next_step_function()});this.pines_steps=a});return this};e.fn.psteps.defaults=
{traverse_titles:"never",content_headings:false,step_order:true,step_names:true,check_marks:true,alter_width_at_viewport:"1000",steps_width_percentage:false,steps_height_equalize:false,content_height_equalize:false,alter_names_at_viewport:"650",shrink_step_names:true,back:true,step_start:"1",steps_onload:function(){},steps_show:function(){},steps_hide:function(){},start_incomplete_step:false,start_warning_step:false,start_error_step:false,validation_rule:function(){return true},validate_next_step:true,
validate_submit_all_steps:true,validate_errors:true,ignore_errors_on_next:false,ignore_errors_on_submit:false,validate_error_msg:"There was an error processing the step.",validate_use_error_msg:true,use_before_submit:true,before_submit:"Please complete all of the required steps before submitting.",use_before_next:true,before_next:"Please complete this step before advancing to the next step.",load_after_steps:function(){}}})(jQuery);
