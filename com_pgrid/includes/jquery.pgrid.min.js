/*
 * jQuery Pines Grid (pgrid) Plugin 1.0
 *
 * Copyright (c) 2009 Hunter Perrin
 *
 * Licensed (along with all of Pines) under the GNU Affero GPL:
 *	  http://www.gnu.org/licenses/agpl.html
 */
(function(c){c.fn.pgrid_add=function(e,f){if(!e)return this;this.each(function(){if(this.pines_grid){var a=this.pines_grid,l=false;c.each(e,function(){var m=this,o=c("<tr />").attr("title",String(m.key)).addClass(m.classes?m.classes:"").each(function(){var q=c(this);m.values&&c.each(m.values,function(){q.append(c("<td>"+String(this)+"</td>"))})});a.children("tbody").append(o);l=l?l.add(o):o});a.init_rows(l);a.do_col_hiding(true);a.do_sort(false,true);a.do_filter(false,true);a.paginate(true);a.update_selected();
f&&l.each(f)}});return this};c.fn.pgrid_delete=function(e){if(e)this.each(function(){var a=this.pines_grid;if(a){e.jquery?e.each(function(){a.mark_for_delete_recursively(c(this))}):c.each(e,function(){var l=this;typeof l=="object"?a.mark_for_delete_recursively(c(this)):a.children("tbody").children("tr[title="+l+"]").each(function(){a.mark_for_delete_recursively(c(this))})});a.delete_marked()}});else{var f=this.closest("table.ui-pgrid-table").get(0);if(f)f=f.pines_grid;if(!f)return this;this.each(function(){f.mark_for_delete_recursively(c(this))});
f.delete_marked()}return this};c.fn.pgrid_export_rows=function(e){var f=[];e||(e=this);c.each(e,function(){var a=c(this),l=a.attr("title"),m=a.attr("class"),o=[];a.children("td:not(.ui-pgrid-table-expander)").each(function(){o=c.merge(o,[c(this).text()])});f=c.merge(f,[{key:typeof l=="undefined"?"":l,classes:typeof m=="undefined"?"":m.replace(/\bui-[a-z0-9 \-]+/,""),values:o}])});return f};c.fn.pgrid_select_rows=function(e){var f=null;if(e)f=this.get(0);else{e=this;f=e.closest(".ui-pgrid-table").get(0)}if(f&&
f.pines_grid)f=f.pines_grid;if(!f)return this;if(!e.jquery){if(typeof e!="object")return this;e=f.children("tbody").children("tr[title='"+e.join("'], tr[title='")+"']")}if(f.pgrid_select){if((f.children("tbody").children("tr.ui-pgrid-table-row-selected").length||e.length>1)&&!f.pgrid_multi_select)return this;e.addClass("ui-pgrid-table-row-selected ui-state-active");f.update_selected()}return this};c.fn.pgrid_deselect_rows=function(e){var f=null;if(e)f=this.get(0);else{e=this;f=e.closest("table.ui-pgrid-table").get(0)}if(f&&
f.pines_grid)f=f.pines_grid;if(!f)return this;if(!e.jquery){if(typeof e!="object")return this;e=f.children("tbody").children("tr[title='"+e.join("'], tr[title='")+"']")}if(f.pgrid_select){e.removeClass("ui-pgrid-table-row-selected").removeClass("ui-state-active");f.update_selected()}return this};c.fn.pgrid_get_all_rows=function(){var e=false;this.each(function(){if(this.pines_grid.jquery){var f=this.pines_grid;e=e?e.add(f.children("tbody").children()):f.children("tbody").children()}});return e};c.fn.pgrid_get_selected_rows=
function(){var e=false;this.each(function(){if(this.pines_grid.jquery){var f=this.pines_grid;e=e?e.add(f.children("tbody").children("tr.ui-pgrid-table-row-selected")):f.children("tbody").children("tr.ui-pgrid-table-row-selected")}});return e};c.fn.pgrid_add_descendent_rows=function(){var e=c(this);this.filter("tr.parent").each(function(){var f=c(this);f=f.siblings("."+f.attr("title"));e=e.add(f.pgrid_add_descendent_rows())});return e};c.fn.pgrid_get_value=function(e){return c(this).eq(0).children("td.col_"+
e).html()};c.fn.pgrid_set_value=function(e,f){this.children("td.col_"+e).html(f)};c.fn.pgrid_export_state=function(){var e=this.get(0);if(e&&e.pines_grid)e=e.pines_grid;if(e.jquery)return e.export_state();return false};c.fn.pgrid_import_state=function(e){this.each(function(){this.pines_grid&&this.pines_grid.import_state(e)});return this};c.fn.pgrid=function(e){var f=c.extend({},c.fn.pgrid.defaults,e);this.filter("table:not(.ui-pgrid-table)").each(function(){var a=c(this);a.pgrid_version="1.0.0";a.extend(a,
f);a.pgrid_pages=null;a.pgrid_widget=c("<div />");a.pgrid_table_container=c("<div />");a.pgrid_header_select=c("<div />");a.wrapAll(a.pgrid_widget);a.pgrid_widget=a.parent();a.detach();a.pgrid_widget.addClass("ui-pgrid ui-widget ui-widget-content ui-corner-all");a.pgrid_table_container.addClass("ui-pgrid-table-container");a.pgrid_table_container.append(a);a.addClass("ui-pgrid-table");a.pgrid_select&&a.addClass("ui-pgrid-selectable");a.pgrid_toolbar_contents=a.pgrid_toolbar_contents.slice();a.pgrid_hidden_cols=
a.pgrid_hidden_cols.slice();if(!a.pgrid_hidden_cols.indexOf)a.pgrid_hidden_cols.indexOf=function(b,d){var g=this.length>>>0;d=Number(d)||0;d=d<0?Math.ceil(d):Math.floor(d);if(d<0)d+=g;for(;d<g;d++)if(d in this&&this[d]===b)return d;return-1};a.export_state=function(){return{pgrid_page:a.pgrid_page,pgrid_perpage:a.pgrid_perpage,pgrid_filter:a.pgrid_filter,pgrid_hidden_cols:a.pgrid_hidden_cols.slice(),pgrid_sort_col:a.pgrid_sort_col,pgrid_sort_ord:a.pgrid_sort_ord,pgrid_view_height:a.pgrid_table_viewport.height()+
"px"}};a.import_state=function(b){if(typeof b.pgrid_page!==undefined)a.pgrid_page=b.pgrid_page;if(typeof b.pgrid_perpage!==undefined)a.pgrid_perpage=b.pgrid_perpage;if(typeof b.pgrid_filter!==undefined)a.pgrid_filter=b.pgrid_filter;if(typeof b.pgrid_hidden_cols!==undefined)a.pgrid_hidden_cols=b.pgrid_hidden_cols.slice(0);if(typeof b.pgrid_sort_col!==undefined)a.pgrid_sort_col=b.pgrid_sort_col;if(typeof b.pgrid_sort_ord!==undefined)a.pgrid_sort_ord=b.pgrid_sort_ord!="desc"?"asc":"desc";typeof b.pgrid_view_height!==
undefined&&a.pgrid_table_viewport.css("height",b.pgrid_view_height);a.do_filter(a.pgrid_filter);a.do_sort();a.do_col_hiding();a.pgrid_footer&&a.pgrid_filtering&&a.footer.children("div.ui-pgrid-footer-filter-container").find("span:first-child input").val(a.pgrid_filter);a.pgrid_footer&&a.pgrid_paginate&&a.footer.children("div.ui-pgrid-footer-pager-container").find("span:first-child input").val(a.pgrid_perpage)};a.state_changed=function(){if(a.pgrid_state_change)return a.pgrid_state_change(a.export_state());
return null};a.pagestart=function(){a.pgrid_page=0;a.paginate()};a.pageprev=function(){a.pgrid_page--;if(a.pgrid_page<0)a.pgrid_page=0;a.paginate()};a.pagenext=function(){a.pgrid_page++;if(a.pgrid_page>=a.pgrid_pages)a.pgrid_page=a.pgrid_pages-1;a.paginate()};a.pageend=function(){a.pgrid_page=a.pgrid_pages-1;a.paginate()};a.pagenum=function(b){a.pgrid_page=b;if(isNaN(a.pgrid_page)||a.pgrid_page<0)a.pgrid_page=0;else if(a.pgrid_page>=a.pgrid_pages)a.pgrid_page=a.pgrid_pages-1;a.paginate()};a.set_per_page=
function(b){a.pgrid_page=0;a.pgrid_perpage=b;if(a.pgrid_perpage===0)a.pgrid_perpage=1;a.paginate()};a.hide_children=function(b){b=b.filter("tr.parent");b.length&&b.each(function(){var d=c(this);d.siblings("tr."+d.attr("title")+".ui-pgrid-table-row-visible").removeClass("ui-pgrid-table-row-visible").filter("tr.parent").each(function(){a.hide_children(c(this))})})};a.show_children=function(b){b=b.filter("tr.parent.ui-pgrid-table-row-expanded");b.length&&b.each(function(){var d=c(this);d.siblings("tr."+
d.attr("title")).addClass("ui-pgrid-table-row-visible").filter("tr.parent.ui-pgrid-table-row-expanded").each(function(){a.show_children(c(this))})})};a.mark_for_delete_recursively=function(b){b.each(function(){var d=c(this),g=d.attr("title");typeof g!="undefined"&&g!=""&&d.siblings("."+g).each(function(){var i=c(this);i.hasClass("parent")?a.mark_for_delete_recursively(i):i.addClass("ui-pgrid-table-row-marked-for-deletion")});d.addClass("ui-pgrid-table-row-marked-for-deletion")})};a.delete_marked=
function(){a.children("tbody").children("tr.ui-pgrid-table-row-marked-for-deletion").remove();a.do_sort(false,true);a.do_filter(false,true);a.paginate(true);a.update_selected()};a.paginate=function(b){if(a.pgrid_paginate){var d=a.children("tbody").children("tr:not(.ui-helper-hidden):not(.child)");a.pgrid_pages=Math.ceil(d.length/a.pgrid_perpage);if(a.pgrid_page+1>a.pgrid_pages)a.pgrid_page=a.pgrid_pages-1;else if(a.pgrid_page==-1&&a.pgrid_pages>0)a.pgrid_page=0;a.cur_page_rows&&a.cur_page_rows.removeClass("ui-pgrid-table-row-visible");
a.cur_page_rows=d.slice(a.pgrid_page*a.pgrid_perpage,a.pgrid_page*a.pgrid_perpage+a.pgrid_perpage);a.cur_page_rows.addClass("ui-pgrid-table-row-visible");a.show_children(a.cur_page_rows);if(a.pgrid_footer){if(!a.page_number_elem)a.page_number_elem=a.footer.find("input.ui-pgrid-page-number");a.page_number_elem.val(a.pgrid_page+1);if(!a.page_total_elem)a.page_total_elem=a.footer.find("span.ui-pgrid-page-total");a.page_total_elem.html(a.pgrid_pages)}}b||a.state_changed()};a.paginate_queue=function(){a.paginate_timout&&
window.clearTimeout(a.paginate_timout);a.paginate_timout=window.setTimeout(a.paginate,50)};a.animate_filter=function(b){b?a.footer_input.stop(true).fadeTo(400,1):a.footer_input.fadeTo(1E3,0.7).fadeTo(1E3,0.8,a.animate_filter)};a.do_filter=function(b,d){if(a.pgrid_filtering||d){if(a.footer_input){a.footer_input.addClass("ui-state-highlight");a.animate_filter()}a.filter_timer&&window.clearInterval(a.filter_timer);if(typeof b=="string")a.pgrid_filter=b;if(a.pgrid_filter.length>0){var g=a.pgrid_filter.toLowerCase().split(" "),
i=0,k=a.children("tbody").children();a.filter_timer=window.setInterval(function(){var j,h,n,p;do{j=k.eq(i);if(!j.length){window.clearInterval(a.filter_timer);if(a.footer_input){a.footer_input.removeClass("ui-state-highlight");a.animate_filter(true)}break}i++;h=j.get();if(h.pgrid_filter_text)n=h.pgrid_filter_text;else{n=h.innerText!=undefined?h.innerText.toLowerCase():h.textContent!=undefined?h.textContent.toLowerCase():j.text().toLowerCase();h.pgrid_filter_text=n}h=true;for(p in g)if(n.indexOf(g[p])==
-1){h=false;break}if(j.hasClass("ui-helper-hidden"))h&&j.removeClass("ui-helper-hidden");else h||j.addClass("ui-helper-hidden");h&&j.hasClass("child")&&a.enable_parents(j)}while(i%25);if(!d){a.paginate_queue();a.update_selected_queue()}},1)}else{a.children("tbody").children("tr.ui-helper-hidden").removeClass("ui-helper-hidden");if(a.footer_input){a.footer_input.removeClass("ui-state-highlight");a.animate_filter(true)}if(!d){a.paginate();a.update_selected()}}}};a.enable_parents=function(b){b.filter("tr.child").each(function(){var d=
c(this);d.siblings("tr.parent").each(function(){var g=c(this);if(d.hasClass(g.attr("title"))){g.removeClass("ui-helper-hidden");a.enable_parents(g)}})})};a.do_sort=function(b,d){if(a.pgrid_sortable){if(b){if(typeof b=="string")b=b.replace(/\D/g,"");b=parseInt(b)}if(!d&&a.pgrid_sort_col==b)a.pgrid_sort_ord=a.pgrid_sort_ord=="asc"?"desc":"asc";else if(b){a.pgrid_sort_col=b;a.pgrid_sort_ord="asc"}b=a.children("thead").children().children();b.children("span.ui-pgrid-table-header-sorted-asc, span.ui-pgrid-table-header-sorted-desc").removeClass("ui-pgrid-table-header-sorted-asc").removeClass("ui-pgrid-table-header-sorted-desc").removeClass("ui-icon-triangle-1-s").removeClass("ui-icon-triangle-1-n");
a.pgrid_sort_ord=="asc"?b.filter("th.col_"+a.pgrid_sort_col).children("span.ui-icon").addClass("ui-pgrid-table-header-sorted-desc ui-icon-triangle-1-n"):b.filter("th.col_"+a.pgrid_sort_col).children("span.ui-icon").addClass("ui-pgrid-table-header-sorted-asc ui-icon-triangle-1-s");b=a.children("tbody").children();b.children("td.ui-pgrid-table-cell-sorted").removeClass("ui-pgrid-table-cell-sorted");var g=b.children("td.col_"+a.pgrid_sort_col).addClass("ui-pgrid-table-cell-sorted"),i=false,k=new RegExp("^[\u00a4$\u20ac\u00a3\u00a5#-]?[0-9.,"+
a.pgrid_decimal_sep+"]+\u00a2?$"),j=new RegExp("[^0-9"+a.pgrid_decimal_sep+"-]","g");g.each(function(){if(!i)if(this.innerText!=undefined)this.innerText.match(k)||(i=true);else if(this.textContent!=undefined)this.textContent.match(k)||(i=true);else c(this).text().match(k)||(i=true)});g=b.get();c.each(g,function(){var h=this.children[a.pgrid_sort_col];if(typeof h!="undefined"){this.sortKey=h.innerText!=undefined?h.innerText.toUpperCase():h.textContent!=undefined?h.textContent.toUpperCase():c(h).text().toUpperCase();
if(!i)this.sortKey=parseFloat(this.sortKey.replace(j,"").replace(a.pgrid_decimal_sep,"."))}});g.sort(function(h,n){if(h.sortKey<n.sortKey)return-1;if(h.sortKey>n.sortKey)return 1;return 0});a.pgrid_sort_ord=="desc"&&g.reverse();a.children("tbody").append(g);b.filter("tr.parent").each(function(){var h=c(this);h.after(h.siblings("."+h.attr("title")))});d||a.paginate()}};a.update_selected=function(){if(a.pgrid_select){a.children("tbody").children("tr.ui-helper-hidden.ui-pgrid-table-row-selected").removeClass("ui-pgrid-table-row-selected").removeClass("ui-state-active");
a.pgrid_footer&&a.pgrid_count&&a.footer.children("div.ui-pgrid-footer-count-container").find("span.ui-pgrid-footer-count-select").html(a.children("tbody").children("tr.ui-pgrid-table-row-selected").length)}a.update_count()};a.update_selected_queue=function(){a.update_selected_timout&&window.clearTimeout(a.update_selected_timout);a.update_selected_timout=window.setTimeout(a.update_selected,200)};a.update_count=function(){a.pgrid_footer&&a.pgrid_count&&a.footer.children("div.ui-pgrid-footer-count-container").find("span.ui-pgrid-footer-count-total").html(a.children("tbody").children("tr:not(.ui-helper-hidden)").length)};
a.do_col_hiding=function(b){var d=a.children("thead").children(),g=a.children("tbody").children();b||d.children("th:hidden").each(function(){var j=c(this).show();g.children("td.col_"+j.prevAll().length).show()});var i=a.pgrid_header_select.children().children();i.attr("checked",true);for(var k in a.pgrid_hidden_cols)if(!isNaN(k)){i.filter(".ui-pgrid-table-col-hider-"+a.pgrid_hidden_cols[k]).removeAttr("checked");d.children("th.col_"+a.pgrid_hidden_cols[k]).hide();g.children("td.col_"+a.pgrid_hidden_cols[k]).hide()}b||
a.state_changed()};a.hide_col=function(b){if(a.pgrid_hidden_cols.indexOf(b)==-1){a.pgrid_hidden_cols.push(b);a.pgrid_header_select.children().children(".ui-pgrid-table-col-hider-"+b).removeAttr("checked");a.children("thead").children().children("th.col_"+b).hide();a.children("tbody").children().children("td.col_"+b).hide();a.state_changed()}};a.show_col=function(b){if(a.pgrid_hidden_cols.indexOf(b)!=-1){a.pgrid_hidden_cols.splice(a.pgrid_hidden_cols.indexOf(b),1);a.pgrid_header_select.children().children(".ui-pgrid-table-col-hider-"+
b).attr("checked",true);a.children("thead").children().children("th.col_"+b).show();a.children("tbody").children().children("td.col_"+b).show();a.state_changed()}};a.init_rows=function(b){if(b){var d;d=a.pgrid_resize_cols?"ui-pgrid-table-cell-text ui-pgrid-table-sized-cell":"ui-pgrid-table-cell-text";for(var g=b.eq(0).children().length,i=b.children("td:first-child"),k=1;k<=g;k++){i.addClass(d+" col_"+k);i=i.next()}b.prepend('<td class="ui-pgrid-table-expander"></td>');b.addClass("ui-state-default");
a.init_children(b.filter("tr.parent:not(.child)"))}};a.init_children=function(b){b.length&&b.each(function(){var d=c(this),g=parseInt(d.children("td:last-child").css("padding-left"));a.init_children(d.siblings("."+d.attr("title")).each(function(){c(this).children("td:not(.ui-pgrid-table-expander)").css("padding-left",g+10+"px")}).filter("tr.parent"))}).children("td.ui-pgrid-table-expander").append(c("<span />").addClass("ui-icon ui-icon-triangle-1-e")).click(function(){var d=c(this),g=d.parent();
if(g.hasClass("ui-pgrid-table-row-expanded")){g.removeClass("ui-pgrid-table-row-expanded");d.children("span.ui-icon").removeClass("ui-icon-triangle-1-s").addClass("ui-icon-triangle-1-e");a.hide_children(g)}else{g.addClass("ui-pgrid-table-row-expanded");d.children("span.ui-icon").removeClass("ui-icon-triangle-1-e").addClass("ui-icon-triangle-1-s");a.show_children(g)}})};a.pgrid_row_hover_effect&&a.children("tbody").delegate("tr","mouseover",function(){c(this).addClass("ui-state-hover")}).delegate("tr",
"mouseout",function(){c(this).removeClass("ui-state-hover")});a.pgrid_select&&a.children("tbody").delegate("tr","click",function(b){if(!c(b.target).parent().andSelf().hasClass("ui-pgrid-table-expander")){var d=c(this);if(!a.pgrid_multi_select||!b.ctrlKey&&!b.shiftKey)d.siblings().removeClass("ui-pgrid-table-row-selected").removeClass("ui-state-active");else b.shiftKey&&d.prevUntil(".ui-pgrid-table-row-selected").addClass("ui-pgrid-table-row-selected ui-state-active");b.ctrlKey?d.toggleClass("ui-pgrid-table-row-selected").toggleClass("ui-state-active"):
d.addClass("ui-pgrid-table-row-selected ui-state-active");a.update_selected()}}).delegate("tr","dblclick",function(b){if(!c(b.target).hasClass("ui-pgrid-table-expander")){c(this).addClass("ui-pgrid-table-row-selected ui-state-active");a.pgrid_double_click&&a.pgrid_double_click(b,a.children("tbody").children("tr.ui-pgrid-table-row-selected"));a.pgrid_double_click_tb&&a.pgrid_double_click_tb()}}).delegate("tr","mousedown",function(b){return!(b.ctrlKey||b.shiftKey)});var l=a.children("thead").children();
l.children().each(function(b){var d=c(this);a.pgrid_header_select.append(c("<label></label>").addClass("ui-state-default ui-corner-all").append(c('<input type="checkbox" />').change(function(g){g.target.checked?a.show_col(b+1):a.hide_col(b+1)}).addClass("ui-pgrid-table-col-hider-"+(b+1))).append(d.text()))});a.pgrid_header_select.addClass("ui-pgrid-header-select ui-widget-header ui-corner-all");a.pgrid_header_select.mouseenter(function(){c(this).mouseleave(function(){c(this).fadeOut("fast").unbind("mouseleave")})});
a.resizing_header=false;a.resizing_tempX=0;var m=c("<div />").addClass("ui-pgrid-table-header-text");a.pgrid_sortable&&m.addClass("ui-pgrid-table-header-sortable");m=l.children("th:not(.ui-pgrid-table-expander)").mouseup(function(){if(a.resizing_header)a.resizing_header=false;else a.do_sort(c(this).prevAll().length)}).wrapInner(m).append(c("<span />").addClass("ui-icon"));a.pgrid_resize_cols&&m.addClass("ui-pgrid-table-header-resizeable").mousedown(function(b){var d=c(this),g=b.pageX-d.offset().left;
if(g<4&&d.hasClass("ui-pgrid-table-expander")||g>3&&g<d.width()-4)return true;a.resizing_header=true;a.resizing_tempX=b.pageX;a.resizing_cur=g<4?d.prev().children("div.ui-pgrid-table-header-text"):d.children("div.ui-pgrid-table-header-text");return false});m.each(function(b){c(this).addClass("col_"+(b+1))});delete m;a.pgrid_resize_cols&&a.pgrid_widget.mousemove(function(b){if(a.resizing_header){var d=a.resizing_cur.width()+b.pageX-a.resizing_tempX;if(d>0){a.resizing_tempX=b.pageX;a.resizing_cur.width(d)}}}).mouseup(function(){a.resizing_header=
false});l.addClass("ui-widget-header").prepend(c('<th class="ui-icon ui-pgrid-table-icon-hidden ui-pgrid-table-expander"><div style="width: 16px; visibility: hidden;">+</div></th>').click(function(b){var d=a.pgrid_widget.offset();a.pgrid_header_select.css({left:b.pageX-d.left-5,top:b.pageY-d.top-5});a.pgrid_header_select.fadeIn("fast")}).mouseover(function(){c(this).removeClass("ui-pgrid-table-icon-hidden").addClass("ui-icon-triangle-1-s")}).mouseout(function(){c(this).addClass("ui-pgrid-table-icon-hidden").removeClass("ui-icon-triangle-1-s")}));
delete l;a.init_rows(a.children("tbody").children());a.do_col_hiding(true);a.pgrid_table_viewport=c('<div class="ui-pgrid-table-viewport ui-widget-content" />');a.pgrid_table_container.appendTo(a.pgrid_table_viewport);a.pgrid_table_viewport.height(a.pgrid_view_height);a.pgrid_view_height!="auto"&&a.pgrid_table_container.css({position:"absolute",top:"0",bottom:"0",left:"0",right:"0"});if(a.pgrid_toolbar){a.toolbar=c("<div />").addClass("ui-pgrid-toolbar").delegate("button","focus",function(){c(this).addClass("ui-state-focus")}).delegate("button",
"blur",function(){c(this).removeClass("ui-state-focus ui-state-active")}).delegate("button","mousedown",function(){c(this).addClass("ui-state-active")}).delegate("button","mouseup",function(){c(this).removeClass("ui-state-active")}).delegate("button","mouseenter",function(){c(this).addClass("ui-state-hover")}).delegate("button","mouseleave",function(){c(this).removeClass("ui-state-hover")});c.each(a.pgrid_toolbar_contents,function(b,d){if(d.type=="button"){var g=c('<button class="ui-pgrid-toolbar-button ui-state-default ui-corner-all" type="button" />').append(c(typeof d.text==
"undefined"?"<span></span>":"<span>"+d.text+"</span>").each(function(){d.extra_class&&c(this).addClass(d.extra_class)})).click(function(j){if(j.button==2)return true;var h=d.return_all_rows?a.children("tbody").children("tr:not(.ui-helper-hidden)"):a.children("tbody").children("tr.ui-pgrid-table-row-selected");if(!d.selection_optional&&!d.select_all&&!d.select_none&&h.length===0){alert("Please make a selection before performing this operation.");return false}if(!d.multi_select&&!d.selection_optional&&
!d.select_all&&!d.select_none&&h.length>1){alert("Please choose only one item before performing this operation.");return false}if(d.confirm)if(d.return_all_rows){if(!confirm('Are you sure you want to perform the operation "'+d.text+'" on all items?'))return false}else if(h.length===0){if(!confirm('Are you sure you want to perform the operation "'+d.text+'"?'))return false}else if(!confirm('Are you sure you want to perform the operation "'+d.text+'" on the '+h.length+" currently selected item(s)?"))return false;
if(d.select_all)if(a.pgrid_select&&a.pgrid_multi_select){a.children("tbody").children("tr:not(.ui-helper-hidden)").addClass("ui-pgrid-table-row-selected ui-state-active");a.update_selected()}if(d.select_none)if(a.pgrid_select){a.children("tbody").children().removeClass("ui-pgrid-table-row-selected").removeClass("ui-state-active");a.update_selected()}if(d.click){var n="";if(d.pass_csv||d.pass_csv_with_headers){if(d.pass_csv_with_headers)h=a.children("thead").children().add(h);h.each(function(){c(this).children("th:not(.ui-pgrid-table-expander), td:not(.ui-pgrid-table-expander)").each(function(){var r=
c(this);n+='"'+r.contents().text().replace('"','""')+'"';if(r.next())n+=","});n+="\n"})}else n=h;return d.click(j,n)}else if(d.url){var p=d.url,t="",s=[];h.each(function(){var r=c(this),y=r.children("td:not(.ui-pgrid-table-expander)");t+=(t.length?d.delimiter:"")+u(r.attr("title"));y.each(function(v){if(s[v+1])s[v+1]+=d.delimiter+u(c(this).contents().text());else s[v+1]=u(c(this).contents().text())})});p=p.replace("__title__",t);for(var w in s)isNaN(w)||(p=p.replace("__col_"+w+"__",s[w]));if(j.button==
1||d.target&&d.target!="_self"){if(d.window_features)return window.open(p,d.target,d.window_features);return window.open(p,d.target)}else{if(typeof pines!="undefined"&&pines.get)return pines.get(p);return window.location=p}}return true});typeof d.title!="undefined"&&g.attr("title",d.title);if(d.double_click){if(a.pgrid_double_click_tb)var i=a.pgrid_double_click_tb;a.pgrid_double_click_tb=function(){i&&i();g.mouseup()}}a.toolbar.append(g)}else if(d.type=="text"){b=c("<div />").addClass("ui-pgrid-toolbar-text");
d.extra_class&&b.addClass(d.extra_class);typeof d.title!="undefined"&&b.attr("title",d.title);d.label&&b.append(c("<span>"+d.label+"</span>").addClass("ui-pgrid-toolbar-text-label"));var k=c('<input type="text" />').addClass("ui-widget ui-widget-content ui-corner-all");d.dont_prevent_default||k.keydown(function(j){j.keyCode==13&&j.preventDefault()});d.attributes&&k.attr(d.attributes);b.append(k);a.toolbar.append(b);d.load&&d.load(k)}else d.type=="separator"&&a.toolbar.append(c("<div />").addClass("ui-pgrid-toolbar-sep ui-state-default").append(c("<div>-</div>").addClass("ui-pgrid-toolbar-blank")))})}if(a.pgrid_footer){a.footer=
c("<div />").addClass("ui-pgrid-footer ui-widget-header ui-corner-bottom ui-helper-clearfix").delegate("button","focus",function(){c(this).addClass("ui-state-focus")}).delegate("button","blur",function(){c(this).removeClass("ui-state-focus ui-state-active")}).delegate("button","mousedown",function(){c(this).addClass("ui-state-active")}).delegate("button","mouseup",function(){c(this).removeClass("ui-state-active")}).delegate("button","mouseenter",function(){c(this).addClass("ui-state-hover")}).delegate("button",
"mouseleave",function(){c(this).removeClass("ui-state-hover")});if(a.pgrid_filtering){a.footer.append(c("<div />").addClass("ui-pgrid-footer-filter-container").each(function(){c(this).append(c("<span>Filter: </span>").append(c("<input />").addClass("ui-pgrid-footer-filter-input ui-widget ui-widget-content ui-corner-all").attr({type:"text",value:a.pgrid_filter,size:"10"}).keyup(function(){a.do_filter(c(this).val())})).append(c('<button type="button">X</button>').addClass("ui-state-default ui-corner-all").click(function(){c(this).prev("input").val("").keyup().focus()})))}));
a.footer_input=a.footer.find("input.ui-pgrid-footer-filter-input")}}a.pgrid_filter!=""&&a.do_filter(a.pgrid_filter,true);if(a.pgrid_sort_col){if(typeof a.pgrid_sort_col=="string")a.pgrid_sort_col=a.pgrid_sort_col.replace(/\D/g,"");a.pgrid_sort_col=parseInt(a.pgrid_sort_col);a.pgrid_sort_ord=a.pgrid_sort_ord=="desc"?"asc":"desc";l=a.pgrid_sortable;a.pgrid_sortable=true;a.do_sort(a.pgrid_sort_col,true);a.pgrid_sortable=l}if(a.pgrid_paginate){a.addClass("ui-pgrid-paginated");a.pgrid_footer&&a.footer.append(c("<div />").addClass("ui-pgrid-footer-pager-container").each(function(){c(this).append("Display ").append(c("<input />").addClass("ui-widget ui-widget-content ui-corner-all ui-pgrid-per-page").attr({type:"text",
value:a.pgrid_perpage}).change(function(){var b=c(this);a.set_per_page(Math.abs(parseInt(b.val())));b.val(a.pgrid_perpage)})).append(" ").append(c('<button type="button">&lt;&lt; Start</button>').addClass("ui-state-default ui-corner-all").click(function(){a.pagestart()})).append(c('<button type="button">&lt; Prev</button>').addClass("ui-state-default ui-corner-all").click(function(){a.pageprev()})).append(" Page ").append(c("<input />").addClass("ui-widget ui-widget-content ui-corner-all ui-pgrid-page-number").attr({type:"text",
value:a.pgrid_page,size:"3"}).change(function(){a.pagenum(Math.abs(parseInt(c(this).val()))-1)})).append(' of <span class="ui-pgrid-page-total">1</span> ').append(c('<button type="button">Next &gt;</button>').addClass("ui-state-default ui-corner-all").click(function(){a.pagenext()})).append(c('<button type="button">End &gt;&gt;</button>').addClass("ui-state-default ui-corner-all").click(function(){a.pageend()}))}));a.paginate(true)}if(a.pgrid_footer)if(a.pgrid_count){a.footer.append(c("<div />").addClass("ui-pgrid-footer-count-container").each(function(){var b=
c(this);a.pgrid_select&&b.append(c('<span><span class="ui-pgrid-footer-count-select">0</span> selected of </span>'));b.append(c('<span><span class="ui-pgrid-footer-count-total">0</span> rows</span>'))}));a.update_selected()}if(a.pgrid_footer)if(a.pgrid_resize){var o,q,x=function(b){q+=b.pageY-o;o=b.pageY;a.pgrid_table_viewport.css("height",q+"px");return false};a.footer.append(c("<div />").addClass("ui-pgrid-footer-resize-container").append(c('<span class="ui-icon ui-icon-grip-solid-horizontal"></span>')).mousedown(function(b){o=
b.pageY;q=a.pgrid_table_viewport.height();c("body").delegate("*","mousemove",x)}).mouseup(function(){c("body").undelegate("*","mousemove",x);a.state_changed()}))}a.pgrid_toolbar&&a.pgrid_widget.append(c("<div />").addClass("ui-pgrid-toolbar-container ui-widget-header ui-corner-top").append(a.toolbar));a.pgrid_widget.append(a.pgrid_table_viewport);a.pgrid_footer&&a.pgrid_widget.append(a.footer);a.pgrid_widget.append(a.pgrid_header_select);this.pines_grid=a});return this};var u=function(e){return encodeURIComponent?
encodeURIComponent(e):escape(e)};c.fn.pgrid.defaults={pgrid_toolbar:false,pgrid_toolbar_contents:[],pgrid_footer:true,pgrid_count:true,pgrid_select:true,pgrid_multi_select:true,pgrid_double_click:null,pgrid_paginate:true,pgrid_page:0,pgrid_perpage:15,pgrid_filtering:true,pgrid_filter:"",pgrid_hidden_cols:[],pgrid_resize_cols:true,pgrid_sortable:true,pgrid_sort_col:1,pgrid_sort_ord:"asc",pgrid_decimal_sep:".",pgrid_row_hover_effect:true,pgrid_view_height:"420px",pgrid_resize:true,pgrid_state_change:null}})(jQuery);
